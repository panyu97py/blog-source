{
  "posts": [
    {
      "content": "æœ¬æ–‡æ‘˜è‡ª[æ˜é‡‘](https://juejin.cn/post/6929302655118344200),å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘\n\n\næœ¬æ–‡æ˜¯å¯è§†åŒ–æ‹–æ‹½ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ï¼Œä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ä¸€å…±å¯¹ 17 ä¸ªåŠŸèƒ½ç‚¹çš„æŠ€æœ¯åŸç†è¿›è¡Œäº†åˆ†æï¼š\n\n\n1. ç¼–è¾‘å™¨\n2. è‡ªå®šä¹‰ç»„ä»¶\n3. æ‹–æ‹½\n4. åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§\n5. æ”¾å¤§ç¼©å°\n6. æ’¤æ¶ˆã€é‡åš\n7. ç»„ä»¶å±æ€§è®¾ç½®\n8. å¸é™„\n9. é¢„è§ˆã€ä¿å­˜ä»£ç \n10. ç»‘å®šäº‹ä»¶\n11. ç»‘å®šåŠ¨ç”»\n12. å¯¼å…¥ PSD\n13. æ‰‹æœºæ¨¡å¼\n14. æ‹–æ‹½æ—‹è½¬ \n15. å¤åˆ¶ç²˜è´´å‰ªåˆ‡\n16. æ•°æ®äº¤äº’\n17. å‘å¸ƒ\n\næœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå°†å¯¹ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç‚¹çš„æŠ€æœ¯åŸç†è¿›è¡Œåˆ†æï¼š\n\n18. å¤šä¸ªç»„ä»¶çš„ç»„åˆå’Œæ‹†åˆ†\n19. æ–‡æœ¬ç»„ä»¶\n20. çŸ©å½¢ç»„ä»¶\n21. é”å®šç»„ä»¶\n22. å¿«æ·é”®\n23. ç½‘æ ¼çº¿\n24. ç¼–è¾‘å™¨å¿«ç…§çš„å¦ä¸€ç§å®ç°æ–¹å¼\n\nè™½ç„¶æˆ‘è¿™ä¸ªå¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“åªæ˜¯ä¸€ä¸ª DEMOï¼Œä½†å¯¹æ¯”äº†ä¸€ä¸‹å¸‚é¢ä¸Šçš„ä¸€äº›ç°æˆäº§å“ï¼ˆä¾‹å¦‚ [processon](https://www.processon.com/)ã€[å¢¨åˆ€](https://modao.cc/)ï¼‰ï¼Œå°±åŸºç¡€åŠŸèƒ½æ¥è¯´ï¼Œæˆ‘è¿™ä¸ª DEMO å®ç°äº†ç»å¤§éƒ¨åˆ†çš„åŠŸèƒ½ã€‚\nå¦‚æœä½ å¯¹äºä½ä»£ç å¹³å°æœ‰å…´è¶£ï¼Œä½†åˆä¸äº†è§£çš„è¯ã€‚å¼ºçƒˆå»ºè®®å°†æˆ‘çš„ä¸‰ç¯‡æ–‡ç« ç»“åˆé¡¹ç›®æºç ä¸€èµ·é˜…è¯»ï¼Œç›¸ä¿¡å¯¹ä½ çš„æ”¶è·ç»å¯¹ä¸å°ã€‚å¦é™„ä¸Šé¡¹ç›®ã€åœ¨çº¿ DEMO åœ°å€ï¼š\n\n[github é¡¹ç›®åœ°å€](https://github.com/woai3c/visual-drag-demo)\n\n[åœ¨çº¿é¢„è§ˆ](https://woai3c.github.io/visual-drag-demo/#/)\n\n### 18. å¤šä¸ªç»„ä»¶çš„ç»„åˆå’Œæ‹†åˆ†\n\nç»„åˆå’Œæ‹†åˆ†çš„æŠ€æœ¯ç‚¹ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤šï¼Œå…±æœ‰ä»¥ä¸‹ 4 ä¸ªï¼š\n\n* é€‰ä¸­åŒºåŸŸ\n* ç»„åˆåçš„ç§»åŠ¨ã€æ—‹è½¬\n* ç»„åˆåçš„æ”¾å¤§ç¼©å°\n* æ‹†åˆ†åå­ç»„ä»¶æ ·å¼çš„æ¢å¤\n\n#### é€‰ä¸­åŒºåŸŸ\nåœ¨å°†å¤šä¸ªç»„ä»¶ç»„åˆä¹‹å‰ï¼Œéœ€è¦å…ˆé€‰ä¸­å®ƒä»¬ã€‚åˆ©ç”¨é¼ æ ‡äº‹ä»¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†é€‰ä¸­åŒºåŸŸå±•ç¤ºå‡ºæ¥ï¼š\n\n![](https://panyu97py.github.io/post-images/1613505365488.gif)\n\n1. `mousedown` è®°å½•èµ·ç‚¹åæ ‡\n2. `mousemove` å°†å½“å‰åæ ‡å’Œèµ·ç‚¹åæ ‡è¿›è¡Œè®¡ç®—å¾—å‡ºç§»åŠ¨åŒºåŸŸ\n3. å¦‚æœæŒ‰ä¸‹é¼ æ ‡åå¾€å·¦ä¸Šæ–¹ç§»åŠ¨ï¼Œç±»ä¼¼äºè¿™ç§æ“ä½œåˆ™éœ€è¦å°†å½“å‰åæ ‡è®¾ä¸ºèµ·ç‚¹åæ ‡ï¼Œå†è®¡ç®—å‡ºç§»åŠ¨åŒºåŸŸ\n\n``` js\n// è·å–ç¼–è¾‘å™¨çš„ä½ç§»ä¿¡æ¯\nconst rectInfo = this.editor.getBoundingClientRect()\nthis.editorX = rectInfo.x\nthis.editorY = rectInfo.y\n\nconst startX = e.clientX\nconst startY = e.clientY\nthis.start.x = startX - this.editorX\nthis.start.y = startY - this.editorY\n// å±•ç¤ºé€‰ä¸­åŒºåŸŸ\nthis.isShowArea = true\n\nconst move = (moveEvent) => {\n    this.width = Math.abs(moveEvent.clientX - startX)\n    this.height = Math.abs(moveEvent.clientY - startY)\n    if (moveEvent.clientX < startX) {\n        this.start.x = moveEvent.clientX - this.editorX\n    }\n\n    if (moveEvent.clientY < startY) {\n        this.start.y = moveEvent.clientY - this.editorY\n    }\n}\n```\nåœ¨ mouseup äº‹ä»¶è§¦å‘æ—¶ï¼Œéœ€è¦å¯¹é€‰ä¸­åŒºåŸŸå†…çš„æ‰€æœ‰ç»„ä»¶çš„ä½ç§»å¤§å°ä¿¡æ¯è¿›è¡Œè®¡ç®—ï¼Œå¾—å‡ºä¸€ä¸ªèƒ½åŒ…å«åŒºåŸŸå†…æ‰€æœ‰ç»„ä»¶çš„æœ€å°åŒºåŸŸã€‚è¿™ä¸ªæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![](https://panyu97py.github.io/post-images/1613505466651.gif)\n\nè¿™ä¸ªè®¡ç®—è¿‡ç¨‹çš„ä»£ç ï¼š\n\n```js\ncreateGroup() {\n  // è·å–é€‰ä¸­åŒºåŸŸçš„ç»„ä»¶æ•°æ®\n  const areaData = this.getSelectArea()\n  if (areaData.length <= 1) {\n      this.hideArea()\n      return\n  }\n\n  // æ ¹æ®é€‰ä¸­åŒºåŸŸå’ŒåŒºåŸŸä¸­æ¯ä¸ªç»„ä»¶çš„ä½ç§»ä¿¡æ¯æ¥åˆ›å»º Group ç»„ä»¶\n  // è¦éå†é€‰æ‹©åŒºåŸŸçš„æ¯ä¸ªç»„ä»¶ï¼Œè·å–å®ƒä»¬çš„ left top right bottom ä¿¡æ¯æ¥è¿›è¡Œæ¯”è¾ƒ\n  let top = Infinity, left = Infinity\n  let right = -Infinity, bottom = -Infinity\n  areaData.forEach(component => {\n      let style = {}\n      if (component.component == 'Group') {\n          component.propValue.forEach(item => {\n              const rectInfo = $(`#component${item.id}`).getBoundingClientRect()\n              style.left = rectInfo.left - this.editorX\n              style.top = rectInfo.top - this.editorY\n              style.right = rectInfo.right - this.editorX\n              style.bottom = rectInfo.bottom - this.editorY\n\n              if (style.left < left) left = style.left\n              if (style.top < top) top = style.top\n              if (style.right > right) right = style.right\n              if (style.bottom > bottom) bottom = style.bottom\n          })\n      } else {\n          style = getComponentRotatedStyle(component.style)\n      }\n\n      if (style.left < left) left = style.left\n      if (style.top < top) top = style.top\n      if (style.right > right) right = style.right\n      if (style.bottom > bottom) bottom = style.bottom\n  })\n\n  this.start.x = left\n  this.start.y = top\n  this.width = right - left\n  this.height = bottom - top\n\t\n  // è®¾ç½®é€‰ä¸­åŒºåŸŸä½ç§»å¤§å°ä¿¡æ¯å’ŒåŒºåŸŸå†…çš„ç»„ä»¶æ•°æ®\n  this.$store.commit('setAreaData', {\n      style: {\n          left,\n          top,\n          width: this.width,\n          height: this.height,\n      },\n      components: areaData,\n  })\n},\n        \ngetSelectArea() {\n    const result = []\n    // åŒºåŸŸèµ·ç‚¹åæ ‡\n    const { x, y } = this.start\n    // è®¡ç®—æ‰€æœ‰çš„ç»„ä»¶æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨é€‰ä¸­åŒºåŸŸå†…\n    this.componentData.forEach(component => {\n        if (component.isLock) return\n        const { left, top, width, height } = component.style\n        if (x <= left && y <= top && (left + width <= x + this.width) && (top + height <= y + this.height)) {\n            result.push(component)\n        }\n    })\n\t\n    // è¿”å›åœ¨é€‰ä¸­åŒºåŸŸå†…çš„æ‰€æœ‰ç»„ä»¶\n    return result\n}\n```\nç®€å•æè¿°ä¸€ä¸‹è¿™æ®µä»£ç çš„å¤„ç†é€»è¾‘ï¼š\n\n1. åˆ©ç”¨ [`getBoundingClientRect()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect) æµè§ˆå™¨ API è·å–æ¯ä¸ªç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£å››ä¸ªæ–¹å‘ä¸Šçš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯`left`ã€`top`ã€`right`ã€`bottom`ã€‚\n2. å¯¹æ¯”æ¯ä¸ªç»„ä»¶çš„è¿™å››ä¸ªä¿¡æ¯ï¼Œå–å¾—é€‰ä¸­åŒºåŸŸçš„æœ€å·¦ã€æœ€ä¸Šã€æœ€å³ã€æœ€ä¸‹å››ä¸ªæ–¹å‘çš„æ•°å€¼ï¼Œä»è€Œå¾—å‡ºä¸€ä¸ªèƒ½åŒ…å«åŒºåŸŸå†…æ‰€æœ‰ç»„ä»¶çš„æœ€å°åŒºåŸŸã€‚\n3. å¦‚æœé€‰ä¸­åŒºåŸŸå†…å·²ç»æœ‰ä¸€ä¸ª `Group` ç»„åˆç»„ä»¶ï¼Œåˆ™éœ€è¦å¯¹å®ƒé‡Œé¢çš„å­ç»„ä»¶è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸æ˜¯å¯¹ç»„åˆç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚\n\n#### ç»„åˆåçš„ç§»åŠ¨ã€æ—‹è½¬\n\nä¸ºäº†æ–¹ä¾¿å°†å¤šä¸ªç»„ä»¶ä¸€èµ·è¿›è¡Œç§»åŠ¨ã€æ—‹è½¬ã€æ”¾å¤§ç¼©å°ç­‰æ“ä½œï¼Œæˆ‘æ–°åˆ›å»ºäº†ä¸€ä¸ª `Group` ç»„åˆç»„ä»¶ï¼š\n\n```html\n<template>\n    <div class=\"group\">\n        <div>\n             <template v-for=\"item in propValue\">\n                <component\n                    class=\"component\"\n                    :is=\"item.component\"\n                    :style=\"item.groupStyle\"\n                    :propValue=\"item.propValue\"\n                    :key=\"item.id\"\n                    :id=\"'component' + item.id\"\n                    :element=\"item\"\n                />\n            </template>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { getStyle } from '@/utils/style'\n\nexport default {\n    props: {\n        propValue: {\n            type: Array,\n            default: () => [],\n        },\n        element: {\n            type: Object,\n        },\n    },\n    created() {\n        const parentStyle = this.element.style\n        this.propValue.forEach(component => {\n            // component.groupStyle çš„ top left æ˜¯ç›¸å¯¹äº group ç»„ä»¶çš„ä½ç½®\n            // å¦‚æœå·²å­˜åœ¨ component.groupStyleï¼Œè¯´æ˜å·²ç»è®¡ç®—è¿‡ä¸€æ¬¡äº†ã€‚ä¸éœ€è¦å†æ¬¡è®¡ç®—\n            if (!Object.keys(component.groupStyle).length) {\n                const style = { ...component.style }\n                component.groupStyle = getStyle(style)\n                component.groupStyle.left = this.toPercent((style.left - parentStyle.left) / parentStyle.width)\n                component.groupStyle.top = this.toPercent((style.top - parentStyle.top) / parentStyle.height)\n                component.groupStyle.width = this.toPercent(style.width / parentStyle.width)\n                component.groupStyle.height = this.toPercent(style.height / parentStyle.height)\n            }\n        })\n    },\n    methods: {\n        toPercent(val) {\n            return val * 100 + '%'\n        },\n    },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.group {\n    & > div {\n        position: relative;\n        width: 100%;\n        height: 100%;\n\n        .component {\n            position: absolute;\n        }\n    }\n}\n</style>\n```\n\n`Group` ç»„ä»¶çš„ä½œç”¨å°±æ˜¯å°†åŒºåŸŸå†…çš„ç»„ä»¶æ”¾åˆ°å®ƒä¸‹é¢ï¼Œæˆä¸ºå­ç»„ä»¶ã€‚å¹¶ä¸”åœ¨åˆ›å»º `Group` ç»„ä»¶æ—¶ï¼Œè·å–æ¯ä¸ªå­ç»„ä»¶åœ¨ `Group` ç»„ä»¶å†…çš„ç›¸å¯¹ä½ç§»å’Œç›¸å¯¹å¤§å°ï¼š\n\n```js\ncreated() {\n    const parentStyle = this.element.style\n    this.propValue.forEach(component => {\n        // component.groupStyle çš„ top left æ˜¯ç›¸å¯¹äº group ç»„ä»¶çš„ä½ç½®\n        // å¦‚æœå·²å­˜åœ¨ component.groupStyleï¼Œè¯´æ˜å·²ç»è®¡ç®—è¿‡ä¸€æ¬¡äº†ã€‚ä¸éœ€è¦å†æ¬¡è®¡ç®—\n        if (!Object.keys(component.groupStyle).length) {\n            const style = { ...component.style }\n            component.groupStyle = getStyle(style)\n            component.groupStyle.left = this.toPercent((style.left - parentStyle.left) / parentStyle.width)\n            component.groupStyle.top = this.toPercent((style.top - parentStyle.top) / parentStyle.height)\n            component.groupStyle.width = this.toPercent(style.width / parentStyle.width)\n            component.groupStyle.height = this.toPercent(style.height / parentStyle.height)\n        }\n    })\n},\nmethods: {\n        toPercent(val) {\n            return val * 100 + '%'\n        },\n    },\n```\n\nä¹Ÿå°±æ˜¯å°†å­ç»„ä»¶çš„ `left`ã€`top`ã€`right`ã€`bottom` ç­‰å±æ€§è½¬æˆä»¥ `%` ç»“å°¾çš„ç›¸å¯¹æ•°å€¼ã€‚\n\n\n**ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç»å¯¹æ•°å€¼ï¼Ÿ**\n\n\nå¦‚æœä½¿ç”¨ç»å¯¹æ•°å€¼ï¼Œé‚£ä¹ˆåœ¨ç§»åŠ¨ `Group` ç»„ä»¶æ—¶ï¼Œé™¤äº†å¯¹ `Group` ç»„ä»¶çš„å±æ€§è¿›è¡Œè®¡ç®—å¤–ï¼Œè¿˜éœ€è¦å¯¹å®ƒçš„æ¯ä¸ªå­ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¹¶ä¸” `Group` åŒ…å«å­ç»„ä»¶å¤ªå¤šçš„è¯ï¼Œåœ¨è¿›è¡Œç§»åŠ¨ã€æ”¾å¤§ç¼©å°æ—¶ï¼Œè®¡ç®—é‡ä¼šéå¸¸å¤§ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆé¡µé¢å¡é¡¿ã€‚å¦‚æœæ”¹æˆç›¸å¯¹æ•°å€¼ï¼Œåˆ™åªéœ€è¦åœ¨ `Group` åˆ›å»ºæ—¶è®¡ç®—ä¸€æ¬¡ã€‚ç„¶ååœ¨ `Group` ç»„ä»¶è¿›è¡Œç§»åŠ¨ã€æ—‹è½¬æ—¶ä¹Ÿä¸ç”¨ç®¡ `Group` çš„å­ç»„ä»¶ï¼Œåªå¯¹å®ƒè‡ªå·±è®¡ç®—å³å¯ã€‚\n\n![](https://panyu97py.github.io/post-images/1613505786018.gif)\n\n#### ç»„åˆåçš„æ”¾å¤§ç¼©å°\n\nç»„åˆåçš„æ”¾å¤§ç¼©å°æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºæœ‰æ—‹è½¬è§’åº¦çš„å­˜åœ¨ã€‚é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å„ä¸ªå­ç»„ä»¶æ²¡æ—‹è½¬æ—¶çš„æ”¾å¤§ç¼©å°ï¼š\n\n![](https://panyu97py.github.io/post-images/1613505848014.gif)\n\nä»åŠ¨å›¾å¯ä»¥çœ‹å‡ºï¼Œæ•ˆæœéå¸¸å®Œç¾ã€‚å„ä¸ªå­ç»„ä»¶çš„å¤§å°æ˜¯è·Ÿéš `Group` ç»„ä»¶çš„å¤§å°è€Œæ”¹å˜çš„ã€‚\n\nç°åœ¨è¯•ç€ç»™å­ç»„ä»¶åŠ ä¸Šæ—‹è½¬è§’åº¦ï¼Œå†çœ‹ä¸€ä¸‹æ•ˆæœï¼š\n\n![](https://panyu97py.github.io/post-images/1613505895886.gif)\n\nä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ\nä¸»è¦æ˜¯å› ä¸ºä¸€ä¸ªç»„ä»¶æ— è®ºæ—‹ä¸æ—‹è½¬ï¼Œå®ƒçš„ `left`ã€`top` å±æ€§éƒ½æ˜¯ä¸å˜çš„ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè™½ç„¶å®é™…ä¸Šç»„ä»¶çš„  `left`ã€`top`ã€`right`ã€`bottom`  å±æ€§æ²¡æœ‰å˜åŒ–ã€‚ä½†åœ¨å¤–è§‚ä¸Šå´å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªåŒæ ·çš„ç»„ä»¶ï¼šä¸€ä¸ªæ²¡æ—‹è½¬ï¼Œä¸€ä¸ªæ—‹è½¬äº† 45 åº¦ã€‚\n\n![](https://panyu97py.github.io/post-images/1613505976304.png)\nå¯ä»¥çœ‹å‡ºæ¥æ—‹è½¬åæŒ‰é’®çš„`left`ã€`top`ã€`right`ã€`bottom` å±æ€§å’Œæˆ‘ä»¬ä»å¤–è§‚ä¸Šçœ‹åˆ°çš„æ˜¯ä¸ä¸€æ ·çš„ã€‚\n\næ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š\n\n\n![](https://panyu97py.github.io/post-images/1613506012073.png)\n\nä¸Šé¢æ˜¯ä¸€ä¸ª `Group` ç»„ä»¶ï¼Œå®ƒå·¦è¾¹çš„å­ç»„ä»¶å±æ€§ä¸ºï¼š\n\n```css\ntransform: rotate(-75.1967deg);\nwidth: 51.2267%;\nheight: 32.2679%;\ntop: 33.8661%;\nleft: -10.6496%;\n```\n\nå¯ä»¥çœ‹åˆ° `width` çš„å€¼ä¸º `51.2267%`ï¼Œä½†ä»å¤–è§‚ä¸Šæ¥çœ‹ï¼Œè¿™ä¸ªå­ç»„ä»¶æœ€å¤šå  `Group` ç»„ä»¶å®½åº¦çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚æ‰€ä»¥è¿™å°±æ˜¯æ”¾å¤§ç¼©å°ä¸æ­£å¸¸çš„é—®é¢˜æ‰€åœ¨ã€‚\n\n##### ä¸€ä¸ªä¸å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼ˆä¸æƒ³çœ‹çš„å¯ä»¥è·³è¿‡ï¼‰\n\n\nä¸€å¼€å§‹æˆ‘æƒ³çš„æ˜¯ï¼Œå…ˆç®—å‡ºå®ƒç›¸å¯¹æµè§ˆå™¨è§†å£çš„ `left`ã€`top`ã€`right`ã€`bottom` å±æ€§ï¼Œå†ç®—å‡ºè¿™å‡ ä¸ªå±æ€§åœ¨ `Group` ç»„ä»¶ä¸Šçš„ç›¸å¯¹æ•°å€¼ã€‚è¿™å¯ä»¥é€šè¿‡ `getBoundingClientRect()` `API` å®ç°ã€‚åªè¦ç»´æŒå¤–è§‚ä¸Šçš„å„ä¸ªå±æ€§å æ¯”ä¸å˜ï¼Œè¿™æ · `Group` ç»„ä»¶åœ¨æ”¾å¤§ç¼©å°æ—¶ï¼Œå†é€šè¿‡æ—‹è½¬è§’åº¦ï¼Œåˆ©ç”¨æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼ˆè¿™ä¸€ç‚¹åœ¨ç¬¬äºŒç¯‡æœ‰è¯¦ç»†æè¿°ï¼‰è·å–å®ƒæœªæ—‹è½¬å‰çš„ t`left`ã€`top`ã€`right`ã€`bottom`  å±æ€§ã€‚è¿™æ ·å°±å¯ä»¥åšåˆ°å­ç»„ä»¶åŠ¨æ€è°ƒæ•´äº†ã€‚\n\n\nä½†æ˜¯è¿™æœ‰ä¸ªé—®é¢˜ï¼Œé€šè¿‡ `getBoundingClientRect()` API åªèƒ½è·å–ç»„ä»¶å¤–è§‚ä¸Šçš„ `left`ã€`top`ã€`right`ã€`bottom`  å±æ€§ã€‚å†åŠ ä¸Šä¸€ä¸ªè§’åº¦ï¼Œå‚æ•°è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰€ä»¥æ— æ³•è®¡ç®—å‡ºç»„ä»¶å®é™…çš„ `left`ã€`top`ã€`right`ã€`bottom`  å±æ€§ã€‚\n\n![](https://panyu97py.github.io/post-images/1613506253945.png)\n\nå°±åƒä¸Šé¢çš„è¿™å¼ å›¾ï¼ŒåªçŸ¥é“åŸç‚¹` O(x,y)`ã€ `w`ã€`h` å’Œæ—‹è½¬è§’åº¦ï¼Œæ— æ³•ç®—å‡ºæŒ‰é’®çš„å®½é«˜ã€‚\n\n#### ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆ\n\nè¿™æ˜¯æ— æ„ä¸­å‘ç°çš„ï¼Œæˆ‘åœ¨å¯¹ `Group` ç»„ä»¶è¿›è¡Œæ”¾å¤§ç¼©å°æ—¶ï¼Œå‘ç°åªè¦ä¿æŒ `Group` ç»„ä»¶çš„å®½é«˜æ¯”ä¾‹ï¼Œå­ç»„ä»¶å°±èƒ½åšåˆ°æ ¹æ®æ¯”ä¾‹æ”¾å¤§ç¼©å°ã€‚é‚£ä¹ˆç°åœ¨é—®é¢˜å°±è½¬å˜æˆäº†å¦‚ä½•è®© `Group` ç»„ä»¶æ”¾å¤§ç¼©å°æ—¶ä¿æŒå®½é«˜æ¯”ä¾‹ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†è¿™ä¸€ç¯‡[æ–‡ç« ](https://github.com/shenhudong/snapping-demo/wiki/corner-handle)ï¼Œå®ƒè¯¦ç»†æè¿°äº†ä¸€ä¸ªæ—‹è½¬ç»„ä»¶å¦‚ä½•ä¿æŒå®½é«˜æ¯”æ¥è¿›è¡Œæ”¾å¤§ç¼©å°ï¼Œå¹¶é…æœ‰æºç ç¤ºä¾‹ã€‚\n\nç°åœ¨æˆ‘å°è¯•ç®€å•æè¿°ä¸€ä¸‹å¦‚ä½•ä¿æŒå®½é«˜æ¯”å¯¹ä¸€ä¸ªæ—‹è½¬ç»„ä»¶è¿›è¡Œæ”¾å¤§ç¼©å°ï¼ˆå»ºè®®è¿˜æ˜¯çœ‹çœ‹åŸæ–‡ï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå·²æ—‹è½¬ä¸€å®šè§’åº¦çš„çŸ©å½¢ï¼Œå‡è®¾ç°åœ¨æ‹–åŠ¨å®ƒå·¦ä¸Šæ–¹çš„ç‚¹è¿›è¡Œæ‹‰ä¼¸ã€‚\n\n![](https://panyu97py.github.io/post-images/1613506394348.png)\n\n**ç¬¬ä¸€æ­¥**ï¼Œç®—å‡ºç»„ä»¶å®½é«˜æ¯”ï¼Œä»¥åŠæŒ‰ä¸‹é¼ æ ‡æ—¶é€šè¿‡ç»„ä»¶çš„åæ ‡ï¼ˆæ— è®ºæ—‹è½¬å¤šå°‘åº¦ï¼Œç»„ä»¶çš„ `top` ã€`left` å±æ€§ä¸å˜ï¼‰å’Œå¤§å°ç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š\n```js\n// ç»„ä»¶å®½é«˜æ¯”\nconst proportion = style.width / style.height\n            \nconst center = {\n    x: style.left + style.width / 2,\n    y: style.top + style.height / 2,\n}\n```\n\n**ç¬¬äºŒæ­¥**ï¼Œç”¨å½“å‰ç‚¹å‡»åæ ‡å’Œç»„ä»¶ä¸­å¿ƒç‚¹ç®—å‡ºå½“å‰ç‚¹å‡»åæ ‡çš„å¯¹ç§°ç‚¹åæ ‡ï¼š\n```js\n// è·å–ç”»å¸ƒä½ç§»ä¿¡æ¯\nconst editorRectInfo = document.querySelector('#editor').getBoundingClientRect()\n\n// å½“å‰ç‚¹å‡»åæ ‡\nconst curPoint = {\n    x: e.clientX - editorRectInfo.left,\n    y: e.clientY - editorRectInfo.top,\n}\n\n// è·å–å¯¹ç§°ç‚¹çš„åæ ‡\nconst symmetricPoint = {\n    x: center.x - (curPoint.x - center.x),\n    y: center.y - (curPoint.y - center.y),\n}\n```\n**ç¬¬ä¸‰æ­¥**ï¼Œæ‘ä½ç»„ä»¶å·¦ä¸Šè§’è¿›è¡Œæ‹‰ä¼¸æ—¶ï¼Œé€šè¿‡å½“å‰é¼ æ ‡å®æ—¶åæ ‡å’Œå¯¹ç§°ç‚¹è®¡ç®—å‡ºæ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ï¼š\n```js\nconst curPositon = {\n    x: moveEvent.clientX - editorRectInfo.left,\n    y: moveEvent.clientY - editorRectInfo.top,\n}\n\nconst newCenterPoint = getCenterPoint(curPositon, symmetricPoint)\n\n// æ±‚ä¸¤ç‚¹ä¹‹é—´çš„ä¸­ç‚¹åæ ‡\nfunction getCenterPoint(p1, p2) {\n    return {\n        x: p1.x + ((p2.x - p1.x) / 2),\n        y: p1.y + ((p2.y - p1.y) / 2),\n    }\n}\n```\nç”±äºç»„ä»¶å¤„äºæ—‹è½¬çŠ¶æ€ï¼Œå³ä½¿ä½ çŸ¥é“äº†æ‹‰ä¼¸æ—¶ç§»åŠ¨çš„ xy è·ç¦»ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å¯¹ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¦åˆ™å°±ä¼šå‡ºç° BUGï¼Œç§»ä½æˆ–è€…æ”¾å¤§ç¼©å°æ–¹å‘ä¸æ­£ç¡®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æœªæ—‹è½¬çš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œè®¡ç®—ã€‚\n\n![](https://panyu97py.github.io/post-images/1613506539352.png)\n\n**ç¬¬å››æ­¥**ï¼Œæ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å½“å‰é¼ æ ‡å®æ—¶åæ ‡å¯ä»¥ç®—å‡ºå½“å‰é¼ æ ‡å®æ—¶åæ ‡ `currentPosition` åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ `newTopLeftPoint`ã€‚åŒæ—¶ä¹Ÿèƒ½æ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å¯¹ç§°ç‚¹ç®—å‡ºç»„ä»¶å¯¹ç§°ç‚¹ sPoint åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ `newBottomRightPoint`ã€‚\nå¯¹åº”çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š\n\n```js\n/**\n * è®¡ç®—æ ¹æ®åœ†å¿ƒæ—‹è½¬åçš„ç‚¹çš„åæ ‡\n * @param   {Object}  point  æ—‹è½¬å‰çš„ç‚¹åæ ‡\n * @param   {Object}  center æ—‹è½¬ä¸­å¿ƒ\n * @param   {Number}  rotate æ—‹è½¬çš„è§’åº¦\n * @return  {Object}         æ—‹è½¬åçš„åæ ‡\n * https://www.zhihu.com/question/67425734/answer/252724399 æ—‹è½¬çŸ©é˜µå…¬å¼\n */\nexport function calculateRotatedPointCoordinate(point, center, rotate) {\n    /**\n     * æ—‹è½¬å…¬å¼ï¼š\n     *  ç‚¹a(x, y)\n     *  æ—‹è½¬ä¸­å¿ƒc(x, y)\n     *  æ—‹è½¬åç‚¹n(x, y)\n     *  æ—‹è½¬è§’åº¦Î¸                tan ??\n     * nx = cosÎ¸ * (ax - cx) - sinÎ¸ * (ay - cy) + cx\n     * ny = sinÎ¸ * (ax - cx) + cosÎ¸ * (ay - cy) + cy\n     */\n\n    return {\n        x: (point.x - center.x) * Math.cos(angleToRadian(rotate)) - (point.y - center.y) * Math.sin(angleToRadian(rotate)) + center.x,\n        y: (point.x - center.x) * Math.sin(angleToRadian(rotate)) + (point.y - center.y) * Math.cos(angleToRadian(rotate)) + center.y,\n    }\n}\n```\n\nä¸Šé¢çš„å…¬å¼æ¶‰åŠåˆ°çº¿æ€§ä»£æ•°ä¸­æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼Œå¯¹äºä¸€ä¸ªæ²¡ä¸Šè¿‡å¤§å­¦çš„äººæ¥è¯´ï¼Œå®åœ¨å¤ªéš¾äº†ã€‚è¿˜å¥½æˆ‘ä»[çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªå›ç­”](https://www.zhihu.com/question/67425734/answer/252724399)ä¸­æ‰¾åˆ°äº†è¿™ä¸€å…¬å¼çš„æ¨ç†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯å›ç­”çš„åŸæ–‡ï¼š\n\n![](https://panyu97py.github.io/post-images/1613506660740.png)\n\n![](https://panyu97py.github.io/post-images/1613506688090.png)\n\né€šè¿‡ä»¥ä¸Šå‡ ä¸ªè®¡ç®—å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ç»„ä»¶æ–°çš„ä½ç§»å€¼ `top`ã€`left` ä»¥åŠæ–°çš„ç»„ä»¶å¤§å°ã€‚å¯¹åº”çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n```js\nfunction calculateLeftTop(style, curPositon, pointInfo) {\n    const { symmetricPoint } = pointInfo\n    const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)\n    const newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)\n    const newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)\n  \n    const newWidth = newBottomRightPoint.x - newTopLeftPoint.x\n    const newHeight = newBottomRightPoint.y - newTopLeftPoint.y\n    if (newWidth > 0 && newHeight > 0) {\n        style.width = Math.round(newWidth)\n        style.height = Math.round(newHeight)\n        style.left = Math.round(newTopLeftPoint.x)\n        style.top = Math.round(newTopLeftPoint.y)\n    }\n}\n```\nç°åœ¨å†æ¥çœ‹ä¸€ä¸‹æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ï¼š\n\n![](https://panyu97py.github.io/post-images/1613506759227.gif)\n\n**ç¬¬äº”æ­¥**ï¼Œç”±äºæˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ˜¯é”å®šå®½é«˜æ¯”æ¥è¿›è¡Œæ”¾å¤§ç¼©å°ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°è®¡ç®—æ‹‰ä¼¸åçš„å›¾å½¢çš„å·¦ä¸Šè§’åæ ‡ã€‚\n\nè¿™é‡Œå…ˆç¡®å®šå¥½å‡ ä¸ªå½¢çŠ¶çš„å‘½åï¼š\n\n* åŸå›¾å½¢: ã€€çº¢è‰²éƒ¨åˆ†\n* æ–°å›¾å½¢: ã€€è“è‰²éƒ¨åˆ†\n* ä¿®æ­£å›¾å½¢: ç»¿è‰²éƒ¨åˆ†ï¼Œå³åŠ ä¸Šå®½é«˜æ¯”é”å®šè§„åˆ™çš„ä¿®æ­£å›¾å½¢\n\n![](https://panyu97py.github.io/post-images/1613506825223.gif)\n\nåœ¨ç¬¬å››æ­¥ä¸­ç®—å‡ºç»„ä»¶æœªæ—‹è½¬å‰çš„ `newTopLeftPoint` `newBottomRightPoint` `newWidth` `newHeight` åï¼Œéœ€è¦æ ¹æ®å®½é«˜æ¯” `proportion` æ¥ç®—å‡ºæ–°çš„å®½åº¦æˆ–é«˜åº¦ã€‚\n\n![](https://panyu97py.github.io/post-images/1613506905389.png)\n\nä¸Šå›¾å°±æ˜¯ä¸€ä¸ªéœ€è¦æ”¹å˜é«˜åº¦çš„ç¤ºä¾‹ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n```js\nif (newWidth / newHeight > proportion) {\n    newTopLeftPoint.x += Math.abs(newWidth - newHeight * proportion)\n    newWidth = newHeight * proportion\n} else {\n    newTopLeftPoint.y += Math.abs(newHeight - newWidth / proportion)\n    newHeight = newWidth / proportion\n}\n```\nç”±äºç°åœ¨æ±‚çš„æœªæ—‹è½¬å‰çš„åæ ‡æ˜¯ä»¥æ²¡æŒ‰æ¯”ä¾‹ç¼©å‡å®½é«˜å‰çš„åæ ‡æ¥è®¡ç®—çš„ï¼Œæ‰€ä»¥ç¼©å‡å®½é«˜åï¼Œéœ€è¦æŒ‰ç…§åŸæ¥çš„ä¸­å¿ƒç‚¹æ—‹è½¬å›å»ï¼Œè·å¾—ç¼©å‡å®½é«˜å¹¶æ—‹è½¬åå¯¹åº”çš„åæ ‡ã€‚ç„¶åä»¥è¿™ä¸ªåæ ‡å’Œå¯¹ç§°ç‚¹è·å¾—æ–°çš„ä¸­å¿ƒç‚¹ï¼Œå¹¶é‡æ–°è®¡ç®—æœªæ—‹è½¬å‰çš„åæ ‡ã€‚\n\n![](https://panyu97py.github.io/post-images/1613506955962.png)\n\n![](https://panyu97py.github.io/post-images/1613507009595.png)\n\nç»è¿‡ä¿®æ”¹åçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n\n```js\nfunction calculateLeftTop(style, curPositon, proportion, needLockProportion, pointInfo) {\n    const { symmetricPoint } = pointInfo\n    let newCenterPoint = getCenterPoint(curPositon, symmetricPoint)\n    let newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)\n    let newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)\n  \n    let newWidth = newBottomRightPoint.x - newTopLeftPoint.x\n    let newHeight = newBottomRightPoint.y - newTopLeftPoint.y\n\n    if (needLockProportion) {\n        if (newWidth / newHeight > proportion) {\n            newTopLeftPoint.x += Math.abs(newWidth - newHeight * proportion)\n            newWidth = newHeight * proportion\n        } else {\n            newTopLeftPoint.y += Math.abs(newHeight - newWidth / proportion)\n            newHeight = newWidth / proportion\n        }\n\n        // ç”±äºç°åœ¨æ±‚çš„æœªæ—‹è½¬å‰çš„åæ ‡æ˜¯ä»¥æ²¡æŒ‰æ¯”ä¾‹ç¼©å‡å®½é«˜å‰çš„åæ ‡æ¥è®¡ç®—çš„\n        // æ‰€ä»¥ç¼©å‡å®½é«˜åï¼Œéœ€è¦æŒ‰ç…§åŸæ¥çš„ä¸­å¿ƒç‚¹æ—‹è½¬å›å»ï¼Œè·å¾—ç¼©å‡å®½é«˜å¹¶æ—‹è½¬åå¯¹åº”çš„åæ ‡\n        // ç„¶åä»¥è¿™ä¸ªåæ ‡å’Œå¯¹ç§°ç‚¹è·å¾—æ–°çš„ä¸­å¿ƒç‚¹ï¼Œå¹¶é‡æ–°è®¡ç®—æœªæ—‹è½¬å‰çš„åæ ‡\n        const rotatedTopLeftPoint = calculateRotatedPointCoordinate(newTopLeftPoint, newCenterPoint, style.rotate)\n        newCenterPoint = getCenterPoint(rotatedTopLeftPoint, symmetricPoint)\n        newTopLeftPoint = calculateRotatedPointCoordinate(rotatedTopLeftPoint, newCenterPoint, -style.rotate)\n        newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)\n    \n        newWidth = newBottomRightPoint.x - newTopLeftPoint.x\n        newHeight = newBottomRightPoint.y - newTopLeftPoint.y\n    }\n\n    if (newWidth > 0 && newHeight > 0) {\n        style.width = Math.round(newWidth)\n        style.height = Math.round(newHeight)\n        style.left = Math.round(newTopLeftPoint.x)\n        style.top = Math.round(newTopLeftPoint.y)\n    }\n}\n```\nä¿æŒå®½é«˜æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°çš„æ•ˆæœå¦‚ä¸‹ï¼š\n\n![](https://panyu97py.github.io/post-images/1613507087355.gif)\n\nå½“ `Group` ç»„ä»¶æœ‰æ—‹è½¬çš„å­ç»„ä»¶æ—¶ï¼Œæ‰éœ€è¦ä¿æŒå®½é«˜æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°ã€‚æ‰€ä»¥åœ¨åˆ›å»º `Group` ç»„ä»¶æ—¶å¯ä»¥åˆ¤æ–­ä¸€ä¸‹å­ç»„ä»¶æ˜¯å¦æœ‰æ—‹è½¬è§’åº¦ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ä¸éœ€è¦ä¿æŒå®½åº¦æ¯”è¿›è¡Œæ”¾å¤§ç¼©å°ã€‚\n\n```js\nisNeedLockProportion() {\n    if (this.element.component != 'Group') return false\n    const ratates = [0, 90, 180, 360]\n    for (const component of this.element.propValue) {\n        if (!ratates.includes(mod360(parseInt(component.style.rotate)))) {\n            return true\n        }\n    }\n\n    return false\n}\n```\n\n#### æ‹†åˆ†åå­ç»„ä»¶æ ·å¼çš„æ¢å¤\n\nå°†å¤šä¸ªç»„ä»¶ç»„åˆåœ¨ä¸€èµ·åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥æ˜¯å°† `Group` ç»„ä»¶è¿›è¡Œæ‹†åˆ†å¹¶æ¢å¤å„ä¸ªå­ç»„ä»¶çš„æ ·å¼ã€‚ä¿è¯æ‹†åˆ†åçš„å­ç»„ä»¶åœ¨å¤–è§‚ä¸Šçš„å±æ€§ä¸å˜ã€‚\n\nè®¡ç®—ä»£ç å¦‚ä¸‹ï¼š\n```js\n// store\ndecompose({ curComponent, editor }) {\n    const parentStyle = { ...curComponent.style }\n    const components = curComponent.propValue\n    const editorRect = editor.getBoundingClientRect()\n\n    store.commit('deleteComponent')\n    components.forEach(component => {\n        decomposeComponent(component, editorRect, parentStyle)\n        store.commit('addComponent', { component })\n    })\n}\n        \n// å°†ç»„åˆä¸­çš„å„ä¸ªå­ç»„ä»¶æ‹†åˆ†å‡ºæ¥ï¼Œå¹¶è®¡ç®—å®ƒä»¬æ–°çš„ style\nexport default function decomposeComponent(component, editorRect, parentStyle) {\n    // å­ç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£çš„æ ·å¼\n    const componentRect = $(`#component${component.id}`).getBoundingClientRect()\n    // è·å–å…ƒç´ çš„ä¸­å¿ƒç‚¹åæ ‡\n    const center = {\n        x: componentRect.left - editorRect.left + componentRect.width / 2,\n        y: componentRect.top - editorRect.top + componentRect.height / 2,\n    }\n\n    component.style.rotate = mod360(component.style.rotate + parentStyle.rotate)\n    component.style.width = parseFloat(component.groupStyle.width) / 100 * parentStyle.width\n    component.style.height = parseFloat(component.groupStyle.height) / 100 * parentStyle.height\n    // è®¡ç®—å‡ºå…ƒç´ æ–°çš„ top left åæ ‡\n    component.style.left = center.x - component.style.width / 2\n    component.style.top = center.y - component.style.height / 2\n    component.groupStyle = {}\n}\n```\n\nè¿™æ®µä»£ç çš„å¤„ç†é€»è¾‘ä¸ºï¼š\n\n1. éå† `Group` çš„å­ç»„ä»¶å¹¶æ¢å¤å®ƒä»¬çš„æ ·å¼\n2. åˆ©ç”¨ `getBoundingClientRect() ``API` è·å–å­ç»„ä»¶ç›¸å¯¹äºæµè§ˆå™¨è§†å£çš„ `left` `top` `width` `height` å±æ€§ã€‚\n3. åˆ©ç”¨è¿™å››ä¸ªå±æ€§è®¡ç®—å‡ºå­ç»„ä»¶çš„ä¸­å¿ƒç‚¹åæ ‡ã€‚\n4. ç”±äºå­ç»„ä»¶çš„ `width` `height` å±æ€§æ˜¯ç›¸å¯¹äº `Group` ç»„ä»¶çš„ï¼Œæ‰€ä»¥å°†å®ƒä»¬çš„ç™¾åˆ†æ¯”å€¼å’Œ `Group` ç›¸ä¹˜å¾—å‡ºå…·ä½“æ•°å€¼ã€‚\n5. å†ç”¨ä¸­å¿ƒç‚¹ `center(x, y) `å‡å»å­ç»„ä»¶å®½é«˜çš„ä¸€åŠå¾—å‡ºå®ƒçš„ `left` `top` å±æ€§ã€‚\n\nè‡³æ­¤ï¼Œç»„åˆå’Œæ‹†åˆ†å°±è®²è§£å®Œäº†ã€‚\n\n### 19. æ–‡æœ¬ç»„ä»¶\næ–‡æœ¬ç»„ä»¶ `VText` ä¹‹å‰å°±å·²ç»å®ç°è¿‡äº†ï¼Œä½†ä¸å®Œç¾ã€‚ä¾‹å¦‚æ— æ³•å¯¹æ–‡å­—è¿›è¡Œé€‰ä¸­ã€‚ç°åœ¨æˆ‘å¯¹å®ƒè¿›è¡Œäº†é‡å†™ï¼Œè®©å®ƒæ”¯æŒé€‰ä¸­åŠŸèƒ½ã€‚\n```js\n<template>\n    <div v-if=\"editMode == 'edit'\" class=\"v-text\" @keydown=\"handleKeydown\" @keyup=\"handleKeyup\">\n        <!-- tabindex >= 0 ä½¿å¾—åŒå‡»æ—¶èšé›†è¯¥å…ƒç´  -->\n        <div :contenteditable=\"canEdit\" :class=\"{ canEdit }\" @dblclick=\"setEdit\" :tabindex=\"element.id\" @paste=\"clearStyle\"\n            @mousedown=\"handleMousedown\" @blur=\"handleBlur\" ref=\"text\" v-html=\"element.propValue\" @input=\"handleInput\"\n            :style=\"{ verticalAlign: element.style.verticalAlign }\"\n        ></div>\n    </div>\n    <div v-else class=\"v-text\">\n        <div v-html=\"element.propValue\" :style=\"{ verticalAlign: element.style.verticalAlign }\"></div>\n    </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\nimport { keycodes } from '@/utils/shortcutKey.js'\n\nexport default {\n    props: {\n        propValue: {\n            type: String,\n            require: true,\n        },\n        element: {\n            type: Object,\n        },\n    },\n    data() {\n        return {\n            canEdit: false,\n            ctrlKey: 17,\n            isCtrlDown: false,\n        }\n    },\n    computed: {\n        ...mapState([\n            'editMode',\n        ]),\n    },\n    methods: {\n        handleInput(e) {\n            this.$emit('input', this.element, e.target.innerHTML)\n        },\n\n        handleKeydown(e) {\n            if (e.keyCode == this.ctrlKey) {\n                this.isCtrlDown = true\n            } else if (this.isCtrlDown && this.canEdit && keycodes.includes(e.keyCode)) {\n                e.stopPropagation()\n            } else if (e.keyCode == 46) { // deleteKey\n                e.stopPropagation()\n            }\n        },\n\n        handleKeyup(e) {\n            if (e.keyCode == this.ctrlKey) {\n                this.isCtrlDown = false\n            }\n        },\n\n        handleMousedown(e) {\n            if (this.canEdit) {\n                e.stopPropagation()\n            }\n        },\n\n        clearStyle(e) {\n            e.preventDefault()\n            const clp = e.clipboardData\n            const text = clp.getData('text/plain') || ''\n            if (text !== '') {\n                document.execCommand('insertText', false, text)\n            }\n\n            this.$emit('input', this.element, e.target.innerHTML)\n        },\n\n        handleBlur(e) {\n            this.element.propValue = e.target.innerHTML || '&nbsp;'\n            this.canEdit = false\n        },\n\n        setEdit() {\n            this.canEdit = true\n            // å…¨é€‰\n            this.selectText(this.$refs.text)\n        },\n\n        selectText(element) {\n            const selection = window.getSelection()\n            const range = document.createRange()\n            range.selectNodeContents(element)\n            selection.removeAllRanges()\n            selection.addRange(range)\n        },\n    },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.v-text {\n    width: 100%;\n    height: 100%;\n    display: table;\n\n    div {\n        display: table-cell;\n        width: 100%;\n        height: 100%;\n        outline: none;\n    }\n\n    .canEdit {\n        cursor: text;\n        height: 100%;\n    }\n}\n</style>\n```\næ”¹é€ åçš„ VText ç»„ä»¶åŠŸèƒ½å¦‚ä¸‹ï¼š\n\n1. åŒå‡»å¯åŠ¨ç¼–è¾‘ã€‚\n2. æ”¯æŒé€‰ä¸­æ–‡æœ¬ã€‚\n3. ç²˜è´´æ—¶è¿‡æ»¤æ‰æ–‡æœ¬çš„æ ·å¼ã€‚\n4. æ¢è¡Œæ—¶è‡ªåŠ¨æ‰©å……æ–‡æœ¬æ¡†çš„é«˜åº¦ã€‚\n\n![](https://panyu97py.github.io/post-images/1613507304088.gif)\n\n### 20. çŸ©å½¢ç»„ä»¶\n\nçŸ©å½¢ç»„ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªå†…åµŒ `VText` æ–‡æœ¬ç»„ä»¶çš„ä¸€ä¸ª `DIV`\n\n```js\n<template>\n    <div class=\"rect-shape\">\n        <v-text :propValue=\"element.propValue\" :element=\"element\" />\n    </div>\n</template>\n\n<script>\nexport default {\n    props: {\n        element: {\n            type: Object,\n        },\n    },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.rect-shape {\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n}\n</style>\n```\n`VText` æ–‡æœ¬ç»„ä»¶æœ‰çš„åŠŸèƒ½å®ƒéƒ½æœ‰ï¼Œå¹¶ä¸”å¯ä»¥ä»»æ„æ”¾å¤§ç¼©å°ã€‚\n\n![](https://panyu97py.github.io/post-images/1613507388868.gif)\n\n### 21. é”å®šç»„ä»¶\n\né”å®šç»„ä»¶ä¸»è¦æ˜¯çœ‹åˆ° `processon` å’Œå¢¨åˆ€æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œäºæ˜¯æˆ‘é¡ºä¾¿å®ç°äº†ã€‚é”å®šç»„ä»¶çš„å…·ä½“éœ€æ±‚ä¸ºï¼šä¸èƒ½ç§»åŠ¨ã€æ”¾å¤§ç¼©å°ã€æ—‹è½¬ã€å¤åˆ¶ã€ç²˜è´´ç­‰ï¼Œåªèƒ½è¿›è¡Œè§£é”æ“ä½œã€‚\nå®ƒçš„å®ç°åŸç†ä¹Ÿä¸éš¾ï¼š\n\n1. åœ¨è‡ªå®šä¹‰ç»„ä»¶ä¸ŠåŠ ä¸€ä¸ª `isLock` å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦é”å®šç»„ä»¶ã€‚\n2. åœ¨ç‚¹å‡»ç»„ä»¶æ—¶ï¼Œæ ¹æ® `isLock` æ˜¯å¦ä¸º `true` æ¥éšè—ç»„ä»¶ä¸Šçš„å…«ä¸ªç‚¹å’Œæ—‹è½¬å›¾æ ‡ã€‚\n3. ä¸ºäº†çªå‡ºä¸€ä¸ªç»„ä»¶è¢«é”å®šï¼Œç»™å®ƒåŠ ä¸Šé€æ˜åº¦å±æ€§å’Œä¸€ä¸ªé”çš„å›¾æ ‡ã€‚\n4. å¦‚æœç»„ä»¶è¢«é”å®šï¼Œç½®ç°ä¸Šé¢æ‰€è¯´çš„éœ€æ±‚å¯¹åº”çš„æŒ‰é’®ï¼Œä¸èƒ½è¢«ç‚¹å‡»ã€‚\n\nç›¸å…³ä»£ç å¦‚ä¸‹ï¼š\n```js\nexport const commonAttr = {\n    animations: [],\n    events: {},\n    groupStyle: {}, // å½“ä¸€ä¸ªç»„ä»¶æˆä¸º Group çš„å­ç»„ä»¶æ—¶ä½¿ç”¨\n    isLock: false, // æ˜¯å¦é”å®šç»„ä»¶\n}\n```\n\n```html\n<el-button @click=\"decompose\" \n:disabled=\"!curComponent || curComponent.isLock || curComponent.component != 'Group'\">æ‹†åˆ†</el-button>\n\n<el-button @click=\"lock\" :disabled=\"!curComponent || curComponent.isLock\">é”å®š</el-button>\n<el-button @click=\"unlock\" :disabled=\"!curComponent || !curComponent.isLock\">è§£é”</el-button>\n```\n\n```html\n<template>\n    <div class=\"contextmenu\" v-show=\"menuShow\" :style=\"{ top: menuTop + 'px', left: menuLeft + 'px' }\">\n        <ul @mouseup=\"handleMouseUp\">\n            <template v-if=\"curComponent\">\n                <template v-if=\"!curComponent.isLock\">\n                    <li @click=\"copy\">å¤åˆ¶</li>\n                    <li @click=\"paste\">ç²˜è´´</li>\n                    <li @click=\"cut\">å‰ªåˆ‡</li>\n                    <li @click=\"deleteComponent\">åˆ é™¤</li>\n                    <li @click=\"lock\">é”å®š</li>\n                    <li @click=\"topComponent\">ç½®é¡¶</li>\n                    <li @click=\"bottomComponent\">ç½®åº•</li>\n                    <li @click=\"upComponent\">ä¸Šç§»</li>\n                    <li @click=\"downComponent\">ä¸‹ç§»</li>\n                </template>\n                <li v-else @click=\"unlock\">è§£é”</li>\n            </template>\n            <li v-else @click=\"paste\">ç²˜è´´</li>\n        </ul>\n    </div>\n</template>\n```\n\n![](https://panyu97py.github.io/post-images/1613507515799.gif)\n\n### 22. å¿«æ·é”®\n\næ”¯æŒå¿«æ·é”®ä¸»è¦æ˜¯ä¸ºäº†æå‡å¼€å‘æ•ˆç‡ï¼Œç”¨é¼ æ ‡ç‚¹ç‚¹ç‚¹æ¯•ç«Ÿæ²¡æœ‰æŒ‰é”®ç›˜å¿«ã€‚ç›®å‰å¿«æ·é”®æ”¯æŒçš„åŠŸèƒ½å¦‚ä¸‹ï¼š\n```\nconst ctrlKey = 17, \n    vKey = 86, // ç²˜è´´\n    cKey = 67, // å¤åˆ¶\n    xKey = 88, // å‰ªåˆ‡\n\n    yKey = 89, // é‡åš\n    zKey = 90, // æ’¤é”€\n\n    gKey = 71, // ç»„åˆ\n    bKey = 66, // æ‹†åˆ†\n\n    lKey = 76, // é”å®š\n    uKey = 85, // è§£é”\n\n    sKey = 83, // ä¿å­˜\n    pKey = 80, // é¢„è§ˆ\n    dKey = 68, // åˆ é™¤\n    deleteKey = 46, // åˆ é™¤\n    eKey = 69 // æ¸…ç©ºç”»å¸ƒ\n```\n\nå®ç°åŸç†ä¸»è¦æ˜¯åˆ©ç”¨ `window` å…¨å±€ç›‘å¬æŒ‰é”®äº‹ä»¶ï¼Œåœ¨ç¬¦åˆæ¡ä»¶çš„æŒ‰é”®è§¦å‘æ—¶æ‰§è¡Œå¯¹åº”çš„æ“ä½œï¼š\n\n```js\n// ä¸ç»„ä»¶çŠ¶æ€æ— å…³çš„æ“ä½œ\nconst basemap = {\n    [vKey]: paste,\n    [yKey]: redo,\n    [zKey]: undo,\n    [sKey]: save,\n    [pKey]: preview,\n    [eKey]: clearCanvas,\n}\n\n// ç»„ä»¶é”å®šçŠ¶æ€ä¸‹å¯ä»¥æ‰§è¡Œçš„æ“ä½œ\nconst lockMap = {\n    ...basemap,\n    [uKey]: unlock,\n}\n\n// ç»„ä»¶æœªé”å®šçŠ¶æ€ä¸‹å¯ä»¥æ‰§è¡Œçš„æ“ä½œ\nconst unlockMap = {\n    ...basemap,\n    [cKey]: copy,\n    [xKey]: cut,\n    [gKey]: compose,\n    [bKey]: decompose,\n    [dKey]: deleteComponent,\n    [deleteKey]: deleteComponent,\n    [lKey]: lock,\n}\n\nlet isCtrlDown = false\n// å…¨å±€ç›‘å¬æŒ‰é”®æ“ä½œå¹¶æ‰§è¡Œç›¸åº”å‘½ä»¤\nexport function listenGlobalKeyDown() {\n    window.onkeydown = (e) => {\n        const { curComponent } = store.state\n        if (e.keyCode == ctrlKey) {\n            isCtrlDown = true\n        } else if (e.keyCode == deleteKey && curComponent) {\n            store.commit('deleteComponent')\n            store.commit('recordSnapshot')\n        } else if (isCtrlDown) {\n            if (!curComponent || !curComponent.isLock) {\n                e.preventDefault()\n                unlockMap[e.keyCode] && unlockMap[e.keyCode]()\n            } else if (curComponent && curComponent.isLock) {\n                e.preventDefault()\n                lockMap[e.keyCode] && lockMap[e.keyCode]()\n            }\n        }\n    }\n\n    window.onkeyup = (e) => {\n        if (e.keyCode == ctrlKey) {\n            isCtrlDown = false\n        }\n    }\n}\n\n```\n\nä¸ºäº†é˜²æ­¢å’Œæµè§ˆå™¨é»˜è®¤å¿«æ·é”®å†²çªï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š `e.preventDefault()`ã€‚\n\n### 23. ç½‘æ ¼çº¿\nç½‘æ ¼çº¿åŠŸèƒ½ä½¿ç”¨ `SVG` æ¥å®ç°ï¼š\n```html\n<template>\n    <svg class=\"grid\" width=\"100%\" height=\"100%\" xmlns=\"http://www.w3.org/2000/svg\">\n        <defs>\n            <pattern id=\"smallGrid\" width=\"7.236328125\" height=\"7.236328125\" patternUnits=\"userSpaceOnUse\">\n                <path \n                    d=\"M 7.236328125 0 L 0 0 0 7.236328125\" \n                    fill=\"none\" \n                    stroke=\"rgba(207, 207, 207, 0.3)\" \n                    stroke-width=\"1\">\n                </path>\n            </pattern>\n            <pattern id=\"grid\" width=\"36.181640625\" height=\"36.181640625\" patternUnits=\"userSpaceOnUse\">\n                <rect width=\"36.181640625\" height=\"36.181640625\" fill=\"url(#smallGrid)\"></rect>\n                <path \n                    d=\"M 36.181640625 0 L 0 0 0 36.181640625\" \n                    fill=\"none\" \n                    stroke=\"rgba(186, 186, 186, 0.5)\" \n                    stroke-width=\"1\">\n                </path>\n            </pattern>\n        </defs>\n        <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\"></rect>\n    </svg>\n</template>\n\n<style lang=\"scss\" scoped>\n.grid {\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n</style>\n\n```\nå¯¹ SVG ä¸å¤ªæ‡‚çš„ï¼Œå»ºè®®çœ‹ä¸€ä¸‹ [MDN çš„æ•™ç¨‹](https://developer.mozilla.org/zh-CN/docs/Web/SVG)ã€‚\n\n### 24. ç¼–è¾‘å™¨å¿«ç…§çš„å¦ä¸€ç§å®ç°æ–¹å¼\nåœ¨ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ä¸­ï¼Œæˆ‘å·²ç»åˆ†æè¿‡å¿«ç…§çš„å®ç°åŸç†ã€‚\n```js\nsnapshotData: [], // ç¼–è¾‘å™¨å¿«ç…§æ•°æ®\nsnapshotIndex: -1, // å¿«ç…§ç´¢å¼•\n        \nundo(state) {\n    if (state.snapshotIndex >= 0) {\n        state.snapshotIndex--\n        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))\n    }\n},\n\nredo(state) {\n    if (state.snapshotIndex < state.snapshotData.length - 1) {\n        state.snapshotIndex++\n        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))\n    }\n},\n\nsetComponentData(state, componentData = []) {\n    Vue.set(state, 'componentData', componentData)\n},\n\nrecordSnapshot(state) {\n    // æ·»åŠ æ–°çš„å¿«ç…§\n    state.snapshotData[++state.snapshotIndex] = deepCopy(state.componentData)\n    // åœ¨ undo è¿‡ç¨‹ä¸­ï¼Œæ·»åŠ æ–°çš„å¿«ç…§æ—¶ï¼Œè¦å°†å®ƒåé¢çš„å¿«ç…§æ¸…ç†æ‰\n    if (state.snapshotIndex < state.snapshotData.length - 1) {\n        state.snapshotData = state.snapshotData.slice(0, state.snapshotIndex + 1)\n    }\n},\n```\nç”¨ä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜ç¼–è¾‘å™¨çš„å¿«ç…§æ•°æ®ã€‚ä¿å­˜å¿«ç…§å°±æ˜¯ä¸åœåœ°æ‰§è¡Œ `push()` æ“ä½œï¼Œå°†å½“å‰çš„ç¼–è¾‘å™¨æ•°æ®æ¨å…¥ `snapshotData` æ•°ç»„ï¼Œå¹¶å¢åŠ å¿«ç…§ç´¢å¼• `snapshotIndexã€‚`\nç”±äºæ¯ä¸€æ¬¡æ·»åŠ å¿«ç…§éƒ½æ˜¯å°†å½“å‰ç¼–è¾‘å™¨çš„æ‰€æœ‰ç»„ä»¶æ•°æ®æ¨å…¥ `snapshotData`ï¼Œä¿å­˜çš„å¿«ç…§æ•°æ®è¶Šå¤šå ç”¨çš„å†…å­˜å°±è¶Šå¤šã€‚å¯¹æ­¤æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š\n\n1. é™åˆ¶å¿«ç…§æ­¥æ•°ï¼Œä¾‹å¦‚åªèƒ½ä¿å­˜ 50 æ­¥çš„å¿«ç…§æ•°æ®ã€‚\n2. ä¿å­˜å¿«ç…§åªä¿å­˜å·®å¼‚éƒ¨åˆ†ã€‚\n\nç°åœ¨è¯¦ç»†æè¿°ä¸€ä¸‹ç¬¬äºŒä¸ªè§£å†³æ–¹æ¡ˆã€‚\nå‡è®¾ä¾æ¬¡å¾€ç”»å¸ƒä¸Šæ·»åŠ  a b c d å››ä¸ªç»„ä»¶ï¼Œåœ¨åŸæ¥çš„å®ç°ä¸­ï¼Œå¯¹åº”çš„ `snapshotData` æ•°æ®ä¸ºï¼š\n\n```\n// snapshotData\n[\n  [a],\n  [a, b],\n  [a, b, c],\n  [a, b, c, d],\n]\n```\n\nä»ä¸Šé¢çš„ä»£ç å¯ä»¥å‘ç°ï¼Œæ¯ä¸€ç›¸é‚»çš„å¿«ç…§ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ•°æ®æ˜¯ä¸åŒçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸€æ­¥çš„å¿«ç…§æ·»åŠ ä¸€ä¸ªç±»å‹å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºæ­¤æ¬¡æ“ä½œæ˜¯æ·»åŠ è¿˜æ˜¯åˆ é™¤ã€‚\n\né‚£ä¹ˆä¸Šé¢æ·»åŠ å››ä¸ªç»„ä»¶çš„æ“ä½œï¼Œæ‰€å¯¹åº”çš„ `snapshotData` æ•°æ®ä¸ºï¼š\n\n```\n// snapshotData\n[\n  [{ type: 'add', value: a }],\n  [{ type: 'add', value: b }],\n  [{ type: 'add', value: c }],\n  [{ type: 'add', value: d }],\n]\n```\n\nå¦‚æœæˆ‘ä»¬è¦åˆ é™¤ c ç»„ä»¶ï¼Œé‚£ä¹ˆ `snapshotData` æ•°æ®å°†å˜ä¸ºï¼š\n\n```\n// snapshotData\n[\n  [{ type: 'add', value: a }],\n  [{ type: 'add', value: b }],\n  [{ type: 'add', value: c }],\n  [{ type: 'add', value: d }],\n  [{ type: 'remove', value: c }],\n]\n```\n\né‚£å¦‚ä½•ä½¿ç”¨ç°åœ¨çš„å¿«ç…§æ•°æ®å‘¢ï¼Ÿ\n\næˆ‘ä»¬éœ€è¦éå†ä¸€éå¿«ç…§æ•°æ®ï¼Œæ¥ç”Ÿæˆç¼–è¾‘å™¨çš„ç»„ä»¶æ•°æ® `componentData`ã€‚å‡è®¾åœ¨ä¸Šé¢çš„æ•°æ®åŸºç¡€ä¸Šæ‰§è¡Œäº† `undo` æ’¤é”€æ“ä½œï¼š\n\n```\n// snapshotData\n// å¿«ç…§ç´¢å¼• snapshotIndex æ­¤æ—¶ä¸º 3\n[\n  [{ type: 'add', value: a }],\n  [{ type: 'add', value: b }],\n  [{ type: 'add', value: c }],\n  [{ type: 'add', value: d }],\n  [{ type: 'remove', value: c }],\n]\n```\n\n1. snapshotData[0] ç±»å‹ä¸º addï¼Œå°†ç»„ä»¶ a æ·»åŠ åˆ° componentData ä¸­ï¼Œæ­¤æ—¶ componentData ä¸º [a]\n2. ä¾æ¬¡ç±»æ¨ [a, b]\n3. [a, b, c]\n4. [a, b, c, d]\n\nå¦‚æœè¿™æ—¶æ‰§è¡Œ `redo` é‡åšæ“ä½œï¼Œå¿«ç…§ç´¢å¼• `snapshotIndex` å˜ä¸º 4ã€‚å¯¹åº”çš„å¿«ç…§æ•°æ®ç±»å‹ä¸º `type: 'remove'`ï¼Œ ç§»é™¤ç»„ä»¶ cã€‚åˆ™æ•°ç»„æ•°æ®ä¸º` [a, b, d]`ã€‚\nè¿™ç§æ–¹æ³•å…¶å®å°±æ˜¯æ—¶é—´æ¢ç©ºé—´ï¼Œè™½ç„¶æ¯ä¸€æ¬¡ä¿å­˜çš„å¿«ç…§æ•°æ®åªæœ‰ä¸€é¡¹ï¼Œä½†æ¯æ¬¡éƒ½å¾—éå†ä¸€éæ‰€æœ‰çš„å¿«ç…§æ•°æ®ã€‚ä¸¤ç§æ–¹æ³•éƒ½ä¸å®Œç¾ï¼Œè¦ä½¿ç”¨å“ªç§å–å†³äºä½ ï¼Œç›®å‰æˆ‘ä»åœ¨ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ã€‚",
      "data": {
        "title": "å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆä¸‰ï¼‰",
        "date": "2021-02-17 03:49:47",
        "tags": [],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "-lcqVVhek"
    },
    {
      "content": "æœ¬æ–‡æ‘˜è‡ª[æ˜é‡‘](https://juejin.cn/post/6918881497264947207),å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘\n\nä¸Šä¸€ç¯‡æ–‡ç« ä¸»è¦è®²è§£äº†ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç‚¹ï¼š\n\n1. ç¼–è¾‘å™¨\n2. è‡ªå®šä¹‰ç»„ä»¶\n3. æ‹–æ‹½\n4. åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§\n5. æ”¾å¤§ç¼©å°\n6. æ’¤æ¶ˆã€é‡åš\n7. ç»„ä»¶å±æ€§è®¾ç½®\n8. å¸é™„\n9. é¢„è§ˆã€ä¿å­˜ä»£ç \n10. ç»‘å®šäº‹ä»¶\n11. ç»‘å®šåŠ¨ç”»\n12. å¯¼å…¥ PSD\n13. æ‰‹æœºæ¨¡å¼\n\nç°åœ¨è¿™ç¯‡æ–‡ç« ä¼šåœ¨æ­¤åŸºç¡€ä¸Šå†è¡¥å…… 4 ä¸ªåŠŸèƒ½ç‚¹ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\n* æ‹–æ‹½æ—‹è½¬\n* å¤åˆ¶ç²˜è´´å‰ªåˆ‡\n* æ•°æ®äº¤äº’\n* å‘å¸ƒ\nå’Œä¸Šç¯‡æ–‡ç« ä¸€æ ·ï¼Œæˆ‘å·²ç»å°†æ–°åŠŸèƒ½çš„ä»£ç æ›´æ–°åˆ°äº† githubï¼š\n\n[github é¡¹ç›®åœ°å€](https://github.com/woai3c/visual-drag-demo)\n\n[åœ¨çº¿é¢„è§ˆ](https://woai3c.github.io/visual-drag-demo/#/)\n\n**å‹å–„æé†’**ï¼š å»ºè®®ç»“åˆæºç ä¸€èµ·é˜…è¯»ï¼Œæ•ˆæœæ›´å¥½ï¼ˆè¿™ä¸ª DEMO ä½¿ç”¨çš„æ˜¯ Vue æŠ€æœ¯æ ˆï¼‰ã€‚\n\n### 14. æ‹–æ‹½æ—‹è½¬\n\nåœ¨å†™ä¸Šä¸€ç¯‡æ–‡ç« æ—¶ï¼ŒåŸæ¥çš„ DEMO å·²ç»å¯ä»¥æ”¯æŒæ—‹è½¬åŠŸèƒ½äº†ã€‚ä½†æ˜¯è¿™ä¸ªæ—‹è½¬åŠŸèƒ½è¿˜æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼š\n\n1. ä¸æ”¯æŒæ‹–æ‹½æ—‹è½¬ã€‚\n2. æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ä¸æ­£ç¡®ã€‚\n3. æ—‹è½¬åçš„è‡ªåŠ¨å¸é™„ä¸æ­£ç¡®ã€‚\n4. æ—‹è½¬åå…«ä¸ªå¯ä¼¸ç¼©ç‚¹çš„å…‰æ ‡ä¸æ­£ç¡®ã€‚\n\nè¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†é€ä¸€è§£å†³è¿™å››ä¸ªé—®é¢˜ã€‚\n\n#### æ‹–æ‹½æ—‹è½¬\n\næ‹–æ‹½æ—‹è½¬éœ€è¦ä½¿ç”¨ [`Math.atan2() `](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Math/atan2)å‡½æ•°ã€‚\n>Math.atan2() è¿”å›ä»åŸç‚¹(0,0)åˆ°(x,y)ç‚¹çš„çº¿æ®µä¸xè½´æ­£æ–¹å‘ä¹‹é—´çš„å¹³é¢è§’åº¦(å¼§åº¦å€¼)ï¼Œä¹Ÿå°±æ˜¯Math.atan2(y,x)ã€‚Math.atan2(y,x)ä¸­çš„yå’Œxéƒ½æ˜¯ç›¸å¯¹äºåœ†ç‚¹(0,0)çš„è·ç¦»ã€‚\n\nç®€å•çš„è¯´å°±æ˜¯ä»¥ç»„ä»¶ä¸­å¿ƒç‚¹ä¸ºåŸç‚¹` (centerX,centerY)`ï¼Œç”¨æˆ·æŒ‰ä¸‹é¼ æ ‡æ—¶çš„åæ ‡è®¾ä¸º `(startX,startY)`ï¼Œé¼ æ ‡ç§»åŠ¨æ—¶çš„åæ ‡è®¾ä¸º` (curX,curY)`ã€‚æ—‹è½¬è§’åº¦å¯ä»¥é€šè¿‡ `(startX,startY) `å’Œ `(curX,curY) `è®¡ç®—å¾—å‡ºã€‚\n![](https://panyu97py.github.io/post-images/1613501916438.png)\n\né‚£æˆ‘ä»¬å¦‚ä½•å¾—åˆ°ä»ç‚¹ ` (startX,startY) `åˆ°ç‚¹` (curX,curY) `ä¹‹é—´çš„æ—‹è½¬è§’åº¦å‘¢ï¼Ÿ\n\n**ç¬¬ä¸€æ­¥**ï¼Œé¼ æ ‡ç‚¹å‡»æ—¶çš„åæ ‡è®¾ä¸º` (startX,startY)`ï¼š\n\n```js\nconst startY = e.clientY\nconst startX = e.clientX\n```\n\n**ç¬¬äºŒæ­¥**ï¼Œç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š\n```js\n// è·å–ç»„ä»¶ä¸­å¿ƒç‚¹ä½ç½®\nconst rect = this.$el.getBoundingClientRect()\nconst centerX = rect.left + rect.width / 2\nconst centerY = rect.top + rect.height / 2\n```\n**ç¬¬ä¸‰æ­¥**ï¼ŒæŒ‰ä½é¼ æ ‡ç§»åŠ¨æ—¶çš„åæ ‡è®¾ä¸º` (curX,curY)`ï¼š\n\n```js\nconst curX = moveEvent.clientX\nconst curY = moveEvent.clientY\n```\n\n**ç¬¬å››æ­¥**ï¼Œåˆ†åˆ«ç®—å‡º` (startX,startY) `å’Œ` (curX,curY)` å¯¹åº”çš„è§’åº¦ï¼Œå†å°†å®ƒä»¬ç›¸å‡å¾—å‡ºæ—‹è½¬çš„è§’åº¦ã€‚å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çš„å°±æ˜¯ `Math.atan2() `æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¼§åº¦ï¼Œå› æ­¤è¿˜éœ€è¦å°†å¼§åº¦è½¬åŒ–ä¸ºè§’åº¦ã€‚æ‰€ä»¥å®Œæ•´çš„ä»£ç ä¸ºï¼š\n\n```js\n// æ—‹è½¬å‰çš„è§’åº¦\nconst rotateDegreeBefore = Math.atan2(startY - centerY, startX - centerX) / (Math.PI / 180)\n// æ—‹è½¬åçš„è§’åº¦\nconst rotateDegreeAfter = Math.atan2(curY - centerY, curX - centerX) / (Math.PI / 180)\n// è·å–æ—‹è½¬çš„è§’åº¦å€¼ï¼Œ startRotate ä¸ºåˆå§‹è§’åº¦å€¼\npos.rotate = startRotate + rotateDegreeAfter - rotateDegreeBefore\n```\n\n![](https://panyu97py.github.io/post-images/1613502114333.gif)\n\n#### æ”¾å¤§ç¼©å°\n\nç»„ä»¶æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ä¼šæœ‰ BUGã€‚\n\n![](https://panyu97py.github.io/post-images/1613502171703.gif)\n\nä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ”¾å¤§ç¼©å°æ—¶ä¼šå‘ç”Ÿç§»ä½ã€‚å¦å¤–ä¼¸ç¼©çš„æ–¹å‘å’Œæˆ‘ä»¬æ‹–åŠ¨çš„æ–¹å‘ä¹Ÿä¸å¯¹ã€‚é€ æˆè¿™ä¸€ BUG çš„åŸå› æ˜¯ï¼šå½“åˆè®¾è®¡æ”¾å¤§ç¼©å°åŠŸèƒ½æ²¡æœ‰è€ƒè™‘åˆ°æ—‹è½¬çš„åœºæ™¯ã€‚æ‰€ä»¥æ— è®ºæ—‹è½¬å¤šå°‘è§’åº¦ï¼Œæ”¾å¤§ç¼©å°ä»ç„¶æ˜¯æŒ‰æ²¡æ—‹è½¬æ—¶è®¡ç®—çš„ã€‚\n\nä¸‹é¢å†çœ‹ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š\n\n![](https://panyu97py.github.io/post-images/1613502210577.png)\n\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ²¡æœ‰æ—‹è½¬æ—¶ï¼ŒæŒ‰ä½é¡¶ç‚¹å¾€ä¸Šæ‹–åŠ¨ï¼Œåªéœ€ç”¨ `y2 - y1` å°±å¯ä»¥å¾—å‡ºæ‹–åŠ¨è·ç¦»` s`ã€‚è¿™æ—¶å°†ç»„ä»¶åŸæ¥çš„é«˜åº¦åŠ ä¸Š `s` å°±èƒ½å¾—å‡ºæ–°çš„é«˜åº¦ï¼ŒåŒæ—¶å°†ç»„ä»¶çš„ `top`ã€`left` å±æ€§æ›´æ–°ã€‚\n\n![](https://panyu97py.github.io/post-images/1613502283095.png)\n\nç°åœ¨æ—‹è½¬ 180 åº¦ï¼Œå¦‚æœè¿™æ—¶æ‹–ä½é¡¶ç‚¹å¾€ä¸‹æ‹–åŠ¨ï¼Œæˆ‘ä»¬æœŸå¾…çš„ç»“æœæ˜¯ç»„ä»¶é«˜åº¦å¢åŠ ã€‚ä½†è¿™æ—¶è®¡ç®—çš„æ–¹å¼å’ŒåŸæ¥æ²¡æ—‹è½¬æ—¶æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç»“æœå’Œæˆ‘ä»¬æœŸå¾…çš„ç›¸åï¼Œç»„ä»¶çš„é«˜åº¦å°†ä¼šå˜å°ï¼ˆå¦‚æœä¸ç†è§£è¿™ä¸ªç°è±¡ï¼Œå¯ä»¥æƒ³åƒä¸€ä¸‹æ²¡æœ‰æ—‹è½¬çš„é‚£å¼ å›¾ï¼ŒæŒ‰ä½é¡¶ç‚¹å¾€ä¸‹æ‹–åŠ¨ï¼‰ã€‚\n\n![](https://panyu97py.github.io/post-images/1613502327476.gif)\n\nå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä» github ä¸Šçš„ä¸€ä¸ªé¡¹ç›®[ `snapping-demo` ](https://github.com/shenhudong/snapping-demo/wiki/corner-handle)æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼šå°†æ”¾å¤§ç¼©å°å’Œæ—‹è½¬è§’åº¦å…³è”èµ·æ¥ã€‚\n\n##### è§£å†³æ–¹æ¡ˆ\nä¸‹é¢æ˜¯ä¸€ä¸ªå·²æ—‹è½¬ä¸€å®šè§’åº¦çš„çŸ©å½¢ï¼Œå‡è®¾ç°åœ¨æ‹–åŠ¨å®ƒå·¦ä¸Šæ–¹çš„ç‚¹è¿›è¡Œæ‹‰ä¼¸ã€‚\n\n![](https://panyu97py.github.io/post-images/1613502421743.png)\n\nç°åœ¨æˆ‘ä»¬å°†ä¸€æ­¥æ­¥åˆ†æå¦‚ä½•å¾—å‡ºæ‹‰ä¼¸åçš„ç»„ä»¶çš„æ­£ç¡®å¤§å°å’Œä½ç§»ã€‚\n\n**ç¬¬ä¸€æ­¥**ï¼ŒæŒ‰ä¸‹é¼ æ ‡æ—¶é€šè¿‡ç»„ä»¶çš„åæ ‡ï¼ˆæ— è®ºæ—‹è½¬å¤šå°‘åº¦ï¼Œç»„ä»¶çš„ top left å±æ€§ä¸å˜ï¼‰å’Œå¤§å°ç®—å‡ºç»„ä»¶ä¸­å¿ƒç‚¹ï¼š\n\n```js\nconst center = {\n    x: style.left + style.width / 2,\n    y: style.top + style.height / 2,\n}\n```\n\n**ç¬¬äºŒæ­¥**ï¼Œç”¨**å½“å‰ç‚¹å‡»åæ ‡**å’Œ**ç»„ä»¶ä¸­å¿ƒç‚¹ç®—**å‡ºå½“å‰ç‚¹å‡»åæ ‡çš„å¯¹ç§°ç‚¹åæ ‡ï¼š\n```js\n// è·å–ç”»å¸ƒä½ç§»ä¿¡æ¯\nconst editorRectInfo = document.querySelector('#editor').getBoundingClientRect()\n\n// å½“å‰ç‚¹å‡»åæ ‡\nconst curPoint = {\n    x: e.clientX - editorRectInfo.left,\n    y: e.clientY - editorRectInfo.top,\n}\n\n// è·å–å¯¹ç§°ç‚¹çš„åæ ‡\nconst symmetricPoint = {\n    x: center.x - (curPoint.x - center.x),\n    y: center.y - (curPoint.y - center.y),\n}\n```\n**ç¬¬ä¸‰æ­¥**ï¼Œæ‘ä½ç»„ä»¶å·¦ä¸Šè§’è¿›è¡Œæ‹‰ä¼¸æ—¶ï¼Œé€šè¿‡å½“å‰é¼ æ ‡å®æ—¶åæ ‡å’Œå¯¹ç§°ç‚¹è®¡ç®—å‡ºæ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ï¼š\n\n```js\nconst curPositon = {\n    x: moveEvent.clientX - editorRectInfo.left,\n    y: moveEvent.clientY - editorRectInfo.top,\n}\n\nconst newCenterPoint = getCenterPoint(curPositon, symmetricPoint)\n\n// æ±‚ä¸¤ç‚¹ä¹‹é—´çš„ä¸­ç‚¹åæ ‡\nfunction getCenterPoint(p1, p2) {\n    return {\n        x: p1.x + ((p2.x - p1.x) / 2),\n        y: p1.y + ((p2.y - p1.y) / 2),\n    }\n}\n```\n\nç”±äºç»„ä»¶å¤„äºæ—‹è½¬çŠ¶æ€ï¼Œå³ä½¿ä½ çŸ¥é“äº†æ‹‰ä¼¸æ—¶ç§»åŠ¨çš„` xy `è·ç¦»ï¼Œä¹Ÿä¸èƒ½ç›´æ¥å¯¹ç»„ä»¶è¿›è¡Œè®¡ç®—ã€‚å¦åˆ™å°±ä¼šå‡ºç° BUGï¼Œç§»ä½æˆ–è€…æ”¾å¤§ç¼©å°æ–¹å‘ä¸æ­£ç¡®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æœªæ—‹è½¬çš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œè®¡ç®—ã€‚\n\n![](https://panyu97py.github.io/post-images/1613502562307.png)\n\n**ç¬¬å››æ­¥**ï¼Œæ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å½“å‰é¼ æ ‡å®æ—¶åæ ‡å¯ä»¥ç®—å‡ºå½“å‰é¼ æ ‡å®æ—¶åæ ‡ `currentPosition` åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ `newTopLeftPoint`ã€‚åŒæ—¶ä¹Ÿèƒ½æ ¹æ®å·²çŸ¥çš„æ—‹è½¬è§’åº¦ã€æ–°çš„ç»„ä»¶ä¸­å¿ƒç‚¹ã€å¯¹ç§°ç‚¹ç®—å‡ºç»„ä»¶å¯¹ç§°ç‚¹ `sPoint` åœ¨æœªæ—‹è½¬æ—¶çš„åæ ‡ `newBottomRightPoint`ã€‚\nå¯¹åº”çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š\n\n```js\n/**\n * è®¡ç®—æ ¹æ®åœ†å¿ƒæ—‹è½¬åçš„ç‚¹çš„åæ ‡\n * @param   {Object}  point  æ—‹è½¬å‰çš„ç‚¹åæ ‡\n * @param   {Object}  center æ—‹è½¬ä¸­å¿ƒ\n * @param   {Number}  rotate æ—‹è½¬çš„è§’åº¦\n * @return  {Object}         æ—‹è½¬åçš„åæ ‡\n * https://www.zhihu.com/question/67425734/answer/252724399 æ—‹è½¬çŸ©é˜µå…¬å¼\n */\nexport function calculateRotatedPointCoordinate(point, center, rotate) {\n    /**\n     * æ—‹è½¬å…¬å¼ï¼š\n     *  ç‚¹a(x, y)\n     *  æ—‹è½¬ä¸­å¿ƒc(x, y)\n     *  æ—‹è½¬åç‚¹n(x, y)\n     *  æ—‹è½¬è§’åº¦Î¸                tan ??\n     * nx = cosÎ¸ * (ax - cx) - sinÎ¸ * (ay - cy) + cx\n     * ny = sinÎ¸ * (ax - cx) + cosÎ¸ * (ay - cy) + cy\n     */\n\n    return {\n        x: (point.x - center.x) * Math.cos(angleToRadian(rotate)) - (point.y - center.y) * Math.sin(angleToRadian(rotate)) + center.x,\n        y: (point.x - center.x) * Math.sin(angleToRadian(rotate)) + (point.y - center.y) * Math.cos(angleToRadian(rotate)) + center.y,\n    }\n}\n```\n\nä¸Šé¢çš„å…¬å¼æ¶‰åŠåˆ°çº¿æ€§ä»£æ•°ä¸­æ—‹è½¬çŸ©é˜µçš„çŸ¥è¯†ï¼Œå¯¹äºä¸€ä¸ªæ²¡ä¸Šè¿‡å¤§å­¦çš„äººæ¥è¯´ï¼Œå®åœ¨å¤ªéš¾äº†ã€‚è¿˜å¥½æˆ‘ä»[çŸ¥ä¹ä¸Šçš„ä¸€ä¸ªå›ç­”](https://www.zhihu.com/question/67425734/answer/252724399)ä¸­æ‰¾åˆ°äº†è¿™ä¸€å…¬å¼çš„æ¨ç†è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯å›ç­”çš„åŸæ–‡ï¼š\n\n![](https://panyu97py.github.io/post-images/1613502683980.png)\n\n![](https://panyu97py.github.io/post-images/1613502701696.png)\n\né€šè¿‡ä»¥ä¸Šå‡ ä¸ªè®¡ç®—å€¼ï¼Œå°±å¯ä»¥å¾—åˆ°ç»„ä»¶æ–°çš„ä½ç§»å€¼` top`ã€` left` ä»¥åŠæ–°çš„ç»„ä»¶å¤§å°ã€‚å¯¹åº”çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n\n```js\nfunction calculateLeftTop(style, curPositon, pointInfo) {\n    const { symmetricPoint } = pointInfo\n    const newCenterPoint = getCenterPoint(curPositon, symmetricPoint)\n    const newTopLeftPoint = calculateRotatedPointCoordinate(curPositon, newCenterPoint, -style.rotate)\n    const newBottomRightPoint = calculateRotatedPointCoordinate(symmetricPoint, newCenterPoint, -style.rotate)\n  \n    const newWidth = newBottomRightPoint.x - newTopLeftPoint.x\n    const newHeight = newBottomRightPoint.y - newTopLeftPoint.y\n    if (newWidth > 0 && newHeight > 0) {\n        style.width = Math.round(newWidth)\n        style.height = Math.round(newHeight)\n        style.left = Math.round(newTopLeftPoint.x)\n        style.top = Math.round(newTopLeftPoint.y)\n    }\n}\n```\n\nç°åœ¨å†æ¥çœ‹ä¸€ä¸‹æ—‹è½¬åçš„æ”¾å¤§ç¼©å°ï¼š\n\n![](https://panyu97py.github.io/post-images/1613502785374.gif)\n\n#### è‡ªåŠ¨å¸é™„\n\nè‡ªåŠ¨å¸é™„æ˜¯æ ¹æ®ç»„ä»¶çš„å››ä¸ªå±æ€§ `top`ã€`left` ã€`width` ã€`height` è®¡ç®—çš„ï¼Œåœ¨å°†ç»„ä»¶è¿›è¡Œæ—‹è½¬åï¼Œè¿™äº›å±æ€§çš„å€¼æ˜¯ä¸ä¼šå˜çš„ã€‚æ‰€ä»¥æ— è®ºç»„ä»¶æ—‹è½¬å¤šå°‘åº¦ï¼Œå¸é™„æ—¶ä»ç„¶æŒ‰æœªæ—‹è½¬æ—¶è®¡ç®—ã€‚è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè™½ç„¶å®é™…ä¸Šç»„ä»¶çš„ `top`ã€`left` ã€`width` ã€`height` å±æ€§æ²¡æœ‰å˜åŒ–ã€‚ä½†åœ¨å¤–è§‚ä¸Šå´å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢æ˜¯ä¸¤ä¸ªåŒæ ·çš„ç»„ä»¶ï¼šä¸€ä¸ªæ²¡æ—‹è½¬ï¼Œä¸€ä¸ªæ—‹è½¬äº† 45 åº¦ã€‚\n\n![](https://panyu97py.github.io/post-images/1613502878822.png)\n\nå¯ä»¥çœ‹å‡ºæ¥æ—‹è½¬åæŒ‰é’®çš„ `height` å±æ€§å’Œæˆ‘ä»¬ä»å¤–è§‚ä¸Šçœ‹åˆ°çš„é«˜åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å°±å‡ºç°äº†å¸é™„ä¸æ­£ç¡®çš„ BUGã€‚\n\n![](https://panyu97py.github.io/post-images/1613502923904.gif)\n\n##### è§£å†³æ–¹æ¡ˆ\n\nå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬éœ€è¦æ‹¿ç»„ä»¶æ—‹è½¬åçš„å¤§å°åŠä½ç§»æ¥åšå¸é™„å¯¹æ¯”ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸è¦æ‹¿ç»„ä»¶å®é™…çš„å±æ€§æ¥å¯¹æ¯”ï¼Œè€Œæ˜¯æ‹¿æˆ‘ä»¬çœ‹åˆ°çš„å¤§å°å’Œä½ç§»åšå¯¹æ¯”ã€‚\n\n![](https://panyu97py.github.io/post-images/1613502993620.png)\n\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ—‹è½¬åçš„ç»„ä»¶åœ¨ x è½´ä¸Šçš„æŠ•å°„é•¿åº¦ä¸ºä¸¤æ¡çº¢çº¿é•¿åº¦ä¹‹å’Œã€‚è¿™ä¸¤æ¡çº¢çº¿çš„é•¿åº¦å¯ä»¥é€šè¿‡æ­£å¼¦å’Œä½™å¼¦ç®—å‡ºï¼Œå·¦è¾¹çš„çº¢çº¿ç”¨æ­£å¼¦è®¡ç®—ï¼Œå³è¾¹çš„çº¢çº¿ç”¨ä½™å¼¦è®¡ç®—ï¼š\n\n```js\nconst newWidth = style.width * cos(style.rotate) + style.height * sin(style.rotate)\n```\nåŒç†ï¼Œé«˜åº¦ä¹Ÿæ˜¯ä¸€æ ·ï¼š\n\n```js\nconst newHeight = style.height * cos(style.rotate) + style.width * sin(style.rotate)\n```\næ–°çš„å®½åº¦å’Œé«˜åº¦æœ‰äº†ï¼Œå†æ ¹æ®ç»„ä»¶åŸæœ‰çš„ `top`ã€ `left` å±æ€§ï¼Œå¯ä»¥å¾—å‡ºç»„ä»¶æ—‹è½¬åæ–°çš„`top`ã€ `left`  å±æ€§ã€‚ä¸‹é¢é™„ä¸Šå®Œæ•´ä»£ç ï¼š\n\n```js\ntranslateComponentStyle(style) {\n    style = { ...style }\n    if (style.rotate != 0) {\n        const newWidth = style.width * cos(style.rotate) + style.height * sin(style.rotate)\n        const diffX = (style.width - newWidth) / 2\n        style.left += diffX\n        style.right = style.left + newWidth\n\n        const newHeight = style.height * cos(style.rotate) + style.width * sin(style.rotate)\n        const diffY = (newHeight - style.height) / 2\n        style.top -= diffY\n        style.bottom = style.top + newHeight\n\n        style.width = newWidth\n        style.height = newHeight\n    } else {\n        style.bottom = style.top + style.height\n        style.right = style.left + style.width\n    }\n\n    return style\n}\n```\n\nç»è¿‡ä¿®å¤åï¼Œå¸é™„ä¹Ÿå¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº†\n\n![](https://panyu97py.github.io/post-images/1613503143257.gif)\n\n#### å…‰æ ‡\n\nå…‰æ ‡å’Œå¯æ‹–åŠ¨çš„æ–¹å‘ä¸å¯¹ï¼Œæ˜¯å› ä¸ºå…«ä¸ªç‚¹çš„å…‰æ ‡æ˜¯å›ºå®šè®¾ç½®çš„ï¼Œæ²¡æœ‰éšç€è§’åº¦å˜åŒ–è€Œå˜åŒ–ã€‚\n\n![](https://panyu97py.github.io/post-images/1613503197769.gif)\n\n##### è§£å†³æ–¹æ¡ˆ\n\nç”±äº `360 / 8 = 45`ï¼Œæ‰€ä»¥å¯ä»¥ä¸ºæ¯ä¸€ä¸ªæ–¹å‘åˆ†é… 45 åº¦çš„èŒƒå›´ï¼Œæ¯ä¸ªèŒƒå›´å¯¹åº”ä¸€ä¸ªå…‰æ ‡ã€‚åŒæ—¶ä¸ºæ¯ä¸ªæ–¹å‘è®¾ç½®ä¸€ä¸ªåˆå§‹è§’åº¦ï¼Œä¹Ÿå°±æ˜¯æœªæ—‹è½¬æ—¶ç»„ä»¶æ¯ä¸ªæ–¹å‘å¯¹åº”çš„è§’åº¦ã€‚\n\n![](https://panyu97py.github.io/post-images/1613503255637.png)\n\n```js\npointList: ['lt', 't', 'rt', 'r', 'rb', 'b', 'lb', 'l'], // å…«ä¸ªæ–¹å‘\ninitialAngle: { // æ¯ä¸ªç‚¹å¯¹åº”çš„åˆå§‹è§’åº¦\n    lt: 0,\n    t: 45,\n    rt: 90,\n    r: 135,\n    rb: 180,\n    b: 225,\n    lb: 270,\n    l: 315,\n},\nangleToCursor: [ // æ¯ä¸ªèŒƒå›´çš„è§’åº¦å¯¹åº”çš„å…‰æ ‡\n    { start: 338, end: 23, cursor: 'nw' },\n    { start: 23, end: 68, cursor: 'n' },\n    { start: 68, end: 113, cursor: 'ne' },\n    { start: 113, end: 158, cursor: 'e' },\n    { start: 158, end: 203, cursor: 'se' },\n    { start: 203, end: 248, cursor: 's' },\n    { start: 248, end: 293, cursor: 'sw' },\n    { start: 293, end: 338, cursor: 'w' },\n],\ncursors: {},\n```\nè®¡ç®—æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼š\n\n1. å‡è®¾ç°åœ¨ç»„ä»¶å·²æ—‹è½¬äº†ä¸€å®šçš„è§’åº¦ aã€‚\n2. éå†å…«ä¸ªæ–¹å‘ï¼Œç”¨æ¯ä¸ªæ–¹å‘çš„åˆå§‹è§’åº¦ + a å¾—å‡ºç°åœ¨çš„è§’åº¦ bã€‚\n3. éå† angleToCursor æ•°ç»„ï¼Œçœ‹çœ‹ b åœ¨å“ªä¸€ä¸ªèŒƒå›´ä¸­ï¼Œç„¶åå°†å¯¹åº”çš„å…‰æ ‡è¿”å›ã€‚\n\nç»è¿‡ä¸Šé¢ä¸‰ä¸ªæ­¥éª¤å°±å¯ä»¥è®¡ç®—å‡ºç»„ä»¶æ—‹è½¬åæ­£ç¡®çš„å…‰æ ‡æ–¹å‘ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š\n\n```js\ngetCursor() {\n    const { angleToCursor, initialAngle, pointList, curComponent } = this\n    const rotate = (curComponent.style.rotate + 360) % 360 // é˜²æ­¢è§’åº¦æœ‰è´Ÿæ•°ï¼Œæ‰€ä»¥ + 360\n    const result = {}\n    let lastMatchIndex = -1 // ä»ä¸Šä¸€ä¸ªå‘½ä¸­çš„è§’åº¦çš„ç´¢å¼•å¼€å§‹åŒ¹é…ä¸‹ä¸€ä¸ªï¼Œé™ä½æ—¶é—´å¤æ‚åº¦\n    pointList.forEach(point => {\n        const angle = (initialAngle[point] + rotate) % 360\n        const len = angleToCursor.length\n        while (true) {\n            lastMatchIndex = (lastMatchIndex + 1) % len\n            const angleLimit = angleToCursor[lastMatchIndex]\n            if (angle < 23 || angle >= 338) {\n                result[point] = 'nw-resize'\n                return\n            }\n\n            if (angleLimit.start <= angle && angle < angleLimit.end) {\n                result[point] = angleLimit.cursor + '-resize'\n                return\n            }\n        }\n    })\n\n    return result\n},\n```\n\n![](https://panyu97py.github.io/post-images/1613503358536.gif)\n\nä»ä¸Šé¢çš„åŠ¨å›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œç°åœ¨å…«ä¸ªæ–¹å‘ä¸Šçš„å…‰æ ‡æ˜¯å¯ä»¥æ­£ç¡®æ˜¾ç¤ºçš„ã€‚\n\n### 15. å¤åˆ¶ç²˜è´´å‰ªåˆ‡\n\nç›¸å¯¹äºæ‹–æ‹½æ—‹è½¬åŠŸèƒ½ï¼Œå¤åˆ¶ç²˜è´´å°±æ¯”è¾ƒç®€å•äº†ã€‚\n\n```js\nconst ctrlKey = 17, vKey = 86, cKey = 67, xKey = 88\nlet isCtrlDown = false\n\nwindow.onkeydown = (e) => {\n    if (e.keyCode == ctrlKey) {\n        isCtrlDown = true\n    } else if (isCtrlDown && e.keyCode == cKey) {\n        this.$store.commit('copy')\n    } else if (isCtrlDown && e.keyCode == vKey) {\n        this.$store.commit('paste')\n    } else if (isCtrlDown && e.keyCode == xKey) {\n        this.$store.commit('cut')\n    }\n}\n\nwindow.onkeyup = (e) => {\n    if (e.keyCode == ctrlKey) {\n        isCtrlDown = false\n    }\n}\n```\n\nç›‘å¬ç”¨æˆ·çš„æŒ‰é”®æ“ä½œï¼Œåœ¨æŒ‰ä¸‹ç‰¹å®šæŒ‰é”®æ—¶è§¦å‘å¯¹åº”çš„æ“ä½œã€‚\n\n##### å¤åˆ¶æ“ä½œ\n\nåœ¨ `vuex` ä¸­ä½¿ç”¨ `copyData` æ¥è¡¨ç¤ºå¤åˆ¶çš„æ•°æ®ã€‚å½“ç”¨æˆ·æŒ‰ä¸‹ `ctrl + c` æ—¶ï¼Œå°†å½“å‰ç»„ä»¶æ•°æ®æ·±æ‹·è´åˆ° `copyData`ã€‚\n\n```js\ncopy(state) {\n    state.copyData = {\n        data: deepCopy(state.curComponent),\n        index: state.curComponentIndex,\n    }\n},\n```\nåŒæ—¶éœ€è¦å°†å½“å‰ç»„ä»¶åœ¨ç»„ä»¶æ•°æ®ä¸­çš„ç´¢å¼•è®°å½•èµ·æ¥ï¼Œåœ¨å‰ªåˆ‡ä¸­è¦ç”¨åˆ°ã€‚\n\n##### ç²˜è´´æ“ä½œ\n\n```js\npaste(state, isMouse) {\n    if (!state.copyData) {\n        toast('è¯·é€‰æ‹©ç»„ä»¶')\n        return\n    }\n\n    const data = state.copyData.data\n\n    if (isMouse) {\n        data.style.top = state.menuTop\n        data.style.left = state.menuLeft\n    } else {\n        data.style.top += 10\n        data.style.left += 10\n    }\n\n    data.id = generateID()\n    store.commit('addComponent', { component: data })\n    store.commit('recordSnapshot')\n    state.copyData = null\n},\n```\n\nç²˜è´´æ—¶ï¼Œå¦‚æœæ˜¯æŒ‰é”®æ“ä½œ `ctrl+v`ã€‚åˆ™å°†ç»„ä»¶çš„ `top`ã€`left` å±æ€§åŠ  10ï¼Œä»¥å…å’ŒåŸæ¥çš„ç»„ä»¶é‡å åœ¨ä¸€èµ·ã€‚å¦‚æœæ˜¯ä½¿ç”¨é¼ æ ‡å³é”®æ‰§è¡Œç²˜è´´æ“ä½œï¼Œåˆ™å°†å¤åˆ¶çš„ç»„ä»¶æ”¾åˆ°é¼ æ ‡ç‚¹å‡»å¤„ã€‚\n\n##### å‰ªåˆ‡æ“ä½œ\n\n```js\ncut(state) {\n    if (!state.curComponent) {\n        toast('è¯·é€‰æ‹©ç»„ä»¶')\n        return\n    }\n\n    if (state.copyData) {\n        store.commit('addComponent', { component: state.copyData.data, index: state.copyData.index })\n        if (state.curComponentIndex >= state.copyData.index) {\n            // å¦‚æœå½“å‰ç»„ä»¶ç´¢å¼•å¤§äºç­‰äºæ’å…¥ç´¢å¼•ï¼Œéœ€è¦åŠ ä¸€ï¼Œå› ä¸ºå½“å‰ç»„ä»¶å¾€åç§»äº†ä¸€ä½\n            state.curComponentIndex++\n        }\n    }\n\n    store.commit('copy')\n    store.commit('deleteComponent')\n},\n```\nå‰ªåˆ‡æ“ä½œæœ¬è´¨ä¸Šè¿˜æ˜¯å¤åˆ¶ï¼Œåªä¸è¿‡åœ¨æ‰§è¡Œå¤åˆ¶åï¼Œéœ€è¦å°†å½“å‰ç»„ä»¶åˆ é™¤ã€‚ä¸ºäº†é¿å…ç”¨æˆ·æ‰§è¡Œå‰ªåˆ‡æ“ä½œåï¼Œä¸æ‰§è¡Œç²˜è´´æ“ä½œï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œå‰ªåˆ‡ã€‚è¿™æ—¶å°±éœ€è¦å°†åŸå…ˆå‰ªåˆ‡çš„æ•°æ®è¿›è¡Œæ¢å¤ã€‚æ‰€ä»¥å¤åˆ¶æ•°æ®ä¸­è®°å½•çš„ç´¢å¼•å°±èµ·ä½œç”¨äº†ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å°†åŸæ¥çš„æ•°æ®æ¢å¤åˆ°åŸæ¥çš„ä½ç½®ä¸­ã€‚\n\n##### å³é”®æ“ä½œ\n\nå³é”®æ“ä½œå’ŒæŒ‰é”®æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œä¸€ä¸ªåŠŸèƒ½ä¸¤ç§è§¦å‘é€”å¾„ã€‚\n\n```js\n<li @click=\"copy\" v-show=\"curComponent\">å¤åˆ¶</li>\n<li @click=\"paste\">ç²˜è´´</li>\n<li @click=\"cut\" v-show=\"curComponent\">å‰ªåˆ‡</li>\n\ncut() {\n    this.$store.commit('cut')\n},\n\ncopy() {\n    this.$store.commit('copy')\n},\n\npaste() {\n    this.$store.commit('paste', true)\n},\n```\n\n### 16. æ•°æ®äº¤äº’\n\n#### æ–¹å¼ä¸€\næå‰å†™å¥½ä¸€ç³»åˆ— `ajax` è¯·æ±‚`API`ï¼Œç‚¹å‡»ç»„ä»¶æ—¶æŒ‰éœ€é€‰æ‹©` API`ï¼Œé€‰å¥½ `API` å†å¡«å‚æ•°ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç»„ä»¶ï¼Œå°±å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `ajax` è¯·æ±‚å‘åå°äº¤äº’ï¼š\n\n```js\n<template>\n    <div>{{ propValue.data }}</div>\n</template>\n\n<script>\nexport default {\n    // propValue: {\n    //     api: {\n    //             request: a,\n    //             params,\n    //      },\n    //     data: null\n    // }\n    props: {\n        propValue: {\n            type: Object,\n            default: () => {},\n        },\n    },\n    created() {\n        this.propValue.api.request(this.propValue.api.params).then(res => {\n            this.propValue.data = res.data\n        })\n    },\n}\n</script>\n```\n\n#### æ–¹å¼äºŒ\næ–¹å¼äºŒé€‚åˆçº¯å±•ç¤ºçš„ç»„ä»¶ï¼Œä¾‹å¦‚æœ‰ä¸€ä¸ªæŠ¥è­¦ç»„ä»¶ï¼Œå¯ä»¥æ ¹æ®åå°ä¼ æ¥çš„æ•°æ®æ˜¾ç¤ºå¯¹åº”çš„é¢œè‰²ã€‚åœ¨ç¼–è¾‘é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ `ajax` å‘åå°è¯·æ±‚é¡µé¢èƒ½å¤Ÿä½¿ç”¨çš„ `websocket` æ•°æ®ï¼š\n\n```js\nconst data = ['status', 'text'...]\n```\n\nç„¶åå†ä¸ºä¸åŒçš„ç»„ä»¶æ·»åŠ ä¸Šä¸åŒçš„å±æ€§ã€‚ä¾‹å¦‚æœ‰ a ç»„ä»¶ï¼Œå®ƒç»‘å®šçš„å±æ€§ä¸º `status`ã€‚\n\n```js\n// ç»„ä»¶èƒ½æ¥æ”¶çš„æ•°æ®\nprops: {\n    propValue: {\n        type: String,\n    },\n    element: {\n        type: Object,\n    },\n    wsKey: {\n        type: String,\n        default: '',\n    },\n},\n```\n\nåœ¨ç»„ä»¶ä¸­é€šè¿‡ `wsKey` è·å–è¿™ä¸ªç»‘å®šçš„å±æ€§ã€‚ç­‰é¡µé¢å‘å¸ƒåæˆ–è€…é¢„è§ˆæ—¶ï¼Œé€šè¿‡ `weboscket` å‘åå°è¯·æ±‚å…¨å±€æ•°æ®æ”¾åœ¨ `vuex` ä¸Šã€‚ç»„ä»¶å°±å¯ä»¥é€šè¿‡ `wsKey` è®¿é—®æ•°æ®äº†ã€‚\n\n```js\n<template>\n    <div>{{ wsData[wsKey] }}</div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\n\nexport default {\n    props: {\n        propValue: {\n            type: String,\n        },\n        element: {\n            type: Object,\n        },\n        wsKey: {\n            type: String,\n            default: '',\n        },\n    },\n    computed: mapState([\n        'wsData',\n    ]),\n</script>\n```\nå’Œåå°äº¤äº’çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¸ä»…ä»…åŒ…æ‹¬ä¸Šé¢ä¸¤ç§ï¼Œæˆ‘åœ¨è¿™é‡Œä»…æä¾›ä¸€äº›æ€è·¯ï¼Œä»¥ä¾›å‚è€ƒã€‚\n\n### 17. å‘å¸ƒ\né¡µé¢å‘å¸ƒæœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€æ˜¯å°†ç»„ä»¶æ•°æ®æ¸²æŸ“ä¸ºä¸€ä¸ªå•ç‹¬çš„ HTML é¡µé¢ï¼›äºŒæ˜¯ä»æœ¬é¡¹ç›®ä¸­æŠ½å–å‡ºä¸€ä¸ªæœ€å°è¿è¡Œæ—¶ runtime ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ã€‚\nè¿™é‡Œè¯´ä¸€ä¸‹ç¬¬äºŒç§æ–¹å¼ï¼Œæœ¬é¡¹ç›®ä¸­çš„æœ€å°è¿è¡Œæ—¶å…¶å®å°±æ˜¯é¢„è§ˆé¡µé¢åŠ ä¸Šè‡ªå®šä¹‰ç»„ä»¶ã€‚å°†è¿™äº›ä»£ç æå–å‡ºæ¥ä½œä¸ºä¸€ä¸ªé¡¹ç›®å•ç‹¬æ‰“åŒ…ã€‚å‘å¸ƒé¡µé¢æ—¶å°†ç»„ä»¶æ•°æ®ä»¥ JSON çš„æ ¼å¼ä¼ ç»™æœåŠ¡ç«¯ï¼ŒåŒæ—¶ä¸ºæ¯ä¸ªé¡µé¢ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ IDã€‚\nå‡è®¾ç°åœ¨æœ‰ä¸‰ä¸ªé¡µé¢ï¼Œå‘å¸ƒé¡µé¢ç”Ÿæˆçš„ ID ä¸º aã€bã€cã€‚è®¿é—®é¡µé¢æ—¶åªéœ€è¦æŠŠ ID å¸¦ä¸Šï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ® ID è·å–æ¯ä¸ªé¡µé¢å¯¹åº”çš„ç»„ä»¶æ•°æ®ã€‚\n```\nwww.test.com/?id=a\nwww.test.com/?id=c\nwww.test.com/?id=b\n```\n\n#### æŒ‰éœ€åŠ è½½\nå¦‚æœè‡ªå®šä¹‰ç»„ä»¶è¿‡å¤§ï¼Œä¾‹å¦‚æœ‰æ•°åä¸ªç”šè‡³ä¸Šç™¾ä¸ªã€‚è¿™æ—¶å¯ä»¥å°†è‡ªå®šä¹‰ç»„ä»¶ç”¨ import çš„æ–¹å¼å¯¼å…¥ï¼Œåšåˆ°æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘é¦–å±æ¸²æŸ“æ—¶é—´ï¼š\n\n```js\nimport Vue from 'vue'\n\nconst components = [\n    'Picture',\n    'VText',\n    'VButton',\n]\n\ncomponents.forEach(key => {\n    Vue.component(key, () => import(`@/custom-component/${key}`))\n})\n```\n\n#### æŒ‰ç‰ˆæœ¬å‘å¸ƒ\n\nè‡ªå®šä¹‰ç»„ä»¶æœ‰å¯èƒ½ä¼šæœ‰æ›´æ–°çš„æƒ…å†µã€‚ä¾‹å¦‚åŸæ¥çš„ç»„ä»¶ä½¿ç”¨äº†å¤§åŠå¹´ï¼Œç°åœ¨æœ‰åŠŸèƒ½å˜æ›´ï¼Œä¸ºäº†ä¸å½±å“åŸæ¥çš„é¡µé¢ã€‚å»ºè®®åœ¨å‘å¸ƒæ—¶å¸¦ä¸Šç»„ä»¶çš„ç‰ˆæœ¬å·ï¼š\n```\n- v-text\n  - v1.vue\n  - v2.vue\n```\nä¾‹å¦‚ `v-text` ç»„ä»¶æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåœ¨å·¦ä¾§ç»„ä»¶åˆ—è¡¨åŒºä½¿ç”¨æ—¶å°±å¯ä»¥å¸¦ä¸Šç‰ˆæœ¬å·ï¼š\n```js\n{\n  component: 'v-text',\n  version: 'v1'\n  ...\n}\n```\nè¿™æ ·å¯¼å…¥ç»„ä»¶æ—¶å°±å¯ä»¥æ ¹æ®ç»„ä»¶ç‰ˆæœ¬å·è¿›è¡Œå¯¼å…¥ï¼š\n\n```js\nimport Vue from 'vue'\nimport componentList from '@/custom-component/component-list`\n\ncomponentList.forEach(component => {\n    Vue.component(component.name, () => import(`@/custom-component/${component.name}/${component.version}`))\n})\n```",
      "data": {
        "title": "å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆäºŒï¼‰",
        "date": "2021-02-17 02:52:40",
        "tags": [
          "vue"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "1yIc3meiD"
    },
    {
      "content": "æœ¬æ–‡æ‘˜è‡ª[æ˜é‡‘](https://juejin.cn/post/6908502083075325959),å†™çš„å¾ˆå¥½æŠ„å½•ä¸€ä¸‹ã€‚å»ºè®®å¤šå»ç»™åŸä½œè€…ç‚¹èµğŸ‘\n\næœ¬æ–‡ä¸»è¦å¯¹ä»¥ä¸‹æŠ€æœ¯è¦ç‚¹è¿›è¡Œåˆ†æï¼š\n\n1. ç¼–è¾‘å™¨\n2. è‡ªå®šä¹‰ç»„ä»¶\n3. æ‹–æ‹½\n4. åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§\n5. æ”¾å¤§ç¼©å°\n6. æ’¤æ¶ˆã€é‡åš\n7. ç»„ä»¶å±æ€§è®¾ç½®\n8. å¸é™„\n9. é¢„è§ˆã€ä¿å­˜ä»£ç \n10. ç»‘å®šäº‹ä»¶\n11. ç»‘å®šåŠ¨ç”»\n12. å¯¼å…¥ PSD\n13. æ‰‹æœºæ¨¡å¼\n\nä¸ºäº†è®©æœ¬æ–‡æ›´åŠ å®¹æ˜“ç†è§£ï¼Œæˆ‘å°†ä»¥ä¸ŠæŠ€æœ¯è¦ç‚¹ç»“åˆåœ¨ä¸€èµ·å†™äº†ä¸€ä¸ªå¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ DEMOï¼š\n\n[github é¡¹ç›®åœ°å€](https://github.com/woai3c/visual-drag-demo)\n\n[åœ¨çº¿é¢„è§ˆ](https://woai3c.github.io/visual-drag-demo/#/)\n\nå»ºè®®ç»“åˆæºç ä¸€èµ·é˜…è¯»ï¼Œæ•ˆæœæ›´å¥½ï¼ˆè¿™ä¸ª DEMO ä½¿ç”¨çš„æ˜¯ Vue æŠ€æœ¯æ ˆï¼‰ã€‚\n\n### 1. ç¼–è¾‘å™¨\n\nå…ˆæ¥çœ‹ä¸€ä¸‹é¡µé¢çš„æ•´ä½“ç»“æ„ã€‚\n![](https://panyu97py.github.io/post-images/1613497344188.png)\n\nè¿™ä¸€èŠ‚è¦è®²çš„ç¼–è¾‘å™¨å…¶å®å°±æ˜¯ä¸­é—´çš„ç”»å¸ƒã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼šå½“ä»å·¦è¾¹ç»„ä»¶åˆ—è¡¨æ‹–æ‹½å‡ºä¸€ä¸ªç»„ä»¶æ”¾åˆ°ç”»å¸ƒä¸­æ—¶ï¼Œç”»å¸ƒè¦æŠŠè¿™ä¸ªç»„ä»¶æ¸²æŸ“å‡ºæ¥ã€‚\nè¿™ä¸ªç¼–è¾‘å™¨çš„å®ç°æ€è·¯æ˜¯ï¼š\n\nç”¨ä¸€ä¸ªæ•°ç»„ `componentData` ç»´æŠ¤ç¼–è¾‘å™¨ä¸­çš„æ•°æ®ã€‚\næŠŠç»„ä»¶æ‹–æ‹½åˆ°ç”»å¸ƒä¸­æ—¶ï¼Œä½¿ç”¨ `push()` æ–¹æ³•å°†æ–°çš„ç»„ä»¶æ•°æ®æ·»åŠ åˆ° `componentData`ã€‚\nç¼–è¾‘å™¨ä½¿ç”¨ `v-for` æŒ‡ä»¤éå† `componentData`ï¼Œå°†æ¯ä¸ªç»„ä»¶é€ä¸ªæ¸²æŸ“åˆ°ç”»å¸ƒï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ `JSX`è¯­æ³•ç»“åˆ `render()` æ–¹æ³•ä»£æ›¿ï¼‰ã€‚\n\nç¼–è¾‘å™¨æ¸²æŸ“çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```js\n<component \n  v-for=\"item in componentData\"\n  :key=\"item.id\"\n  :is=\"item.component\"\n  :style=\"item.style\"\n  :propValue=\"item.propValue\"\n/>\n```\n\næ¯ä¸ªç»„ä»¶æ•°æ®å¤§æ¦‚æ˜¯è¿™æ ·ï¼š\n\n```js\n{\n    component: 'v-text', // ç»„ä»¶åç§°ï¼Œéœ€è¦æå‰æ³¨å†Œåˆ° Vue\n    label: 'æ–‡å­—', // å·¦ä¾§ç»„ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—\n    propValue: 'æ–‡å­—', // ç»„ä»¶æ‰€ä½¿ç”¨çš„å€¼\n    icon: 'el-icon-edit', // å·¦ä¾§ç»„ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—\n    animations: [], // åŠ¨ç”»åˆ—è¡¨\n    events: {}, // äº‹ä»¶åˆ—è¡¨\n    style: { // ç»„ä»¶æ ·å¼\n        width: 200,\n        height: 33,\n        fontSize: 14,\n        fontWeight: 500,\n        lineHeight: '',\n        letterSpacing: 0,\n        textAlign: '',\n        color: '',\n    },\n}\n```\n\nåœ¨éå† `componentData` ç»„ä»¶æ•°æ®æ—¶ï¼Œä¸»è¦é  `is` å±æ€§æ¥è¯†åˆ«å‡ºçœŸæ­£è¦æ¸²æŸ“çš„æ˜¯å“ªä¸ªç»„ä»¶ã€‚\nä¾‹å¦‚è¦æ¸²æŸ“çš„ç»„ä»¶æ•°æ®æ˜¯` { component: 'v-text' }`ï¼Œåˆ™ `<component :is=\"item.component\" /> `ä¼šè¢«è½¬æ¢ä¸º `<v-text />`ã€‚å½“ç„¶ï¼Œä½ è¿™ä¸ªç»„ä»¶ä¹Ÿè¦æå‰æ³¨å†Œåˆ° Vue ä¸­ã€‚\nå¦‚æœä½ æƒ³äº†è§£æ›´å¤š is å±æ€§çš„èµ„æ–™ï¼Œè¯·æŸ¥çœ‹[å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/v2/api/#is)ã€‚\n\n### 2. è‡ªå®šä¹‰ç»„ä»¶\n\nåŸåˆ™ä¸Šä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†å»ºè®®ä½ æœ€å¥½å°è£…ä¸€ä¸‹ã€‚ä¸ç®¡æ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶è¿˜æ˜¯è‡ªå®šä¹‰ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶æ‰€éœ€çš„å±æ€§å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ¯ä¸ªç»„ä»¶æ•°æ®å¯ä»¥æš´éœ²å‡ºä¸€ä¸ªå±æ€§ `propValue` ç”¨äºä¼ é€’å€¼ã€‚\nä¾‹å¦‚ a ç»„ä»¶åªéœ€è¦ä¸€ä¸ªå±æ€§ï¼Œä½ çš„ `propValue` å¯ä»¥è¿™æ ·å†™ï¼š`propValue: 'aaa'`ã€‚å¦‚æœéœ€è¦å¤šä¸ªå±æ€§ï¼Œ`propValue` åˆ™å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼š\n\n```js\npropValue: {\n  a: 1,\n  b: 'text'\n}\n```\n\nåœ¨è¿™ä¸ª DEMO ç»„ä»¶åº“ä¸­æˆ‘å®šä¹‰äº†ä¸‰ä¸ªç»„ä»¶ã€‚\n\nå›¾ç‰‡ç»„ä»¶ Pictureï¼š\n\n```js\n<template>\n    <div style=\"overflow: hidden\">\n        <img :src=\"propValue\">\n    </div>\n</template>\n\n<script>\nexport default {\n    props: {\n        propValue: {\n            type: String,\n            require: true,\n        },\n    },\n}\n</script>\n```\n\næŒ‰é’®ç»„ä»¶ `VButton`:\n\n```js\n<template>\n    <button class=\"v-button\">{{ propValue }}</button>\n</template>\n\n<script>\nexport default {\n    props: {\n        propValue: {\n            type: String,\n            default: '',\n        },\n    },\n}\n</script>\n```\n\næ–‡æœ¬ç»„ä»¶ `VText`:\n\n```js\n<template>\n    <textarea \n        v-if=\"editMode == 'edit'\"\n        :value=\"propValue\"\n        class=\"text textarea\"\n        @input=\"handleInput\"\n        ref=\"v-text\"\n    ></textarea>\n    <div v-else class=\"text disabled\">\n        <div v-for=\"(text, index) in propValue.split('\\n')\" :key=\"index\">{{ text }}</div>\n    </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\n\nexport default {\n    props: {\n        propValue: {\n            type: String,\n        },\n        element: {\n            type: Object,\n        },\n    },\n    computed: mapState([\n        'editMode',\n    ]),\n    methods: {\n        handleInput(e) {\n            this.$emit('input', this.element, e.target.value)\n        },\n    },\n}\n</script>\n```\n\n### 3. æ‹–æ‹½\n\n#### ä»ç»„ä»¶åˆ—è¡¨åˆ°ç”»å¸ƒ\n\nä¸€ä¸ªå…ƒç´ å¦‚æœè¦è®¾ä¸ºå¯æ‹–æ‹½ï¼Œå¿…é¡»ç»™å®ƒæ·»åŠ ä¸€ä¸ª `draggable` å±æ€§ã€‚å¦å¤–ï¼Œåœ¨å°†ç»„ä»¶åˆ—è¡¨ä¸­çš„ç»„ä»¶æ‹–æ‹½åˆ°ç”»å¸ƒä¸­ï¼Œè¿˜æœ‰ä¸¤ä¸ªäº‹ä»¶æ˜¯èµ·åˆ°å…³é”®ä½œç”¨çš„ï¼š\n\n`dragstart` äº‹ä»¶ï¼Œåœ¨æ‹–æ‹½åˆšå¼€å§‹æ—¶è§¦å‘ã€‚å®ƒä¸»è¦ç”¨äºå°†æ‹–æ‹½çš„ç»„ä»¶ä¿¡æ¯ä¼ é€’ç»™ç”»å¸ƒã€‚\n`drop` äº‹ä»¶ï¼Œåœ¨æ‹–æ‹½ç»“æŸæ—¶è§¦å‘ã€‚ä¸»è¦ç”¨äºæ¥æ”¶æ‹–æ‹½çš„ç»„ä»¶ä¿¡æ¯ã€‚\n\nå…ˆæ¥çœ‹ä¸€ä¸‹å·¦ä¾§ç»„ä»¶åˆ—è¡¨çš„ä»£ç ï¼š\n\n```html\n<div @dragstart=\"handleDragStart\" class=\"component-list\">\n    <div v-for=\"(item, index) in componentList\" :key=\"index\" class=\"list\" draggable :data-index=\"index\">\n        <i :class=\"item.icon\"></i>\n        <span>{{ item.label }}</span>\n    </div>\n</div>\n```\n\n```js\nhandleDragStart(e) {\n    e.dataTransfer.setData('index', e.target.dataset.index)\n}\n```\nå¯ä»¥çœ‹åˆ°ç»™åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶éƒ½è®¾ç½®äº† `draggable` å±æ€§ã€‚å¦å¤–ï¼Œåœ¨è§¦å‘ `dragstart`äº‹ä»¶æ—¶ï¼Œä½¿ç”¨ `dataTransfer.setData()` ä¼ è¾“æ•°æ®ã€‚å†æ¥çœ‹ä¸€ä¸‹æ¥æ”¶æ•°æ®çš„ä»£ç ï¼š\n\n```html\n<div class=\"content\" @drop=\"handleDrop\" @dragover=\"handleDragOver\" @click=\"deselectCurComponent\">\n    <Editor />\n</div>\n```\n```js\nhandleDrop(e) {\n    e.preventDefault()\n    e.stopPropagation()\n    const component = deepCopy(componentList[e.dataTransfer.getData('index')])\n    this.$store.commit('addComponent', component)\n}\n```\nè§¦å‘ `drop` äº‹ä»¶æ—¶ï¼Œä½¿ç”¨ `dataTransfer.getData()` æ¥æ”¶ä¼ è¾“è¿‡æ¥çš„ç´¢å¼•æ•°æ®ï¼Œç„¶åæ ¹æ®ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ç»„ä»¶æ•°æ®ï¼Œå†æ·»åŠ åˆ°ç”»å¸ƒï¼Œä»è€Œæ¸²æŸ“ç»„ä»¶ã€‚\n![](https://panyu97py.github.io/post-images/1613497886196.gif)\n\n#### ç»„ä»¶åœ¨ç”»å¸ƒä¸­ç§»åŠ¨\n\né¦–å…ˆéœ€è¦å°†ç”»å¸ƒè®¾ä¸ºç›¸å¯¹å®šä½ `position: relative`ï¼Œç„¶åå°†æ¯ä¸ªç»„ä»¶è®¾ä¸ºç»å¯¹å®šä½ `position: absolute`ã€‚é™¤äº†è¿™ä¸€ç‚¹å¤–ï¼Œè¿˜è¦é€šè¿‡ç›‘å¬ä¸‰ä¸ªäº‹ä»¶æ¥è¿›è¡Œç§»åŠ¨ï¼š\n\n1. `mousedown` äº‹ä»¶ï¼Œåœ¨ç»„ä»¶ä¸ŠæŒ‰ä¸‹é¼ æ ‡æ—¶ï¼Œè®°å½•ç»„ä»¶å½“å‰çš„ä½ç½®ï¼Œå³ xy åæ ‡ï¼ˆä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œè¿™é‡Œä½¿ç”¨çš„åæ ‡è½´ï¼Œå®é™…ä¸Š xy å¯¹åº”çš„æ˜¯ css ä¸­çš„ left å’Œ topã€‚\n2. `mousemove` äº‹ä»¶ï¼Œæ¯æ¬¡é¼ æ ‡ç§»åŠ¨æ—¶ï¼Œéƒ½ç”¨å½“å‰æœ€æ–°çš„ xy åæ ‡å‡å»æœ€å¼€å§‹çš„ xy åæ ‡ï¼Œä»è€Œè®¡ç®—å‡ºç§»åŠ¨è·ç¦»ï¼Œå†æ”¹å˜ç»„ä»¶ä½ç½®ã€‚\n3. `mouseup` äº‹ä»¶ï¼Œé¼ æ ‡æŠ¬èµ·æ—¶ç»“æŸç§»åŠ¨ã€‚\n\n```js\nhandleMouseDown(e) {\n    e.stopPropagation()\n    this.$store.commit('setCurComponent', { component: this.element, zIndex: this.zIndex })\n\n    const pos = { ...this.defaultStyle }\n    const startY = e.clientY\n    const startX = e.clientX\n    // å¦‚æœç›´æ¥ä¿®æ”¹å±æ€§ï¼Œå€¼çš„ç±»å‹ä¼šå˜ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦è½¬ä¸ºæ•°å€¼å‹\n    const startTop = Number(pos.top)\n    const startLeft = Number(pos.left)\n\n    const move = (moveEvent) => {\n        const currX = moveEvent.clientX\n        const currY = moveEvent.clientY\n        pos.top = currY - startY + startTop\n        pos.left = currX - startX + startLeft\n        // ä¿®æ”¹å½“å‰ç»„ä»¶æ ·å¼\n        this.$store.commit('setShapeStyle', pos)\n    }\n\n    const up = () => {\n        document.removeEventListener('mousemove', move)\n        document.removeEventListener('mouseup', up)\n    }\n\n    document.addEventListener('mousemove', move)\n    document.addEventListener('mouseup', up)\n}\n```\n![](https://panyu97py.github.io/post-images/1613498024998.gif)\n\n### 4. åˆ é™¤ç»„ä»¶ã€è°ƒæ•´å›¾å±‚å±‚çº§\n\n#### æ”¹å˜å›¾å±‚å±‚çº§\n\nç”±äºæ‹–æ‹½ç»„ä»¶åˆ°ç”»å¸ƒä¸­æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œæ‰€ä»¥å¯ä»¥æŒ‰ç…§æ•°æ®é¡ºåºæ¥åˆ†é…å›¾å±‚å±‚çº§ã€‚\nä¾‹å¦‚ç”»å¸ƒæ–°å¢äº†äº”ä¸ªç»„ä»¶ abcdeï¼Œé‚£å®ƒä»¬åœ¨ç”»å¸ƒæ•°æ®ä¸­çš„é¡ºåºä¸º `[a, b, c, d, e]`ï¼Œå›¾å±‚å±‚çº§å’Œç´¢å¼•ä¸€ä¸€å¯¹åº”ï¼Œå³å®ƒä»¬çš„ `z-index` å±æ€§å€¼æ˜¯ 01234ï¼ˆåæ¥å±…ä¸Šï¼‰ã€‚ç”¨ä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š\n\n```html\n<div v-for=\"(item, index) in componentData\" :zIndex=\"index\"></div>\n```\nå¦‚æœä¸äº†è§£ z-index å±æ€§çš„ï¼Œè¯·çœ‹ä¸€ä¸‹ [MDN æ–‡æ¡£](https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index)ã€‚\n\nç†è§£äº†è¿™ä¸€ç‚¹ä¹‹åï¼Œæ”¹å˜å›¾å±‚å±‚çº§å°±å¾ˆå®¹æ˜“åšåˆ°äº†ã€‚æ”¹å˜å›¾å±‚å±‚çº§ï¼Œå³æ˜¯æ”¹å˜ç»„ä»¶æ•°æ®åœ¨ `componentData `æ•°ç»„ä¸­çš„é¡ºåºã€‚ä¾‹å¦‚æœ‰` [a, b, c] `ä¸‰ä¸ªç»„ä»¶ï¼Œå®ƒä»¬çš„å›¾å±‚å±‚çº§ä»ä½åˆ°é«˜é¡ºåºä¸º abcï¼ˆç´¢å¼•è¶Šå¤§ï¼Œå±‚çº§è¶Šé«˜ï¼‰ã€‚\nå¦‚æœè¦å°† b ç»„ä»¶ä¸Šç§»ï¼Œåªéœ€å°†å®ƒå’Œ c è°ƒæ¢é¡ºåºå³å¯ï¼š\n```js\nconst temp = componentData[1]\ncomponentData[1] = componentData[2]\ncomponentData[2] = temp\n```\nåŒç†ï¼Œç½®é¡¶ç½®åº•ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¾‹å¦‚æˆ‘è¦å°† a ç»„ä»¶ç½®é¡¶ï¼Œåªéœ€å°† a å’Œæœ€åä¸€ä¸ªç»„ä»¶è°ƒæ¢é¡ºåºå³å¯ï¼š\n```js\nconst temp = componentData[0]\ncomponentData[0] = componentData[componentData.lenght - 1]\ncomponentData[componentData.lenght - 1] = temp\n```\n![](https://panyu97py.github.io/post-images/1613498228508.gif)\n\n#### åˆ é™¤ç»„ä»¶\nåˆ é™¤ç»„ä»¶éå¸¸ç®€å•ï¼Œä¸€è¡Œä»£ç æå®šï¼š`componentData.splice(index, 1)`ã€‚\n![](https://panyu97py.github.io/post-images/1613498335942.gif)\n\n### 5. æ”¾å¤§ç¼©å°\n\nç»†å¿ƒçš„ç½‘å‹å¯èƒ½ä¼šå‘ç°ï¼Œç‚¹å‡»ç”»å¸ƒä¸Šçš„ç»„ä»¶æ—¶ï¼Œç»„ä»¶ä¸Šä¼šå‡ºç° 8 ä¸ªå°åœ†ç‚¹ã€‚è¿™ 8 ä¸ªå°åœ†ç‚¹å°±æ˜¯ç”¨æ¥æ”¾å¤§ç¼©å°ç”¨çš„ã€‚å®ç°åŸç†å¦‚ä¸‹ï¼š\n\n#### 1. åœ¨æ¯ä¸ªç»„ä»¶å¤–é¢åŒ…ä¸€å±‚ `Shape`ç»„ä»¶ï¼Œ`Shape` ç»„ä»¶é‡ŒåŒ…å« 8 ä¸ªå°åœ†ç‚¹å’Œä¸€ä¸ª `<slot> `æ’æ§½ï¼Œç”¨äºæ”¾ç½®ç»„ä»¶ã€‚\n\n```html\n<!--é¡µé¢ç»„ä»¶åˆ—è¡¨å±•ç¤º-->\n<Shape v-for=\"(item, index) in componentData\"\n    :defaultStyle=\"item.style\"\n    :style=\"getShapeStyle(item.style, index)\"\n    :key=\"item.id\"\n    :active=\"item === curComponent\"\n    :element=\"item\"\n    :zIndex=\"index\"\n>\n    <component\n        class=\"component\"\n        :is=\"item.component\"\n        :style=\"getComponentStyle(item.style)\"\n        :propValue=\"item.propValue\"\n    />\n</Shape>\n```\n\n`Shape` ç»„ä»¶å†…éƒ¨ç»“æ„ï¼š\n\n```html\n<template>\n    <div class=\"shape\" :class=\"{ active: this.active }\" @click=\"selectCurComponent\" @mousedown=\"handleMouseDown\"\n    @contextmenu=\"handleContextMenu\">\n        <div\n            class=\"shape-point\"\n            v-for=\"(item, index) in (active? pointList : [])\"\n            @mousedown=\"handleMouseDownOnPoint(item)\"\n            :key=\"index\"\n            :style=\"getPointStyle(item)\">\n        </div>\n        <slot></slot>\n    </div>\n</template>\n```\n\n#### 2. ç‚¹å‡»ç»„ä»¶æ—¶ï¼Œå°† 8 ä¸ªå°åœ†ç‚¹æ˜¾ç¤ºå‡ºæ¥ã€‚\nèµ·ä½œç”¨çš„æ˜¯è¿™è¡Œä»£ç  `:active=\"item === curComponent\"`ã€‚\n\n#### 3. è®¡ç®—æ¯ä¸ªå°åœ†ç‚¹çš„ä½ç½®ã€‚\nå…ˆæ¥çœ‹ä¸€ä¸‹è®¡ç®—å°åœ†ç‚¹ä½ç½®çš„ä»£ç ï¼š\n```js\nconst pointList = ['t', 'r', 'b', 'l', 'lt', 'rt', 'lb', 'rb']\n\ngetPointStyle(point) {\n    const { width, height } = this.defaultStyle\n    const hasT = /t/.test(point)\n    const hasB = /b/.test(point)\n    const hasL = /l/.test(point)\n    const hasR = /r/.test(point)\n    let newLeft = 0\n    let newTop = 0\n\n    // å››ä¸ªè§’çš„ç‚¹\n    if (point.length === 2) {\n        newLeft = hasL? 0 : width\n        newTop = hasT? 0 : height\n    } else {\n        // ä¸Šä¸‹ä¸¤ç‚¹çš„ç‚¹ï¼Œå®½åº¦å±…ä¸­\n        if (hasT || hasB) {\n            newLeft = width / 2\n            newTop = hasT? 0 : height\n        }\n\n        // å·¦å³ä¸¤è¾¹çš„ç‚¹ï¼Œé«˜åº¦å±…ä¸­\n        if (hasL || hasR) {\n            newLeft = hasL? 0 : width\n            newTop = Math.floor(height / 2)\n        }\n    }\n\n    const style = {\n        marginLeft: hasR? '-4px' : '-3px',\n        marginTop: '-3px',\n        left: `${newLeft}px`,\n        top: `${newTop}px`,\n        cursor: point.split('').reverse().map(m => this.directionKey[m]).join('') + '-resize',\n    }\n\n    return style\n}\n\n```\nè®¡ç®—å°åœ†ç‚¹çš„ä½ç½®éœ€è¦è·å–ä¸€äº›ä¿¡æ¯ï¼š\n* ç»„ä»¶çš„é«˜åº¦ `height`ã€å®½åº¦ `width`\n\næ³¨æ„ï¼Œå°åœ†ç‚¹ä¹Ÿæ˜¯ç»å¯¹å®šä½çš„ï¼Œç›¸å¯¹äº Shape ç»„ä»¶ã€‚æ‰€ä»¥æœ‰å››ä¸ªå°åœ†ç‚¹çš„ä½ç½®å¾ˆå¥½ç¡®å®šï¼š\n\n1. å·¦ä¸Šè§’çš„å°åœ†ç‚¹ï¼Œåæ ‡ `left: 0, top: 0`\n2. å³ä¸Šè§’çš„å°åœ†ç‚¹ï¼Œåæ ‡ `left: width, top: 0`\n3. å·¦ä¸‹è§’çš„å°åœ†ç‚¹ï¼Œåæ ‡ `left: 0, top: height`\n4. å³ä¸‹è§’çš„å°åœ†ç‚¹ï¼Œåæ ‡ `left: width, top: height`\n\n![](https://panyu97py.github.io/post-images/1613498726273.png)\n\nå¦å¤–çš„å››ä¸ªå°åœ†ç‚¹éœ€è¦é€šè¿‡è®¡ç®—é—´æ¥ç®—å‡ºæ¥ã€‚ä¾‹å¦‚å·¦è¾¹ä¸­é—´çš„å°åœ†ç‚¹ï¼Œè®¡ç®—å…¬å¼ä¸º `left: 0, top: height / 2`ï¼Œå…¶ä»–å°åœ†ç‚¹åŒç†ã€‚\n\n![](https://panyu97py.github.io/post-images/1613498761944.png)\n\n#### 4. ç‚¹å‡»å°åœ†ç‚¹æ—¶ï¼Œå¯ä»¥è¿›è¡Œæ”¾å¤§ç¼©å°æ“ä½œã€‚\n\n```js\nhandleMouseDownOnPoint(point) {\n    const downEvent = window.event\n    downEvent.stopPropagation()\n    downEvent.preventDefault()\n\n    const pos = { ...this.defaultStyle }\n    const height = Number(pos.height)\n    const width = Number(pos.width)\n    const top = Number(pos.top)\n    const left = Number(pos.left)\n    const startX = downEvent.clientX\n    const startY = downEvent.clientY\n\n    // æ˜¯å¦éœ€è¦ä¿å­˜å¿«ç…§\n    let needSave = false\n    const move = (moveEvent) => {\n        needSave = true\n        const currX = moveEvent.clientX\n        const currY = moveEvent.clientY\n        const disY = currY - startY\n        const disX = currX - startX\n        const hasT = /t/.test(point)\n        const hasB = /b/.test(point)\n        const hasL = /l/.test(point)\n        const hasR = /r/.test(point)\n        const newHeight = height + (hasT? -disY : hasB? disY : 0)\n        const newWidth = width + (hasL? -disX : hasR? disX : 0)\n        pos.height = newHeight > 0? newHeight : 0\n        pos.width = newWidth > 0? newWidth : 0\n        pos.left = left + (hasL? disX : 0)\n        pos.top = top + (hasT? disY : 0)\n        this.$store.commit('setShapeStyle', pos)\n    }\n\n    const up = () => {\n        document.removeEventListener('mousemove', move)\n        document.removeEventListener('mouseup', up)\n        needSave && this.$store.commit('recordSnapshot')\n    }\n\n    document.addEventListener('mousemove', move)\n    document.addEventListener('mouseup', up)\n}\n```\n\nå®ƒçš„åŸç†æ˜¯è¿™æ ·çš„ï¼š\n\n1. ç‚¹å‡»å°åœ†ç‚¹æ—¶ï¼Œè®°å½•ç‚¹å‡»çš„åæ ‡ xyã€‚\n2. å‡è®¾æˆ‘ä»¬ç°åœ¨å‘ä¸‹æ‹–åŠ¨ï¼Œé‚£ä¹ˆ y åæ ‡å°±ä¼šå¢å¤§ã€‚\n3. ç”¨æ–°çš„ y åæ ‡å‡å»åŸæ¥çš„ y åæ ‡ï¼Œå°±å¯ä»¥çŸ¥é“åœ¨çºµè½´æ–¹å‘çš„ç§»åŠ¨è·ç¦»æ˜¯å¤šå°‘ã€‚\n4. æœ€åå†å°†ç§»åŠ¨è·ç¦»åŠ ä¸ŠåŸæ¥ç»„ä»¶çš„é«˜åº¦ï¼Œå°±å¯ä»¥å¾—å‡ºæ–°çš„ç»„ä»¶é«˜åº¦ã€‚\n5. å¦‚æœæ˜¯æ­£æ•°ï¼Œè¯´æ˜æ˜¯å¾€ä¸‹æ‹‰ï¼Œç»„ä»¶çš„é«˜åº¦åœ¨å¢åŠ ã€‚å¦‚æœæ˜¯è´Ÿæ•°ï¼Œè¯´æ˜æ˜¯å¾€ä¸Šæ‹‰ï¼Œç»„ä»¶çš„é«˜åº¦åœ¨å‡å°‘ã€‚\n![](https://panyu97py.github.io/post-images/1613498868658.gif)\n\n### 6. æ’¤æ¶ˆã€é‡åš\næ’¤é”€é‡åšçš„å®ç°åŸç†å…¶å®æŒºç®€å•çš„ï¼Œå…ˆçœ‹ä¸€ä¸‹ä»£ç ï¼š\n```js\nsnapshotData: [], // ç¼–è¾‘å™¨å¿«ç…§æ•°æ®\nsnapshotIndex: -1, // å¿«ç…§ç´¢å¼•\n        \nundo(state) {\n    if (state.snapshotIndex >= 0) {\n        state.snapshotIndex--\n        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))\n    }\n},\n\nredo(state) {\n    if (state.snapshotIndex < state.snapshotData.length - 1) {\n        state.snapshotIndex++\n        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))\n    }\n},\n\nsetComponentData(state, componentData = []) {\n    Vue.set(state, 'componentData', componentData)\n},\n\nrecordSnapshot(state) {\n    // æ·»åŠ æ–°çš„å¿«ç…§\n    state.snapshotData[++state.snapshotIndex] = deepCopy(state.componentData)\n    // åœ¨ undo è¿‡ç¨‹ä¸­ï¼Œæ·»åŠ æ–°çš„å¿«ç…§æ—¶ï¼Œè¦å°†å®ƒåé¢çš„å¿«ç…§æ¸…ç†æ‰\n    if (state.snapshotIndex < state.snapshotData.length - 1) {\n        state.snapshotData = state.snapshotData.slice(0, state.snapshotIndex + 1)\n    }\n},\n```\n\nç”¨ä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜ç¼–è¾‘å™¨çš„å¿«ç…§æ•°æ®ã€‚ä¿å­˜å¿«ç…§å°±æ˜¯ä¸åœåœ°æ‰§è¡Œ `push()` æ“ä½œï¼Œå°†å½“å‰çš„ç¼–è¾‘å™¨æ•°æ®æ¨å…¥ `snapshotData` æ•°ç»„ï¼Œå¹¶å¢åŠ å¿«ç…§ç´¢å¼• `snapshotIndex`ã€‚ç›®å‰ä»¥ä¸‹å‡ ä¸ªåŠ¨ä½œä¼šè§¦å‘ä¿å­˜å¿«ç…§æ“ä½œï¼š\n\n1. æ–°å¢ç»„ä»¶\n2. åˆ é™¤ç»„ä»¶\n3. æ”¹å˜å›¾å±‚å±‚çº§\n4. æ‹–åŠ¨ç»„ä»¶ç»“æŸæ—¶\n\n#### æ’¤é”€\nå‡è®¾ç°åœ¨ `snapshotData` ä¿å­˜äº† 4 ä¸ªå¿«ç…§ã€‚å³ `[a, b, c, d]`ï¼Œå¯¹åº”çš„å¿«ç…§ç´¢å¼•ä¸º 3ã€‚å¦‚æœè¿™æ—¶è¿›è¡Œäº†æ’¤é”€æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦å°†å¿«ç…§ç´¢å¼•å‡ 1ï¼Œç„¶åå°†å¯¹åº”çš„å¿«ç…§æ•°æ®èµ‹å€¼ç»™ç”»å¸ƒã€‚\nä¾‹å¦‚å½“å‰ç”»å¸ƒæ•°æ®æ˜¯ dï¼Œè¿›è¡Œæ’¤é”€åï¼Œç´¢å¼• -1ï¼Œç°åœ¨ç”»å¸ƒçš„æ•°æ®æ˜¯ cã€‚\n#### é‡åš\næ˜ç™½äº†æ’¤é”€ï¼Œé‚£é‡åšå°±å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯å°†å¿«ç…§ç´¢å¼•åŠ  1ï¼Œç„¶åå°†å¯¹åº”çš„å¿«ç…§æ•°æ®èµ‹å€¼ç»™ç”»å¸ƒã€‚\nä¸è¿‡è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œå°±æ˜¯åœ¨æ’¤é”€æ“ä½œä¸­è¿›è¡Œäº†æ–°çš„æ“ä½œï¼Œè¦æ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š\n\n1. æ–°æ“ä½œæ›¿æ¢å½“å‰å¿«ç…§ç´¢å¼•åé¢æ‰€æœ‰çš„æ•°æ®ã€‚è¿˜æ˜¯ç”¨åˆšæ‰çš„æ•°æ® [a, b, c, d] ä¸¾ä¾‹ï¼Œå‡è®¾ç°åœ¨è¿›è¡Œäº†ä¸¤æ¬¡æ’¤é”€æ“ä½œï¼Œå¿«ç…§ç´¢å¼•å˜ä¸º 1ï¼Œå¯¹åº”çš„å¿«ç…§æ•°æ®ä¸º bï¼Œå¦‚æœè¿™æ—¶è¿›è¡Œäº†æ–°çš„æ“ä½œï¼Œå¯¹åº”çš„å¿«ç…§æ•°æ®ä¸º eã€‚é‚£ e ä¼šæŠŠ cd é¡¶æ‰ï¼Œç°åœ¨çš„å¿«ç…§æ•°æ®ä¸º [a, b, e]ã€‚\n2. ä¸é¡¶æ‰æ•°æ®ï¼Œåœ¨åŸæ¥çš„å¿«ç…§ä¸­æ–°å¢ä¸€æ¡è®°å½•ã€‚ç”¨åˆšæ‰çš„ä¾‹å­ä¸¾ä¾‹ï¼Œe ä¸ä¼šæŠŠ cd é¡¶æ‰ï¼Œè€Œæ˜¯åœ¨ cd ä¹‹å‰æ’å…¥ï¼Œå³å¿«ç…§æ•°æ®å˜ä¸º [a, b, e, c, d]ã€‚\n\næˆ‘é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ¡ˆã€‚\n\n![](https://panyu97py.github.io/post-images/1613499176409.gif)\n\n### 7. å¸é™„\nä»€ä¹ˆæ˜¯å¸é™„ï¼Ÿå°±æ˜¯åœ¨æ‹–æ‹½ç»„ä»¶æ—¶ï¼Œå¦‚æœå®ƒå’Œå¦ä¸€ä¸ªç»„ä»¶çš„è·ç¦»æ¯”è¾ƒæ¥è¿‘ï¼Œå°±ä¼šè‡ªåŠ¨å¸é™„åœ¨ä¸€èµ·ã€‚\n\n![](https://panyu97py.github.io/post-images/1613499297871.gif)\n\nå¸é™„çš„ä»£ç å¤§æ¦‚åœ¨ 300 è¡Œå·¦å³ï¼Œå»ºè®®è‡ªå·±æ‰“å¼€æºç æ–‡ä»¶çœ‹ï¼ˆæ–‡ä»¶è·¯å¾„ï¼š`src\\components\\Editor\\MarkLine.vue`ï¼‰ã€‚è¿™é‡Œä¸è´´ä»£ç äº†ï¼Œä¸»è¦è¯´è¯´åŸç†æ˜¯æ€ä¹ˆå®ç°çš„ã€‚\n\n#### æ ‡çº¿\n\nåœ¨é¡µé¢ä¸Šåˆ›å»º 6 æ¡çº¿ï¼Œåˆ†åˆ«æ˜¯ä¸‰æ¨ªä¸‰ç«–ã€‚è¿™ 6 æ¡çº¿çš„ä½œç”¨æ˜¯å¯¹é½ï¼Œå®ƒä»¬ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°å‘¢ï¼Ÿ\n\n1. ä¸Šä¸‹æ–¹å‘çš„ä¸¤ä¸ªç»„ä»¶å·¦è¾¹ã€ä¸­é—´ã€å³è¾¹å¯¹é½æ—¶ä¼šå‡ºç°ç«–çº¿\n2. å·¦å³æ–¹å‘çš„ä¸¤ä¸ªç»„ä»¶ä¸Šè¾¹ã€ä¸­é—´ã€ä¸‹è¾¹å¯¹é½æ—¶ä¼šå‡ºç°æ¨ªçº¿\n\nå…·ä½“çš„è®¡ç®—å…¬å¼ä¸»è¦æ˜¯æ ¹æ®æ¯ä¸ªç»„ä»¶çš„ xy åæ ‡å’Œå®½åº¦é«˜åº¦è¿›è¡Œè®¡ç®—çš„ã€‚ä¾‹å¦‚è¦åˆ¤æ–­ ab ä¸¤ä¸ªç»„ä»¶çš„å·¦è¾¹æ˜¯å¦å¯¹é½ï¼Œåˆ™è¦çŸ¥é“å®ƒä»¬æ¯ä¸ªç»„ä»¶çš„ x åæ ‡ï¼›å¦‚æœè¦çŸ¥é“å®ƒä»¬å³è¾¹æ˜¯å¦å¯¹é½ï¼Œé™¤äº†è¦çŸ¥é“ x åæ ‡ï¼Œè¿˜è¦çŸ¥é“å®ƒä»¬å„è‡ªçš„å®½åº¦ã€‚\n\n```js\n// å·¦å¯¹é½çš„æ¡ä»¶\na.x == b.x\n\n// å³å¯¹é½çš„æ¡ä»¶\na.x + a.width == b.x + b.width\n\n```\nåœ¨å¯¹é½çš„æ—¶å€™ï¼Œæ˜¾ç¤ºæ ‡çº¿ã€‚\n\nå¦å¤–è¿˜è¦åˆ¤æ–­ ab ä¸¤ä¸ªç»„ä»¶æ˜¯å¦â€œè¶³å¤Ÿâ€è¿‘ã€‚å¦‚æœè¶³å¤Ÿè¿‘ï¼Œå°±å¸é™„åœ¨ä¸€èµ·ã€‚æ˜¯å¦è¶³å¤Ÿè¿‘è¦é ä¸€ä¸ªå˜é‡æ¥åˆ¤æ–­ï¼š\n```js\ndiff: 3, // ç›¸è· dff åƒç´ å°†è‡ªåŠ¨å¸é™„\n```\nå°äºç­‰äº `diff` åƒç´ åˆ™è‡ªåŠ¨å¸é™„ã€‚\n\n#### å¸é™„\n\n##### å¸é™„æ•ˆæœæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ\n\nå‡è®¾ç°åœ¨æœ‰ ab ç»„ä»¶ï¼Œa ç»„ä»¶åæ ‡ xy éƒ½æ˜¯ 0ï¼Œå®½é«˜éƒ½æ˜¯ 100ã€‚ç°åœ¨å‡è®¾ a ç»„ä»¶ä¸åŠ¨ï¼Œæˆ‘ä»¬æ­£åœ¨æ‹–æ‹½ b ç»„ä»¶ã€‚å½“æŠŠ b ç»„ä»¶æ‹–åˆ°åæ ‡ä¸º` x: 0, y: 103` æ—¶ï¼Œç”±äº` 103 - 100 <= 3(diff)`ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤å®šå®ƒä»¬å·²ç»æ¥è¿‘å¾—è¶³å¤Ÿè¿‘ã€‚è¿™æ—¶éœ€è¦æ‰‹åŠ¨å°† b ç»„ä»¶çš„ y åæ ‡å€¼è®¾ä¸º 100ï¼Œè¿™æ ·å°±å°† ab ç»„ä»¶å¸é™„åœ¨ä¸€èµ·äº†ã€‚\n\n![](https://panyu97py.github.io/post-images/1613499573207.gif)\n\n#### ä¼˜åŒ–\n\nåœ¨æ‹–æ‹½æ—¶å¦‚æœ 6 æ¡æ ‡çº¿éƒ½æ˜¾ç¤ºå‡ºæ¥ä¼šä¸å¤ªç¾è§‚ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšä¸€ä¸‹ä¼˜åŒ–ï¼Œåœ¨çºµæ¨ªæ–¹å‘ä¸Šæœ€å¤šåªåŒæ—¶æ˜¾ç¤ºä¸€æ¡çº¿ã€‚å®ç°åŸç†å¦‚ä¸‹ï¼š\n\n1. a ç»„ä»¶åœ¨å·¦è¾¹ä¸åŠ¨ï¼Œæˆ‘ä»¬æ‹–ç€ b ç»„ä»¶å¾€ a ç»„ä»¶é è¿‘ã€‚\n2. è¿™æ—¶å®ƒä»¬æœ€å…ˆå¯¹é½çš„æ˜¯ a çš„å³è¾¹å’Œ b çš„å·¦è¾¹ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€æ¡çº¿å°±å¤Ÿäº†ã€‚\n3. å¦‚æœ ab ç»„ä»¶å·²ç»é è¿‘ï¼Œå¹¶ä¸” b ç»„ä»¶ç»§ç»­å¾€å·¦è¾¹ç§»åŠ¨ï¼Œè¿™æ—¶å°±è¦åˆ¤æ–­å®ƒä»¬ä¿©çš„ä¸­é—´æ˜¯å¦å¯¹é½ã€‚\n4. b ç»„ä»¶ç»§ç»­æ‹–åŠ¨ï¼Œè¿™æ—¶éœ€è¦åˆ¤æ–­ a ç»„ä»¶çš„å·¦è¾¹å’Œ b ç»„ä»¶çš„å³è¾¹æ˜¯å¦å¯¹é½ï¼Œä¹Ÿæ˜¯åªéœ€è¦ä¸€æ¡çº¿ã€‚\n\nå¯ä»¥å‘ç°ï¼Œå…³é”®çš„åœ°æ–¹æ˜¯æˆ‘ä»¬è¦çŸ¥é“ä¸¤ä¸ªç»„ä»¶çš„æ–¹å‘ã€‚å³ ab ä¸¤ä¸ªç»„ä»¶é è¿‘ï¼Œæˆ‘ä»¬è¦çŸ¥é“åˆ°åº• b æ˜¯åœ¨ a çš„å·¦è¾¹è¿˜æ˜¯å³è¾¹ã€‚\nè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡é¼ æ ‡ç§»åŠ¨äº‹ä»¶æ¥åˆ¤æ–­ï¼Œä¹‹å‰åœ¨è®²è§£æ‹–æ‹½çš„æ—¶å€™è¯´è¿‡ï¼Œ`mousedown` äº‹ä»¶è§¦å‘æ—¶ä¼šè®°å½•èµ·ç‚¹åæ ‡ã€‚æ‰€ä»¥æ¯æ¬¡è§¦å‘ `mousemove` äº‹ä»¶æ—¶ï¼Œç”¨å½“å‰åæ ‡å‡å»åŸæ¥çš„åæ ‡ï¼Œå°±å¯ä»¥åˆ¤æ–­ç»„ä»¶æ–¹å‘ã€‚ä¾‹å¦‚ x æ–¹å‘ä¸Šï¼Œå¦‚æœ `b.x - a.x ` çš„å·®å€¼ä¸ºæ­£ï¼Œè¯´æ˜æ˜¯ b åœ¨ a å³è¾¹ï¼Œå¦åˆ™ä¸ºå·¦è¾¹ã€‚\n\n```js\n// è§¦å‘å…ƒç´ ç§»åŠ¨äº‹ä»¶ï¼Œç”¨äºæ˜¾ç¤ºæ ‡çº¿ã€å¸é™„åŠŸèƒ½\n// åé¢ä¸¤ä¸ªå‚æ•°ä»£è¡¨é¼ æ ‡ç§»åŠ¨æ–¹å‘\n// currY - startY > 0 true è¡¨ç¤ºå‘ä¸‹ç§»åŠ¨ false è¡¨ç¤ºå‘ä¸Šç§»åŠ¨\n// currX - startX > 0 true è¡¨ç¤ºå‘å³ç§»åŠ¨ false è¡¨ç¤ºå‘å·¦ç§»åŠ¨\neventBus.$emit('move', this.$el, currY - startY > 0, currX - startX > 0)\n```\n\n![](https://panyu97py.github.io/post-images/1613499714989.gif)\n\n### 8. ç»„ä»¶å±æ€§è®¾ç½®\næ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€äº›é€šç”¨å±æ€§å’Œç‹¬æœ‰çš„å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªèƒ½æ˜¾ç¤ºå’Œä¿®æ”¹å±æ€§çš„åœ°æ–¹ã€‚\n```js\n// æ¯ä¸ªç»„ä»¶æ•°æ®å¤§æ¦‚æ˜¯è¿™æ ·\n{\n    component: 'v-text', // ç»„ä»¶åç§°ï¼Œéœ€è¦æå‰æ³¨å†Œåˆ° Vue\n    label: 'æ–‡å­—', // å·¦ä¾§ç»„ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—\n    propValue: 'æ–‡å­—', // ç»„ä»¶æ‰€ä½¿ç”¨çš„å€¼\n    icon: 'el-icon-edit', // å·¦ä¾§ç»„ä»¶åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„åå­—\n    animations: [], // åŠ¨ç”»åˆ—è¡¨\n    events: {}, // äº‹ä»¶åˆ—è¡¨\n    style: { // ç»„ä»¶æ ·å¼\n        width: 200,\n        height: 33,\n        fontSize: 14,\n        fontWeight: 500,\n        lineHeight: '',\n        letterSpacing: 0,\n        textAlign: '',\n        color: '',\n    },\n}\n```\n\n![](https://panyu97py.github.io/post-images/1613499824580.png)\n\næˆ‘å®šä¹‰äº†ä¸€ä¸ª `AttrList` ç»„ä»¶ï¼Œç”¨äºæ˜¾ç¤ºæ¯ä¸ªç»„ä»¶çš„å±æ€§ã€‚\n```html\n<template>\n    <div class=\"attr-list\">\n        <el-form>\n            <el-form-item v-for=\"(key, index) in styleKeys\" :key=\"index\" :label=\"map[key]\">\n                <el-color-picker v-if=\"key == 'borderColor'\" v-model=\"curComponent.style[key]\"></el-color-picker>\n                <el-color-picker v-else-if=\"key == 'color'\" v-model=\"curComponent.style[key]\"></el-color-picker>\n                <el-color-picker v-else-if=\"key == 'backgroundColor'\" v-model=\"curComponent.style[key]\"></el-color-picker>\n                <el-select v-else-if=\"key == 'textAlign'\" v-model=\"curComponent.style[key]\">\n                    <el-option\n                        v-for=\"item in options\"\n                        :key=\"item.value\"\n                        :label=\"item.label\"\n                        :value=\"item.value\"\n                    ></el-option>\n                </el-select>\n                <el-input type=\"number\" v-else v-model=\"curComponent.style[key]\" />\n            </el-form-item>\n            <el-form-item label=\"å†…å®¹\" v-if=\"curComponent && curComponent.propValue && !excludes.includes(curComponent.component)\">\n                <el-input type=\"textarea\" v-model=\"curComponent.propValue\" />\n            </el-form-item>\n        </el-form>\n    </div>\n</template>\n```\nä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯éå†ç»„ä»¶çš„ `style` å¯¹è±¡ï¼Œå°†æ¯ä¸€ä¸ªå±æ€§éå†å‡ºæ¥ã€‚å¹¶ä¸”éœ€è¦æ ¹æ®å…·ä½“çš„å±æ€§ç”¨ä¸åŒçš„ç»„ä»¶æ˜¾ç¤ºå‡ºæ¥ï¼Œä¾‹å¦‚é¢œè‰²å±æ€§ï¼Œéœ€è¦ç”¨é¢œè‰²é€‰æ‹©å™¨æ˜¾ç¤ºï¼›æ•°å€¼ç±»çš„å±æ€§éœ€è¦ç”¨ `type=number`çš„ `input` ç»„ä»¶æ˜¾ç¤ºç­‰ç­‰ã€‚\nä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ä¿®æ”¹å±æ€§å€¼ï¼Œæˆ‘ä½¿ç”¨ `v-model` å°†ç»„ä»¶å’Œå€¼ç»‘å®šåœ¨ä¸€èµ·ã€‚\n\n![](https://panyu97py.github.io/post-images/1613499927469.gif)\n\n### 9. é¢„è§ˆã€ä¿å­˜ä»£ç \né¢„è§ˆå’Œç¼–è¾‘çš„æ¸²æŸ“åŸç†æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«æ˜¯ä¸éœ€è¦ç¼–è¾‘åŠŸèƒ½ã€‚æ‰€ä»¥åªéœ€è¦å°†åŸå…ˆæ¸²æŸ“ç»„ä»¶çš„ä»£ç ç¨å¾®æ”¹ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚\n```js\n<!--é¡µé¢ç»„ä»¶åˆ—è¡¨å±•ç¤º-->\n<Shape v-for=\"(item, index) in componentData\"\n    :defaultStyle=\"item.style\"\n    :style=\"getShapeStyle(item.style, index)\"\n    :key=\"item.id\"\n    :active=\"item === curComponent\"\n    :element=\"item\"\n    :zIndex=\"index\"\n>\n    <component\n        class=\"component\"\n        :is=\"item.component\"\n        :style=\"getComponentStyle(item.style)\"\n        :propValue=\"item.propValue\"\n    />\n</Shape>\n```\n\nç»è¿‡åˆšæ‰çš„ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“ `Shape` ç»„ä»¶å…·å¤‡äº†æ‹–æ‹½ã€æ”¾å¤§ç¼©å°çš„åŠŸèƒ½ã€‚ç°åœ¨åªéœ€è¦å°† `Shape` ç»„ä»¶å»æ‰ï¼Œå¤–é¢æ”¹æˆå¥—ä¸€ä¸ªæ™®é€šçš„ `DIV` å°±å¯ä»¥äº†ï¼ˆå…¶å®ä¸ç”¨è¿™ä¸ª`DIV` ä¹Ÿè¡Œï¼Œä½†ä¸ºäº†ç»‘å®šäº‹ä»¶è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šï¼‰ã€‚\n\n```html\n<!--é¡µé¢ç»„ä»¶åˆ—è¡¨å±•ç¤º-->\n<div v-for=\"(item, index) in componentData\" :key=\"item.id\">\n    <component\n        class=\"component\"\n        :is=\"item.component\"\n        :style=\"getComponentStyle(item.style)\"\n        :propValue=\"item.propValue\"\n    />\n</div>\n```\n\nä¿å­˜ä»£ç çš„åŠŸèƒ½ä¹Ÿç‰¹åˆ«ç®€å•ï¼Œåªéœ€è¦ä¿å­˜ç”»å¸ƒä¸Šçš„æ•°æ® `componentData` å³å¯ã€‚ä¿å­˜æœ‰ä¸¤ç§é€‰æ‹©ï¼š\n\n1. ä¿å­˜åˆ°æœåŠ¡å™¨\n2. æœ¬åœ°ä¿å­˜\nåœ¨ DEMO ä¸Šæˆ‘ä½¿ç”¨çš„ localStorage ä¿å­˜åœ¨æœ¬åœ°ã€‚\n\n![](https://panyu97py.github.io/post-images/1613500069119.gif)\n\n### 10. ç»‘å®šäº‹ä»¶\n\næ¯ä¸ªç»„ä»¶æœ‰ä¸€ä¸ª `events` å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨ç»‘å®šçš„äº‹ä»¶ã€‚ç›®å‰æˆ‘åªå®šä¹‰äº†ä¸¤ä¸ªäº‹ä»¶ï¼š\n\n1. alert äº‹ä»¶\n2. redirect äº‹ä»¶\n\n```js\n// ç¼–è¾‘å™¨è‡ªå®šä¹‰äº‹ä»¶\nconst events = {\n    redirect(url) {\n        if (url) {\n            window.location.href = url\n        }\n    },\n\n    alert(msg) {\n        if (msg) {\n            alert(msg)\n        }\n    },\n}\n\nconst mixins = {\n    methods: events,\n}\n\nconst eventList = [\n    {\n        key: 'redirect',\n        label: 'è·³è½¬äº‹ä»¶',\n        event: events.redirect,\n        param: '',\n    },\n    {\n        key: 'alert',\n        label: 'alert äº‹ä»¶',\n        event: events.alert,\n        param: '',\n    },\n]\n\nexport {\n    mixins,\n    events,\n    eventList,\n}\n\n```\n\nä¸è¿‡ä¸èƒ½åœ¨ç¼–è¾‘çš„æ—¶å€™è§¦å‘ï¼Œå¯ä»¥åœ¨é¢„è§ˆçš„æ—¶å€™è§¦å‘ã€‚\n\n![](https://panyu97py.github.io/post-images/1613500164656.gif)\n\n#### æ·»åŠ äº‹ä»¶\n\né€šè¿‡ `v-for` æŒ‡ä»¤å°†äº‹ä»¶åˆ—è¡¨æ¸²æŸ“å‡ºæ¥ï¼š\n\n```html\n<el-tabs v-model=\"eventActiveName\">\n    <el-tab-pane v-for=\"item in eventList\" :key=\"item.key\" :label=\"item.label\" :name=\"item.key\" style=\"padding: 0 20px\">\n        <el-input v-if=\"item.key == 'redirect'\" v-model=\"item.param\" type=\"textarea\" placeholder=\"è¯·è¾“å…¥å®Œæ•´çš„ URL\" />\n        <el-input v-if=\"item.key == 'alert'\" v-model=\"item.param\" type=\"textarea\" placeholder=\"è¯·è¾“å…¥è¦ alert çš„å†…å®¹\" />\n        <el-button style=\"margin-top: 20px;\" @click=\"addEvent(item.key, item.param)\">ç¡®å®š</el-button>\n    </el-tab-pane>\n</el-tabs>\n```\né€‰ä¸­äº‹ä»¶æ—¶å°†äº‹ä»¶æ·»åŠ åˆ°ç»„ä»¶çš„ `events` å¯¹è±¡ã€‚\n\n#### è§¦å‘äº‹ä»¶\n\né¢„è§ˆæˆ–çœŸæ­£æ¸²æŸ“é¡µé¢æ—¶ï¼Œä¹Ÿéœ€è¦åœ¨æ¯ä¸ªç»„ä»¶å¤–é¢å¥—ä¸€å±‚ DIVï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ DIV ä¸Šç»‘å®šä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»æ—¶è§¦å‘æˆ‘ä»¬åˆšæ‰æ·»åŠ çš„äº‹ä»¶ã€‚\n\n```html\n<template>\n    <div @click=\"handleClick\">\n        <component\n            class=\"conponent\"\n            :is=\"config.component\"\n            :style=\"getStyle(config.style)\"\n            :propValue=\"config.propValue\"\n        />\n    </div>\n</template>\n```\n```js\nhandleClick() {\n    const events = this.config.events\n    // å¾ªç¯è§¦å‘ç»‘å®šçš„äº‹ä»¶\n    Object.keys(events).forEach(event => {\n        this[event](events[event])\n    })\n}\n```\n\n### 11. ç»‘å®šåŠ¨ç”»\n\nåŠ¨ç”»å’Œäº‹ä»¶çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå…ˆå°†æ‰€æœ‰çš„åŠ¨ç”»é€šè¿‡ `v-for`æŒ‡ä»¤æ¸²æŸ“å‡ºæ¥ï¼Œç„¶åç‚¹å‡»åŠ¨ç”»å°†å¯¹åº”çš„åŠ¨ç”»æ·»åŠ åˆ°ç»„ä»¶çš„ `animations` æ•°ç»„é‡Œã€‚åŒäº‹ä»¶ä¸€æ ·ï¼Œæ‰§è¡Œçš„æ—¶å€™ä¹Ÿæ˜¯éå†ç»„ä»¶æ‰€æœ‰çš„åŠ¨ç”»å¹¶æ‰§è¡Œã€‚\n\nä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† [`animate.css` ](https://animate.style/)åŠ¨ç”»åº“ã€‚\n\n```js\n// main.js\nimport '@/styles/animate.css'\n```\n\nç°åœ¨æˆ‘ä»¬æå‰å®šä¹‰å¥½æ‰€æœ‰çš„åŠ¨ç”»æ•°æ®ï¼š\n\n```js\nexport default [\n    {\n        label: 'è¿›å…¥',\n        children: [\n            { label: 'æ¸æ˜¾', value: 'fadeIn' },\n            { label: 'å‘å³è¿›å…¥', value: 'fadeInLeft' },\n            { label: 'å‘å·¦è¿›å…¥', value: 'fadeInRight' },\n            { label: 'å‘ä¸Šè¿›å…¥', value: 'fadeInUp' },\n            { label: 'å‘ä¸‹è¿›å…¥', value: 'fadeInDown' },\n            { label: 'å‘å³é•¿è·è¿›å…¥', value: 'fadeInLeftBig' },\n            { label: 'å‘å·¦é•¿è·è¿›å…¥', value: 'fadeInRightBig' },\n            { label: 'å‘ä¸Šé•¿è·è¿›å…¥', value: 'fadeInUpBig' },\n            { label: 'å‘ä¸‹é•¿è·è¿›å…¥', value: 'fadeInDownBig' },\n            { label: 'æ—‹è½¬è¿›å…¥', value: 'rotateIn' },\n            { label: 'å·¦é¡ºæ—¶é’ˆæ—‹è½¬', value: 'rotateInDownLeft' },\n            { label: 'å³é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateInDownRight' },\n            { label: 'å·¦é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateInUpLeft' },\n            { label: 'å³é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateInUpRight' },\n            { label: 'å¼¹å…¥', value: 'bounceIn' },\n            { label: 'å‘å³å¼¹å…¥', value: 'bounceInLeft' },\n            { label: 'å‘å·¦å¼¹å…¥', value: 'bounceInRight' },\n            { label: 'å‘ä¸Šå¼¹å…¥', value: 'bounceInUp' },\n            { label: 'å‘ä¸‹å¼¹å…¥', value: 'bounceInDown' },\n            { label: 'å…‰é€Ÿä»å³è¿›å…¥', value: 'lightSpeedInRight' },\n            { label: 'å…‰é€Ÿä»å·¦è¿›å…¥', value: 'lightSpeedInLeft' },\n            { label: 'å…‰é€Ÿä»å³é€€å‡º', value: 'lightSpeedOutRight' },\n            { label: 'å…‰é€Ÿä»å·¦é€€å‡º', value: 'lightSpeedOutLeft' },\n            { label: 'Yè½´æ—‹è½¬', value: 'flip' },\n            { label: 'ä¸­å¿ƒXè½´æ—‹è½¬', value: 'flipInX' },\n            { label: 'ä¸­å¿ƒYè½´æ—‹è½¬', value: 'flipInY' },\n            { label: 'å·¦é•¿åŠå¾„æ—‹è½¬', value: 'rollIn' },\n            { label: 'ç”±å°å˜å¤§è¿›å…¥', value: 'zoomIn' },\n            { label: 'å·¦å˜å¤§è¿›å…¥', value: 'zoomInLeft' },\n            { label: 'å³å˜å¤§è¿›å…¥', value: 'zoomInRight' },\n            { label: 'å‘ä¸Šå˜å¤§è¿›å…¥', value: 'zoomInUp' },\n            { label: 'å‘ä¸‹å˜å¤§è¿›å…¥', value: 'zoomInDown' },\n            { label: 'å‘å³æ»‘åŠ¨å±•å¼€', value: 'slideInLeft' },\n            { label: 'å‘å·¦æ»‘åŠ¨å±•å¼€', value: 'slideInRight' },\n            { label: 'å‘ä¸Šæ»‘åŠ¨å±•å¼€', value: 'slideInUp' },\n            { label: 'å‘ä¸‹æ»‘åŠ¨å±•å¼€', value: 'slideInDown' },\n        ],\n    },\n    {\n        label: 'å¼ºè°ƒ',\n        children: [\n            { label: 'å¼¹è·³', value: 'bounce' },\n            { label: 'é—ªçƒ', value: 'flash' },\n            { label: 'æ”¾å¤§ç¼©å°', value: 'pulse' },\n            { label: 'æ”¾å¤§ç¼©å°å¼¹ç°§', value: 'rubberBand' },\n            { label: 'å·¦å³æ™ƒåŠ¨', value: 'headShake' },\n            { label: 'å·¦å³æ‰‡å½¢æ‘‡æ‘†', value: 'swing' },\n            { label: 'æ”¾å¤§æ™ƒåŠ¨ç¼©å°', value: 'tada' },\n            { label: 'æ‰‡å½¢æ‘‡æ‘†', value: 'wobble' },\n            { label: 'å·¦å³ä¸Šä¸‹æ™ƒåŠ¨', value: 'jello' },\n            { label: 'Yè½´æ—‹è½¬', value: 'flip' },\n        ],\n    },\n    {\n        label: 'é€€å‡º',\n        children: [\n            { label: 'æ¸éš', value: 'fadeOut' },\n            { label: 'å‘å·¦é€€å‡º', value: 'fadeOutLeft' },\n            { label: 'å‘å³é€€å‡º', value: 'fadeOutRight' },\n            { label: 'å‘ä¸Šé€€å‡º', value: 'fadeOutUp' },\n            { label: 'å‘ä¸‹é€€å‡º', value: 'fadeOutDown' },\n            { label: 'å‘å·¦é•¿è·é€€å‡º', value: 'fadeOutLeftBig' },\n            { label: 'å‘å³é•¿è·é€€å‡º', value: 'fadeOutRightBig' },\n            { label: 'å‘ä¸Šé•¿è·é€€å‡º', value: 'fadeOutUpBig' },\n            { label: 'å‘ä¸‹é•¿è·é€€å‡º', value: 'fadeOutDownBig' },\n            { label: 'æ—‹è½¬é€€å‡º', value: 'rotateOut' },\n            { label: 'å·¦é¡ºæ—¶é’ˆæ—‹è½¬', value: 'rotateOutDownLeft' },\n            { label: 'å³é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateOutDownRight' },\n            { label: 'å·¦é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateOutUpLeft' },\n            { label: 'å³é€†æ—¶é’ˆæ—‹è½¬', value: 'rotateOutUpRight' },\n            { label: 'å¼¹å‡º', value: 'bounceOut' },\n            { label: 'å‘å·¦å¼¹å‡º', value: 'bounceOutLeft' },\n            { label: 'å‘å³å¼¹å‡º', value: 'bounceOutRight' },\n            { label: 'å‘ä¸Šå¼¹å‡º', value: 'bounceOutUp' },\n            { label: 'å‘ä¸‹å¼¹å‡º', value: 'bounceOutDown' },\n            { label: 'ä¸­å¿ƒXè½´æ—‹è½¬', value: 'flipOutX' },\n            { label: 'ä¸­å¿ƒYè½´æ—‹è½¬', value: 'flipOutY' },\n            { label: 'å·¦é•¿åŠå¾„æ—‹è½¬', value: 'rollOut' },\n            { label: 'ç”±å°å˜å¤§é€€å‡º', value: 'zoomOut' },\n            { label: 'å·¦å˜å¤§é€€å‡º', value: 'zoomOutLeft' },\n            { label: 'å³å˜å¤§é€€å‡º', value: 'zoomOutRight' },\n            { label: 'å‘ä¸Šå˜å¤§é€€å‡º', value: 'zoomOutUp' },\n            { label: 'å‘ä¸‹å˜å¤§é€€å‡º', value: 'zoomOutDown' },\n            { label: 'å‘å·¦æ»‘åŠ¨æ”¶èµ·', value: 'slideOutLeft' },\n            { label: 'å‘å³æ»‘åŠ¨æ”¶èµ·', value: 'slideOutRight' },\n            { label: 'å‘ä¸Šæ»‘åŠ¨æ”¶èµ·', value: 'slideOutUp' },\n            { label: 'å‘ä¸‹æ»‘åŠ¨æ”¶èµ·', value: 'slideOutDown' },\n        ],\n    },\n]\n```\nç„¶åç”¨` v-for `æŒ‡ä»¤æ¸²æŸ“å‡ºæ¥åŠ¨ç”»åˆ—è¡¨ã€‚\n![](https://panyu97py.github.io/post-images/1613500419330.gif)\n\n#### æ·»åŠ åŠ¨ç”»\n\n```html\n<el-tabs v-model=\"animationActiveName\">\n    <el-tab-pane v-for=\"item in animationClassData\" :key=\"item.label\" :label=\"item.label\" :name=\"item.label\">\n        <el-scrollbar class=\"animate-container\">\n            <div\n                class=\"animate\"\n                v-for=\"(animate, index) in item.children\"\n                :key=\"index\"\n                @mouseover=\"hoverPreviewAnimate = animate.value\"\n                @click=\"addAnimation(animate)\"\n            >\n                <div :class=\"[hoverPreviewAnimate === animate.value && animate.value + ' animated']\">\n                    {{ animate.label }}\n                </div>\n            </div>\n        </el-scrollbar>\n    </el-tab-pane>\n</el-tabs>\n```\nç‚¹å‡»åŠ¨ç”»å°†è°ƒç”¨ `addAnimation(animate)` å°†åŠ¨ç”»æ·»åŠ åˆ°ç»„ä»¶çš„ `animations` æ•°ç»„ã€‚\n\n#### è§¦å‘åŠ¨ç”»\n\nè¿è¡ŒåŠ¨ç”»çš„ä»£ç ï¼š\n\n```js\nexport default async function runAnimation($el, animations = []) {\n    const play = (animation) => new Promise(resolve => {\n        $el.classList.add(animation.value, 'animated')\n        const removeAnimation = () => {\n            $el.removeEventListener('animationend', removeAnimation)\n            $el.removeEventListener('animationcancel', removeAnimation)\n            $el.classList.remove(animation.value, 'animated')\n            resolve()\n        }\n            \n        $el.addEventListener('animationend', removeAnimation)\n        $el.addEventListener('animationcancel', removeAnimation)\n    })\n\n    for (let i = 0, len = animations.length; i < len; i++) {\n        await play(animations[i])\n    }\n}\n```\n\nè¿è¡ŒåŠ¨ç”»éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šç»„ä»¶å¯¹åº”çš„ `DOM` å…ƒç´ ï¼ˆåœ¨ç»„ä»¶ä½¿ç”¨ `this.$el `è·å–ï¼‰å’Œå®ƒçš„åŠ¨ç”»æ•°æ® `animations`ã€‚å¹¶ä¸”éœ€è¦ç›‘å¬ `animationend` äº‹ä»¶å’Œ `animationcancel` äº‹ä»¶ï¼šä¸€ä¸ªæ˜¯åŠ¨ç”»ç»“æŸæ—¶è§¦å‘ï¼Œä¸€ä¸ªæ˜¯åŠ¨ç”»æ„å¤–ç»ˆæ­¢æ—¶è§¦å‘ã€‚\nåˆ©ç”¨è¿™ä¸€ç‚¹å†é…åˆ `Promise` ä¸€èµ·ä½¿ç”¨ï¼Œå°±å¯ä»¥é€ä¸ªè¿è¡Œç»„ä»¶çš„æ¯ä¸ªåŠ¨ç”»äº†ã€‚\n\n### 12. å¯¼å…¥ PSD\n\nç”±äºæ—¶é—´å…³ç³»ï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘è¿˜æ²¡åšã€‚ç°åœ¨ç®€å•çš„æè¿°ä¸€ä¸‹æ€ä¹ˆåšè¿™ä¸ªåŠŸèƒ½ã€‚é‚£å°±æ˜¯ä½¿ç”¨ [`psd.js`](https://github.com/meltingice/psd.js#readme) åº“ï¼Œå®ƒå¯ä»¥è§£æ `PSD` æ–‡ä»¶ã€‚\n\nä½¿ç”¨ `psd.js` åº“è§£æ `PSD` æ–‡ä»¶å¾—å‡ºçš„æ•°æ®å¦‚ä¸‹ï¼š\n\n```js\n{ children: \n   [ { type: 'group',\n       visible: false,\n       opacity: 1,\n       blendingMode: 'normal',\n       name: 'Version D',\n       left: 0,\n       right: 900,\n       top: 0,\n       bottom: 600,\n       height: 600,\n       width: 900,\n       children: \n        [ { type: 'layer',\n            visible: true,\n            opacity: 1,\n            blendingMode: 'normal',\n            name: 'Make a change and save.',\n            left: 275,\n            right: 636,\n            top: 435,\n            bottom: 466,\n            height: 31,\n            width: 361,\n            mask: {},\n            text: \n             { value: 'Make a change and save.',\n               font: \n                { name: 'HelveticaNeue-Light',\n                  sizes: [ 33 ],\n                  colors: [ [ 85, 96, 110, 255 ] ],\n                  alignment: [ 'center' ] },\n               left: 0,\n               top: 0,\n               right: 0,\n               bottom: 0,\n               transform: { xx: 1, xy: 0, yx: 0, yy: 1, tx: 456, ty: 459 } },\n            image: {} } ] } ],\n    document: \n       { width: 900,\n         height: 600,\n         resources: \n          { layerComps: \n             [ { id: 692243163, name: 'Version A', capturedInfo: 1 },\n               { id: 725235304, name: 'Version B', capturedInfo: 1 },\n               { id: 730932877, name: 'Version C', capturedInfo: 1 } ],\n            guides: [],\n            slices: [] } } }\n\n```\n\nä»ä»¥ä¸Šä»£ç å¯ä»¥å‘ç°ï¼Œè¿™äº›æ•°æ®å’Œ `css` éå¸¸åƒã€‚æ ¹æ®è¿™ä¸€ç‚¹ï¼Œåªéœ€è¦å†™ä¸€ä¸ªè½¬æ¢å‡½æ•°ï¼Œå°†è¿™äº›æ•°æ®è½¬æ¢æˆæˆ‘ä»¬ç»„ä»¶æ‰€éœ€çš„æ•°æ®ï¼Œå°±èƒ½å®ç° `PSD`æ–‡ä»¶è½¬æˆæ¸²æŸ“ç»„ä»¶çš„åŠŸèƒ½ã€‚ç›®å‰ [`quark-h5`](https://github.com/huangwei9527/quark-h5) å’Œ [`luban-h5`](https://github.com/ly525/luban-h5) éƒ½æ˜¯è¿™æ ·å®ç°çš„ `PSD` è½¬æ¢åŠŸèƒ½ã€‚\n\n### 13. æ‰‹æœºæ¨¡å¼\n\nç”±äºç”»å¸ƒæ˜¯å¯ä»¥è°ƒæ•´å¤§å°çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ iphone6 çš„åˆ†è¾¨ç‡æ¥å¼€å‘æ‰‹æœºé¡µé¢ã€‚\n\n![](https://panyu97py.github.io/post-images/1613500731839.png)\n\n### æ€»ç»“\n\nç”±äº DEMO çš„ä»£ç æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åœ¨è®²è§£æ¯ä¸€ä¸ªåŠŸèƒ½ç‚¹æ—¶ï¼Œæˆ‘åªæŠŠå…³é”®ä»£ç è´´ä¸Šæ¥ã€‚æ‰€ä»¥å¤§å®¶ä¼šå‘ç° DEMO çš„æºç å’Œæˆ‘è´´ä¸Šæ¥çš„ä»£ç ä¼šæœ‰äº›åŒºåˆ«ï¼Œè¯·ä¸å¿…åœ¨æ„ã€‚\n\nå¦å¤–ï¼ŒDEMO çš„æ ·å¼ä¹Ÿæ¯”è¾ƒç®€é™‹ï¼Œä¸»è¦æ˜¯æœ€è¿‘äº‹æƒ…æ¯”è¾ƒå¤šï¼Œæ²¡å¤ªå¤šæ—¶é—´å†™å¥½çœ‹ç‚¹ï¼Œè¯·è§è°…ã€‚\n",
      "data": {
        "title": "å¯è§†åŒ–æ‹–æ‹½ç»„ä»¶åº“ä¸€äº›æŠ€æœ¯è¦ç‚¹åŸç†åˆ†æï¼ˆä¸€ï¼‰",
        "date": "2021-02-17 01:33:54",
        "tags": [
          "vue"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "gFf8ea3r7"
    },
    {
      "content": "æœ¬æ–‡è½¬è‡ª[segmentfault](https://segmentfault.com/a/1190000021707081)\n\næœ¬æ–‡ä»…è®°å½•å­˜åœ¨è¿™ç§äº‹ä»¶ä¼ é€’çš„æ–¹å¼ï¼Œä½†ä¸æ¨å´‡ã€‚\n\n`EventBus`åˆç§°ä¸ºäº‹ä»¶æ€»çº¿ã€‚åœ¨`Vue`ä¸­å¯ä»¥ä½¿ç”¨ `EventBus` æ¥ä½œä¸ºç»„ä»¶ä¼ é€’æ•°æ®çš„æ¡¥æ¢çš„ï¼Œå°±åƒæ˜¯æ‰€æœ‰ç»„ä»¶å…±ç”¨ç›¸åŒçš„äº‹ä»¶ä¸­å¿ƒï¼Œå¯ä»¥å‘è¯¥ä¸­å¿ƒæ³¨å†Œå‘é€äº‹ä»¶æˆ–æ¥æ”¶äº‹ä»¶ï¼Œæ‰€ä»¥ç»„ä»¶éƒ½å¯ä»¥ä¸Šä¸‹å¹³è¡Œåœ°é€šçŸ¥å…¶ä»–ç»„ä»¶ï¼Œä½†ä¹Ÿå°±æ˜¯å¤ªæ–¹ä¾¿æ‰€ä»¥è‹¥ä½¿ç”¨ä¸æ…ï¼Œå°±ä¼šé€ æˆéš¾ä»¥ç»´æŠ¤çš„ç¾éš¾ï¼Œå› æ­¤æ‰éœ€è¦æ›´å®Œå–„çš„`Vuex`ä½œä¸ºçŠ¶æ€ç®¡ç†ä¸­å¿ƒï¼Œå°†é€šçŸ¥çš„æ¦‚å¿µä¸Šå‡åˆ°å…±äº«çŠ¶æ€å±‚æ¬¡ã€‚\n\n>å®˜æ–¹æ¨èçš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆæ˜¯ `Vuex`ã€‚ä¸è¿‡å¦‚æœé¡¹ç›®ä¸æ˜¯å¾ˆå¤§ï¼ŒçŠ¶æ€ç®¡ç†ä¹Ÿæ²¡æœ‰å¾ˆå¤æ‚çš„è¯ï¼Œä½¿ç”¨ Vuex æ²¡å¿…è¦ã€‚\n\n## ä½¿ç”¨ EventBus\n> ä½ éœ€è¦åšçš„åªæ˜¯å¼•å…¥ `Vue` å¹¶å¯¼å‡ºå®ƒçš„ä¸€ä¸ªå®ä¾‹ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ç§°å®ƒä¸º `EventBus` ï¼‰ã€‚å®è´¨ä¸Šå®ƒæ˜¯ä¸€ä¸ªä¸å…·å¤‡ `DOM` çš„ç»„ä»¶ï¼Œå®ƒå…·æœ‰çš„ä»…ä»…åªæ˜¯å®ƒå®ä¾‹æ–¹æ³•è€Œå·²ï¼Œå› æ­¤å®ƒéå¸¸çš„è½»ä¾¿ã€‚\n### åˆå§‹åŒ–\n\n* ç¬¬ä¸€ç§æ–¹å¼: å¯ä»¥åœ¨ `main.js`ä¸­ï¼Œåˆå§‹åŒ– `EventBus`\n\n```\nVue.prototype.$EventBus = new Vue()\n```\n\n* ç¬¬äºŒç§æ–¹å¼: åˆ›å»ºä¸€ä¸ª `Bus.js`,å†åˆ›å»ºäº‹ä»¶æ€»çº¿å¹¶å°†å…¶å¯¼å‡ºï¼Œä»¥ä¾¿å…¶å®ƒæ¨¡å—å¯ä»¥ä½¿ç”¨æˆ–è€…ç›‘å¬å®ƒ\n\n```\n// Bus.js\nimport Vue from 'vue'\nexport const EventBus = new Vue();\n```\n\nç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº† `EventBus` ï¼Œæ¥ä¸‹æ¥ä½ éœ€è¦åšåˆ°çš„å°±æ˜¯åœ¨ä½ çš„ç»„ä»¶ä¸­åŠ è½½å®ƒï¼Œå¹¶ä¸”è°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•ï¼Œå°±å¦‚ä½ åœ¨çˆ¶å­ç»„ä»¶ä¸­äº’ç›¸ä¼ é€’æ¶ˆæ¯ä¸€æ ·ã€‚\n\n### å‘é€å’Œæ¥å—äº‹ä»¶\n\nå…¶å®å’Œ çˆ¶å­ç»„ä»¶çš„é€šä¿¡å·®ä¸å¤š,ç”¨ `EventBus.$emit('eventName',data)`å‘é€ï¼Œ `EventBus.$on(\"eventName\", callback(payload1,â€¦))` æ¥å—\n\nç°åœ¨å‡è®¾ A ç»„ä»¶ä¸ B ç»„ä»¶é€šä¿¡\n\n```\n<!-- A.vue -->\n<template>\n    <p>{{msgB}}</p>\n    <button @click=\"sendMsgA()\">-</button>\n</template>\n\n<script> \nimport { EventBus } from \"../Bus.js\";\nexport default {\n    data(){\n        return {\n        msg: ''\n        }\n    },\n    mounted() {\n        EventBus.$on(\"bMsg\", (msg) => {\n            // aç»„ä»¶æ¥å— bå‘é€æ¥çš„æ¶ˆæ¯\n            this.msg = msg;\n        });\n    },\n    methods: {\n        sendMsgA() {\n            EventBus.$emit(\"aMsg\", 'æ¥è‡ªAé¡µé¢çš„æ¶ˆæ¯'); // a å‘é€æ•°æ®\n        }\n    }\n}; \n</script>\n\n\n<!-- B.vue -->\n<template>\n  <p>{{msgA}}</p>\n    <button @click=\"sendMsgB()\">-</button>\n</template>\n\n<script> \nimport { EventBus } from \"../event-bus.js\";\nexport default {\n    data(){\n        return {\n        msg: ''\n        }\n    },\n    mounted() {\n        EventBus.$on(\"aMsg\", (msg) => {\n            // bç»„ä»¶æ¥å— aå‘é€æ¥çš„æ¶ˆæ¯\n            this.msg = msg;\n        });\n    },\n    methods: {\n        sendMsgB() {\n            EventBus.$emit(\"bMsg\", 'æ¥è‡ªbé¡µé¢çš„æ¶ˆæ¯'); // bå‘é€æ•°æ®\n        }\n    }\n};\n</script>\n```\nå¦‚æœåªç›‘å¬(æ¥å—)ä¸€æ¬¡æ•°æ®å¯ä»¥ä½¿ç”¨ `EventBus.$once('eventName', callback(payload1,â€¦)`\n\n### ç§»é™¤ç§»é™¤äº‹ä»¶ç›‘å¬è€…\n\n* ç§»é™¤å•ä¸ªäº‹ä»¶ç›‘å¬ `EventBus.$off('eventName', callback)`\n* ç§»é™¤å…¨éƒ¨äº‹ä»¶ç›‘å¬ `EventBus.$off()`\n\n```\n// å¯¼å…¥æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ EventBus\nimport { EventBus } from '../Bus.js'\n\n// äº‹ä»¶ç›‘å¬å‡½æ•°\nconst clickHandler = function(clickCount) {\n  console.log(`Oh, hello)`)\n}\n\n// å¼€å§‹ç›‘å¬äº‹ä»¶\nEventBus.$on('i-got-clicked', clickHandler);\n\n// åœæ­¢ç›‘å¬\nEventBus.$off('i-got-clicked', clickHandler);\n\n```\n\n## å…¨å±€`EventBus`\n\nå…¨å±€`EventBus`ï¼Œè™½ç„¶åœ¨æŸäº›ç¤ºä¾‹ä¸­ä¸æå€¡ä½¿ç”¨ï¼Œä½†å®ƒæ˜¯ä¸€ç§éå¸¸æ¼‚äº®ä¸”ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥è·¨ç»„ä»¶ä¹‹é—´å…±äº«æ•°æ®ã€‚\n\nå®ƒçš„å·¥ä½œåŸç†æ˜¯å‘å¸ƒ/è®¢é˜…æ–¹æ³•ï¼Œé€šå¸¸ç§°ä¸º `Pub`/`Sub` ã€‚\n\nç”±äºæ˜¯å…¨å±€çš„ï¼Œå¿…ç„¶æ‰€æœ‰äº‹ä»¶éƒ½è®¢é˜…å®ƒ, æ‰€æœ‰ç»„ä»¶ä¹Ÿå‘å¸ƒåˆ°å®ƒï¼Œè®¢é˜…ç»„ä»¶è·å¾—æ›´æ–°ã€‚ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰ç»„ä»¶éƒ½èƒ½å¤Ÿå°†äº‹ä»¶å‘å¸ƒåˆ°æ€»çº¿ï¼Œç„¶åæ€»çº¿ç”±å¦ä¸€ä¸ªç»„ä»¶è®¢é˜…ï¼Œç„¶åè®¢é˜…å®ƒçš„ç»„ä»¶å°†å¾—åˆ°æ›´æ–°ã€‚\n\n### åˆ›å»ºå…¨å±€`EventBus`\n\nå…¨å±€äº‹ä»¶æ€»çº¿åªä¸è¿‡æ˜¯ä¸€ä¸ªç®€å•çš„` vue` ç»„ä»¶ã€‚\n\n```\nvar EventBus = new Vue();\n\nObject.defineProperties(Vue.prototype, {\n  $bus: {\n    get: function () {\n      return EventBus\n    }\n  }\n})\n// è¿™ä¸ªåˆå§‹åŒ–çš„ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä¸ªäººæ„Ÿè§‰åŒºåˆ«ä¸å¤§\n```\n\n### ä½¿ç”¨ `$on`å’Œ`$emit`\n\nåœ¨è¿™ä¸ªç‰¹å®šçš„æ€»çº¿ä¸­ä½¿ç”¨ä¸¤ä¸ªæ–¹æ³•ã€‚ä¸€ä¸ªç”¨äºåˆ›å»ºå‘å‡ºçš„äº‹ä»¶ï¼Œå®ƒå°±æ˜¯`$emit`ï¼›å¦ä¸€ä¸ªç”¨äºè®¢é˜…`$emit`,å¹¶æ¥æ”¶å‚æ•°æ‰§è¡Œå›è°ƒï¼Œå®ƒå°±æ˜¯`$on`ï¼š\n\n```\nthis.$bus.$emit('nameOfEvent',{ ... pass some event data ...});\n\nthis.$bus.$on('nameOfEvent',($event) => {\n    // ...\n})\n```\n\n## EventBusçš„ä¼˜ç¼ºç‚¹\n\n### ç¼ºç‚¹\n* å¤§å®¶éƒ½çŸ¥é“vueæ˜¯å•é¡µåº”ç”¨ï¼Œå¦‚æœä½ åœ¨æŸä¸€ä¸ªé¡µé¢åˆ·æ–°äº†ä¹‹åï¼Œä¸ä¹‹ç›¸å…³çš„EventBusä¼šè¢«ç§»é™¤ï¼Œè¿™æ ·å°±å¯¼è‡´ä¸šåŠ¡èµ°ä¸ä¸‹å»ã€‚\n* å¦‚æœä¸šåŠ¡æœ‰åå¤æ“ä½œçš„é¡µé¢ï¼ŒEventBusåœ¨ç›‘å¬çš„æ—¶å€™å°±ä¼šè§¦å‘å¾ˆå¤šæ¬¡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„éšæ‚£ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¥½å¥½å¤„ç†EventBusåœ¨é¡¹ç›®ä¸­çš„å…³ç³»ã€‚é€šå¸¸ä¼šç”¨åˆ°ï¼Œåœ¨vueé¡µé¢é”€æ¯æ—¶ï¼ŒåŒæ—¶ç§»é™¤EventBusäº‹ä»¶ç›‘å¬ã€‚\n* ç”±äºæ˜¯éƒ½ä½¿ç”¨ä¸€ä¸ªVueå®ä¾‹ï¼Œæ‰€ä»¥å®¹æ˜“å‡ºç°é‡å¤è§¦å‘çš„æƒ…æ™¯ï¼Œä¸¤ä¸ªé¡µé¢éƒ½å®šä¹‰äº†åŒä¸€ä¸ªäº‹ä»¶åï¼Œå¹¶ä¸”æ²¡æœ‰ç”¨$offé”€æ¯ï¼ˆå¸¸å‡ºç°åœ¨è·¯ç”±åˆ‡æ¢æ—¶ï¼‰ã€‚\n\n### ä¼˜ç‚¹\n* è§£å†³äº†å¤šå±‚ç»„ä»¶ä¹‹é—´ç¹ççš„äº‹ä»¶ä¼ æ’­ã€‚\n* ä½¿ç”¨åŸç†ååˆ†ç®€å•ï¼Œä»£ç é‡å°‘ã€‚",
      "data": {
        "title": "vue -- äº‹ä»¶æ€»çº¿ EventBus",
        "date": "2021-02-17 01:01:03",
        "tags": [
          "vue"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "xNPEyzRmb"
    },
    {
      "content": "## é—®é¢˜\nçˆ¶çº§è®¾ç½®åœ†è§’å±æ€§å¤±æ•ˆ çˆ¶å…ƒç´ ä½¿ç”¨border-radiuså’Œoverflow:hiddenåšæˆåœ†å½¢ï¼Œå­å…ƒç´ å¦‚æœä½¿ç”¨äº†transformå±æ€§ï¼Œåˆ™çˆ¶å…ƒç´ çš„overflow:hiddenä¼šå¤±æ•ˆã€‚\n\n## è§£å†³\n```\n-webkit-backface-visibility: hidden;\n-webkit-transform: translate3d(0, 0, 0);\n```",
      "data": {
        "title": "ios css border-radiuså…ƒç´  overflow:hiddenå¤±æ•ˆé—®é¢˜",
        "date": "2021-02-17 00:49:36",
        "tags": [
          "css"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "VnrVXCKIi"
    },
    {
      "content": "æœ¬æ–‡æ‘˜è‡ª[ç®€ä¹¦](https://www.jianshu.com/p/fdb1421f3c8b)\n\næ›´æ–°`Xcode 10`ï¼Œè‡ªç„¶å¼€å§‹ç¬¬ä¸€æ—¶é—´è¿è¡Œè€é¡¹ç›®ï¼Œè¸©å‘å¡«å‘\n\n### è¿™è¾¹è®°å½•ä¸‹åŸºæœ¬å‡ºç°çš„é—®é¢˜\n\n> `Error: Multiple commands produce`\n\nXcode 10 ä¸æœ¬é—®é¢˜ç›¸å…³çš„ä¸€ä¸ªæ›´æ–°ç‚¹ã€‚\n\n>Build System\nAgain, Xcode 10 uses a new build system. The new build system provides improved reliability and build performance, and it catches project configuration problems that the legacy build system does not.\nThe legacy build system is still available in Xcode 10. To use the legacy build system, select it in the File > Project/Workspace Settings sheet. Projects configured to use the legacy build system will display an orange hammer icon in the Activity View.\n\nç®€å•è€Œè¨€ï¼Œ`Xcode10`ä½¿ç”¨äº†ä¸€ä¸ªçš„æ–°åˆ›å»ºç³»ç»Ÿï¼Œæ¯”ä¹‹å‰çš„æä¾›æ›´å¥½çš„å¯é æ€§ä¸åˆ›å»ºæ€§èƒ½ï¼Œè€Œä¸”å¯ä»¥è·å–é¡¹ç›®é…ç½®é—®é¢˜ï¼ˆé»˜è®¤è®¾ç½®æ–°åˆ›å»ºç³»ç»Ÿï¼‰\n\nåœ¨è‹¹æœæ–‡æ¡£ä¸­ï¼ŒæåŠ`Xcode10`ä¸­çš„å…³äºæ—§é¡¹ç›®`New Build System`æ›´æ”¹é€‚é…ä¸­æåŠåˆ°ä»¥ä¸‹ä¸¤ç‚¹\n\n* The new build system has stricter checks for cycles between elements in the build in order to prevent unnecessary rebuilds.\n\n* It is an error for any individual file in the build to be produced by more than one build command. For example, if two targets each declare the same output file from a shell script phase, factor out the declaration of the output file into a single target.\n\n`New Build System`ä¼šå¯¹æ„å»ºä¸­çš„å…ƒç´ å¾ªç¯è¿›è¡Œä¸¥æ ¼çš„æ£€æŸ¥ï¼Œé¿å…ä¸å¿…è¦çš„é‡å»ºï¼Œè¿™ä¸ªä¹Ÿæ˜¯é”™è¯¯å‡ºç°çš„åŸå› ã€‚\n\n### é”™è¯¯å‘ç”Ÿçš„ä¸¤ç§æ™®éå½¢å¼ï¼š\n\n#### 1. `info.plist`\n\n> é”™è¯¯ä¿¡æ¯\n\n```\nMultiple commands produce '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app/Info.plist':\n1) Target 'TYKYTwoLearnOneDo' (project 'TYKYTwoLearnOneDo') has copy command from '/Users/tjsoft/TYKY /å…šå»º/é»”çºª/QianJiDangJian_iOS/TYKYTwoLearnOneDo/Info.plist' to '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app/Info.plist'\n2) Target 'TYKYTwoLearnOneDo' (project 'TYKYTwoLearnOneDo') has process command with output '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app/Info.plist'\n```\n\n#### 2. `Copy Pods Resources`\n\n> é”™è¯¯ä¿¡æ¯\n\n```\nMultiple commands produce '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app':\n1) Target 'TYKYTwoLearnOneDo' has create directory command with output '/Users/tjsoft/Library/Developer/Xcode/DerivedData/TYKYTwoLearnOneDo-amcfzswumxdotlgjwdslugmywxch/Build/Products/Debug-iphoneos/TYKYTwoLearnOneDo.app'\n2) That command depends on command in Target 'TYKYTwoLearnOneDo': script phase â€œ[CP] Copy Pods Resourcesâ€\n```\n\n\n### è§£å†³æ–¹æ³•å¯ä»¥æœ‰ä¸¤ç§:\n\n#### 1. ä¸€ç§æ˜¯ä¸ä½¿ç”¨`New Build System`ï¼Œåœ¨`File` > `Project/Workspace Settings`ä¸­çš„`Share Project/Workspace Settings `é‡Œ`build system `å°†`New Build System(Default)`åˆ‡æ¢æˆ`Legacy build system`ã€‚\n\n![](https://panyu97py.github.io/post-images/1613494079991.png)\n\n#### å…¶æ¬¡æ˜¯æ ¹æ®å‡ºé”™ä¿¡æ¯ï¼Œåœ¨æ–°åˆ›å»ºç³»ç»Ÿæ¨¡å¼ä¸‹ï¼Œå»é™¤å¤šä½™çš„å¼•ç”¨é‡å»ºã€‚\n\n##### 1. Info.plist\n\nåœ¨ `target` -> `Build phase` > `Copy Bundle Resource` ä¸­æ‰¾åˆ°`info.plist`ï¼Œç§»é™¤\n\n![](https://panyu97py.github.io/post-images/1613494034862.png)\n\n\n##### 2. Copy Pods Resources\n\nåœ¨ `target` -> `Build phase` -> `Copy Pods Resources` -> `Output Files`ï¼Œç§»é™¤`${TARGET_BUILD_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}`\n\n![](https://panyu97py.github.io/post-images/1613494090242.png)\n",
      "data": {
        "title": "Xcode 10 ä¸­å…³äº Error: Multiple commands produce",
        "date": "2021-02-17 00:45:43",
        "tags": [
          "ios",
          "react-native"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "AVegNSKtq"
    },
    {
      "content": "### é¢˜ç›®æè¿°\nç»™å®šä¸¤ä¸ªå¤§å°ä¸º `m` å’Œ `n` çš„æ­£åºï¼ˆä»å°åˆ°å¤§ï¼‰æ•°ç»„Â `nums1` å’ŒÂ `nums2`ã€‚\n\nè¯·ä½ æ‰¾å‡ºè¿™ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°ï¼Œå¹¶ä¸”è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º`Â O(log(m + n))`ã€‚\n\nä½ å¯ä»¥å‡è®¾Â `nums1`Â å’ŒÂ `nums2`Â ä¸ä¼šåŒæ—¶ä¸ºç©ºã€‚\n\nÂ \n\n#### ç¤ºä¾‹1\n```\nnums1 = [1, 3]\nnums2 = [2]\n\nåˆ™ä¸­ä½æ•°æ˜¯ 2.0\n```\n#### ç¤ºä¾‹ 2\n```\nnums1 = [1, 2]\nnums2 = [3, 4]\n\nåˆ™ä¸­ä½æ•°æ˜¯ (2 + 3)/2 = 2.5\n```\n\n#### é¢˜è§£\n\n##### é¢˜è§£ä¸€ï¼šæš´åŠ›è§£æ³•\n###### æ€è·¯\næ ¹æ®é¢˜ç›®æè¿°åŠç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç”¨ len è¡¨ç¤ºåˆå¹¶åæ•°ç»„çš„é•¿åº¦å¦‚æœæ˜¯å¥‡æ•°ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç¬¬ `ï¼ˆlen+1ï¼‰/2` ä¸ªæ•°å°±å¯ä»¥äº†ï¼Œå¦‚æœéå†çš„è¯éœ€è¦éå† `Math.floor(len/2 ) + 1` æ¬¡ã€‚å¦‚æœæ˜¯å¶æ•°ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç¬¬ `len/2`å’Œ `len/2+1` ä¸ªæ•°çš„å€¼ï¼Œä¹Ÿæ˜¯éœ€è¦éå† `len/2+1` æ¬¡ã€‚æ‰€ä»¥éå†çš„è¯ï¼Œå¥‡æ•°å’Œå¶æ•°éƒ½æ˜¯ `len/2+1` æ¬¡ã€‚\n\nå³ï¼š\n* è‹¥`len%2===1`ä¸­ä½æ•°å°±æ˜¯ä½äºåˆå¹¶åæ•°ç»„`Math.floor(len/2)+1`çš„æ•°å­—ã€‚\n* è‹¥`(m+n)%2===0`ä¸­ä½æ•°å°±æ˜¯ä½äºåˆå¹¶åæ•°ç»„`len/2`å’Œ`len/2+1`çš„æ•°å­—çš„å¹³å‡æ•°ã€‚\næ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ’åºå°±å¯ä»¥äº†,è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æŒ‡é’ˆæ³•æ’åºè¿™æ ·æœ€å¤šåªéœ€è¦ç§»åŠ¨`len/2+1`å°±èƒ½è·å¾—ç­”æ¡ˆã€‚\næ—¶é—´å¤æ‚åº¦ï¼šéå† `len/2+1` æ¬¡ï¼Œ`len=m+n`ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦æ˜¯ `O(m+n)`ã€‚\n\nç©ºé—´å¤æ‚åº¦ï¼šæˆ‘ä»¬ç”³è¯·äº†å¸¸æ•°ä¸ªå˜é‡ï¼Œä¹Ÿå°±æ˜¯`m`ï¼Œ`n`ï¼Œ`len`ï¼Œ`pointer1`ï¼Œ`pointer2`ï¼Œ`newVal`ï¼Œ`oldVal` ä»¥åŠ `i`ã€‚\n\næ€»å…± 8 ä¸ªå˜é‡ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯ `O(1)`ã€‚\n\nä½†è¿™å¹¶ä¸ç¬¦åˆé¢˜ç›®ä¸­è¦æ±‚çš„æ—¶é—´å¤æ‚åº¦`O(log(m + n))`\n###### ä»£ç \n```\n/**\n * @param {number[]} nums1\n * @param {number[]} nums2\n * @return {number}\n */\nvar findMedianSortedArrays = function (nums1, nums2) {\n    let m = nums1.length\n    let n = nums2.length\n    let len = m + n\n    let pointer1 = 0, pointer2 = 0\n    let newVal, oldVal\n    for (let i = 0; i <= len / 2; i++) {\n        oldVal = newVal\n        if (pointer1 < m && (nums1[pointer1] <= nums2[pointer2] || pointer2 >= n)) {\n            newVal = nums1[pointer1++]\n        } else {\n            newVal = nums2[pointer2++]\n        }\n    }\n    if ((len % 2) === 0) {\n        return (newVal + oldVal) / 2\n    } else {\n        return newVal\n    }\n};\n```\n\n##### é¢˜è§£äºŒï¼šäºŒåˆ†æ³•\næœªå®Œå¾…ç»­ã€‚ã€‚ã€‚",
      "data": {
        "title": "å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°",
        "date": "2021-02-17 00:44:09",
        "tags": [
          "leetcodeç®—æ³•"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "d6wdVAP5_"
    },
    {
      "content": "### é¢˜ç›®æè¿°\n\nç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªç›®æ ‡å€¼ `target`ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡ºå’Œä¸ºç›®æ ‡å€¼çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›ä»–ä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚\n\nä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ ä¸èƒ½ä½¿ç”¨ä¸¤éã€‚\n\n#### ç¤ºä¾‹\n```\nç»™å®š nums = [2, 7, 11, 15], target = 9\n\nå› ä¸º nums[0] + nums[1] = 2 + 7 = 9\næ‰€ä»¥è¿”å› [0, 1]\n```\n\n\n### é¢˜è§£\n#### æ–¹æ³•ä¸€ï¼šæš´åŠ›è§£æ³•\n##### æ€è·¯ï¼š\nçœ‹åˆ°é¢˜ç›®åæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯ä¸¤ä¸ªå¾ªç¯åµŒå¥—ï¼Œéå†æ¯ä¸ªå…ƒç´ `x`ï¼Œå¹¶æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å…ƒç´ ä¸`x`ç›¸åŠ ç­‰äº`target`\n>æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)\n>ç©ºé—´å¤æ‚åº¦ï¼šO(1)\n```\nvar twoSum = function(nums, target) {\nfor (let i = 0; i < nums.length; i++) {\n        for (let j = i + 1; j < nums.length; j++) {\n            if (nums[i] + nums[j]= target) {\n                return [i, j];\n            }\n        }\n    }\n};\n```\n\n#### æ–¹æ³•äºŒï¼šä¸¤éå“ˆå¸Œè¡¨\n##### æ€è·¯ï¼š\n\nä¸ºäº†å¯¹è¿è¡Œæ—¶é—´å¤æ‚åº¦è¿›è¡Œä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨ã€‚ä¸€ä¸ªç®€å•çš„å®ç°ä½¿ç”¨äº†ä¸¤æ¬¡è¿­ä»£ã€‚åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå…ƒç´ çš„å€¼å’Œå®ƒçš„ç´¢å¼•æ·»åŠ åˆ°è¡¨ä¸­ã€‚ç„¶åï¼Œåœ¨ç¬¬äºŒæ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥æ¯ä¸ªå…ƒç´ æ‰€å¯¹åº”çš„ç›®æ ‡å…ƒç´  `target - nums[i]` æ˜¯å¦å­˜åœ¨äºè¡¨ä¸­ã€‚æ³¨æ„ï¼Œè¯¥ç›®æ ‡å…ƒç´ ä¸èƒ½æ˜¯ `nums[i]` æœ¬èº«ï¼\n\n>æ—¶é—´å¤æ‚åº¦ï¼šO(n)\n>ç©ºé—´å¤æ‚åº¦ï¼šO(n)\n\n```\nvar twoSum = function(nums, target) {\n    // æ„é€ å“ˆå¸Œè¡¨\n    var map = new Map();\n    for (let i = 0; i < nums.length; i++) {\n        //å°†æ•°æ®ä½œä¸ºmapçš„keyï¼Œæ•°æ®çš„ä½ç½®ä½œä¸ºmapçš„å€¼ï¼ˆç”±äºé¢˜ç›®ä¸­æåˆ°æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œå³æ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤çš„å…ƒç´ ï¼‰\n        map.set(nums[i], i);\n    }\n    for (let j = 0; j < nums.length; j++) {\n        let complement = target - nums[j];\n        if (map.has(complement) && map.get(complement) !== j) {\n            return [j, map.get(complement)];\n        }\n    }\n    console.log(\"No two sum solution\");\n};\n\n```\n#### æ–¹æ³•ä¸‰ï¼šä¸€éå“ˆå¸Œè¡¨\n##### æ€è·¯ï¼š\nå…¶å®æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€éå“ˆå¸Œè¡¨å®ŒæˆæŸ¥æ‰¾ï¼Œåœ¨è¿›è¡Œè¿­ä»£å¹¶å°†å…ƒç´ æ’å…¥åˆ°è¡¨ä¸­çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä¼šå›è¿‡å¤´æ¥æ£€æŸ¥è¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨å½“å‰å…ƒç´ æ‰€å¯¹åº”çš„ç›®æ ‡å…ƒç´ ã€‚å¦‚æœå®ƒå­˜åœ¨ï¼Œé‚£æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†å¯¹åº”è§£ï¼Œå¹¶ç«‹å³å°†å…¶è¿”å›ã€‚\n>æ—¶é—´å¤æ‚åº¦ï¼šO(n)\n>ç©ºé—´å¤æ‚åº¦ï¼šO(n)\n```\nvar twoSum = function(nums, target) {\n    let targetMap = new Map()\n    for(let i = 0;i<nums.length;i++){\n        let a = target - nums[i]\n        if(targetMap.has(a)){\n            return [targetMap.get(a),i]\n        }\n        targetMap.set(nums[i],i)\n    }\n};\n```",
      "data": {
        "title": "ä¸¤æ•°ä¹‹å’Œ",
        "date": "2021-02-17 00:43:37",
        "tags": [
          "leetcodeç®—æ³•"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "05Y8j1Evg"
    },
    {
      "content": "### é¢˜ç›®æè¿°\nç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚\n#### ç¤ºä¾‹1\n```\nè¾“å…¥: \"abcabcbb\"\nè¾“å‡º: 3 \nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"abc\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚\n```\n#### ç¤ºä¾‹2\n```\nè¾“å…¥: \"bbbbb\"\nè¾“å‡º: 1\nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"b\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚\n```\n#### ç¤ºä¾‹ 3\n```\nè¾“å…¥: \"pwwkew\"\nè¾“å‡º: 3\nè§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ \"wke\"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚\n     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ\"pwke\" æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚\n```\n\n### é¢˜è§£\n\n#### å®˜æ–¹é¢˜è§£\n##### æ€è·¯\n![](https://panyu97py.github.io/post-images/1613493014542.png)\nå¦‚ä¸Šå›¾æ‰€ç¤ºç›¸å½“äºå·¦å³ä¸¤ä¸ªæŒ‡é’ˆå¯¹å­—ç¬¦ä¸²å„å¾ªç¯äº†ä¸€æ¬¡\n##### ä»£ç \n```\nvar lengthOfLongestSubstring = function(s) {\n    // å“ˆå¸Œé›†åˆï¼Œè®°å½•æ¯ä¸ªå­—ç¬¦æ˜¯å¦å‡ºç°è¿‡\n    const occ = new Set();\n    const n = s.length;\n    // å³æŒ‡é’ˆï¼Œåˆå§‹å€¼ä¸º -1ï¼Œç›¸å½“äºæˆ‘ä»¬åœ¨å­—ç¬¦ä¸²çš„å·¦è¾¹ç•Œçš„å·¦ä¾§ï¼Œè¿˜æ²¡æœ‰å¼€å§‹ç§»åŠ¨\n    let rk = -1, ans = 0;\n    for (let i = 0; i < n; ++i) {\n        if (i != 0) {\n            // å·¦æŒ‡é’ˆå‘å³ç§»åŠ¨ä¸€æ ¼ï¼Œç§»é™¤ä¸€ä¸ªå­—ç¬¦\n            occ.delete(s.charAt(i - 1));\n        }\n        while (rk + 1 < n && !occ.has(s.charAt(rk + 1))) {\n            // ä¸æ–­åœ°ç§»åŠ¨å³æŒ‡é’ˆ\n            occ.add(s.charAt(rk + 1));\n            ++rk;\n        }\n        // ç¬¬ i åˆ° rk ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæé•¿çš„æ— é‡å¤å­—ç¬¦å­ä¸²\n        ans = Math.max(ans, rk - i + 1);\n    }\n    return ans;\n};\n```\n#### æˆ‘çš„é¢˜è§£\n##### æ€è·¯\nè·å–å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¹¶å¾ªç¯ã€‚æ¯æ¬¡å¾ªç¯åˆ¤æ–­mapä¸­æ˜¯å¦å­˜åœ¨keyä¸ºè¯¥å­—ç¬¦çš„å€¼è‹¥ä¸å­˜åœ¨ï¼Œå°†å­—ç¬¦ä½œä¸ºkeyï¼Œå­—ç¬¦æ‰€åœ¨çš„ä½ç½®ä½œä¸ºvalueå­˜å…¥mapä¸­ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™è·å–keyä¸ºè¯¥å­—ç¬¦çš„å€¼å°†è¯¥å€¼ä¸å½“å‰çš„startåšæ¯”è¾ƒå–è¾ƒå¤§çš„å€¼ä½œä¸ºstartã€‚æ¯æ¬¡å¾ªç¯è®¡ç®—é•¿åº¦ï¼ˆend-start+1ï¼‰å¹¶ä¸å·²å­˜åœ¨çš„é•¿åº¦æ¯”è¾ƒå–è¾ƒå¤§çš„å€¼ã€‚\n\n![](https://panyu97py.github.io/post-images/1613493060500.png)\n\n##### ä»£ç \n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar lengthOfLongestSubstring = function (s) {\n    let tempMap = new Map()\n    let start = 0\n    let length = 0\n    if(!s){\n      return 0\n    }\n    let len = s.length\n    for(let end = 0;end<len;end++){\n      if(tempMap.has(s.charAt(end))){\n        start =Math.max(start,tempMap.get(s.charAt(end))+1) \n      }\n      tempMap.set(s.charAt(end),end)\n      length = Math.max(length,end-start+1)\n    }\n    return length\n};\n```\n",
      "data": {
        "title": "æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­—ä¸²",
        "date": "2021-02-17 00:28:38",
        "tags": [
          "leetcodeç®—æ³•"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "SVgfv_u3l"
    },
    {
      "content": "### é¢˜ç›®æè¿°\nç»™å‡ºä¸¤ä¸ª éç©º çš„é“¾è¡¨ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å…¶ä¸­ï¼Œå®ƒä»¬å„è‡ªçš„ä½æ•°æ˜¯æŒ‰ç…§ é€†åº çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ ä¸€ä½ æ•°å­—ã€‚\n\nå¦‚æœï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ•°ç›¸åŠ èµ·æ¥ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨æ¥è¡¨ç¤ºå®ƒä»¬çš„å’Œã€‚\n\næ‚¨å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚\n\n#### ç¤ºä¾‹ï¼š\n```\nè¾“å…¥ï¼š(2 -> 4 -> 3) + (5 -> 6 -> 4)\nè¾“å‡ºï¼š7 -> 0 -> 8\nåŸå› ï¼š342 + 465 = 807\n```\n### é¢˜è§£\n#### æ€è·¯ï¼š\né¦–å…ˆæˆ‘ä»¬æ ¹æ®ä»£ç æ³¨é‡Šå¯ä»¥äº†è§£åˆ°`l1`,`l2`çš„æ•°æ®æ ¼å¼ä¸ºï¼š\n```\n{\n    val: 2,\n    next: {\n        val: 4,\n        next: {\n            val: 3,\n            next: null\n        }\n    }\n}\n```\nå¯ä»¥ç†è§£ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯åè¿›åˆ¶çš„æ¯ä¸€ä½ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¯ä¸€ä½ç›¸åŠ ï¼Œè‹¥ç›¸åŠ å¤§äº`10`åˆ™å‘ä¸‹ä¸€ä½åŠ ä¸€ã€‚\n```\n/*\n * @lc app=leetcode.cn id=2 lang=javascript\n *\n * [2] ä¸¤æ•°ç›¸åŠ \n */\n\n// @lc code=start\n/**\n * Definition for singly-linked list.\n * function ListNode(val) {\n *     this.val = val;\n *     this.next = null;\n * }\n */\n/**\n * @param {ListNode} l1\n * @param {ListNode} l2\n * @return {ListNode}\n */\nvar addTwoNumbers = function (l1, l2) {\n    let node = new ListNode()\n    let temp = node\n    let sum = 0\n    let add = 0\n    // å¾ªç¯ç›´åˆ°l1å’Œl2æœ€åçš„èŠ‚ç‚¹\n    while (l1 || l2) {\n        sum = (l1 ? l1.val : 0) + (l2 ? l2.val : 0) + add;\n        temp.next = new ListNode(sum % 10);//å–ä½™\n        temp = temp.next;\n        add = sum >= 10 ? 1 : 0;//è®°å½•ä¸‹sum>=10ç”¨äºä¸‹ä¸€æ¬¡å¾ªç¯åŠ ä¸€\n        // è‹¥l1 å­˜åœ¨åˆ™å°†l1.nextèµ‹å€¼ç»™l1ï¼Œl2åŒç†\n        l1 && (l1 = l1.next); \n        l2 && (l2 = l2.next);\n    }\n    // å½“å¾ªç¯ç»“æŸï¼Œl1ä¸l2æœ€åçš„èŠ‚ç‚¹ç›¸åŠ çš„å€¼ sum>=10 åˆ™å¤åˆ¶ç»™ temp.next\n    add && (temp.next = new ListNode(add));\n    return node.next\n};\n// @lc code=end\n\n```",
      "data": {
        "title": "ä¸¤æ•°ç›¸åŠ ",
        "date": "2021-02-17 00:28:05",
        "tags": [
          "leetcodeç®—æ³•"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "AcFQPeaQV"
    },
    {
      "content": "æœ¬æ–‡æ‘˜è‡ª[ä½¿ç”¨Travis-ciè‡ªåŠ¨SSHéƒ¨ç½²ä»£ç ](https://zhuwenlong.com/blog/article/5c24b6f2895e3a0fb4072a5c)å’Œ[ä½¿ç”¨ travis è‡ªåŠ¨éƒ¨ç½² vuejs é¡¹ç›®](https://oidiotlin.com/shi-yong-travis-zi-dong-bu-shu-vuejs-xiang-mu/)\n## 1. ä»æ‰‹åŠ¨éƒ¨ç½²åˆ°è‡ªåŠ¨éƒ¨ç½²\nåœ¨æ•´ä¸ªä»£ç éƒ¨ç½²çš„é“è·¯ä¸Šï¼Œæˆ‘ç»å†äº†æ‰‹åŠ¨éƒ¨ç½²åˆ°`shell`åŠè‡ªåŠ¨éƒ¨ç½²å†åˆ°ç°åœ¨çš„`Travis`è‡ªåŠ¨éƒ¨ç½²ã€‚\n### 1.1 çŸ³å™¨æ—¶ä»£ - æ‰‹åŠ¨éƒ¨ç½²\nå¾ˆæ—©å¾ˆæ—©ä¹‹å‰ï¼Œæˆ‘é‡‡ç”¨å®Œå…¨æ‰‹åŠ¨çš„æ–¹å¼éƒ¨ç½²ä»£ç ï¼š\n\n![](https://panyu97py.github.io/post-images/1613492275362.png)\n\nè¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘éœ€è¦ï¼Œå…ˆåœ¨æœ¬åœ°ç¼–å†™å¹¶è°ƒè¯•ä»£ç ç„¶åä¸Šä¼ åˆ°GitæœåŠ¡å™¨ä¸Šï¼Œå†æ‰‹åŠ¨`SSH`ç™»å½•æœºå™¨é€šè¿‡`git pull`ä¸‹è½½æœ€æ–°çš„ä»£ç ï¼Œæœ€ååœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œç¼–è¯‘å’Œé‡å¯æœåŠ¡ã€‚\n\nè¿™ç§åŸå§‹çš„æ¨¡å¼å¾€å¾€æœ€å‚»ç“œæœ‰æ•ˆï¼Œä½†æ„å‘³ç€éœ€è¦æ‰‹åŠ¨åšä¸€äº›åˆ—çš„å·¥ä½œï¼Œæ¯æ¬¡éƒ¨ç½²éƒ½ä¼šå˜å¾—æå…¶éº»çƒ¦ã€‚\n### 1.2 é’é“œæ—¶ä»£ - shellåŠè‡ªåŠ¨éƒ¨ç½²\nåæ¥æˆ‘æƒ³åˆ°äº†æŠŠç™»å½•æœºå™¨ã€ç¼–è¯‘ã€éƒ¨ç½²çš„äº‹æƒ…äº¤ç»™shellè‡ªåŠ¨æ‰§è¡Œï¼Œäºæ˜¯æˆ‘å°±å†™äº†ä¸ªshellè„šæœ¬ï¼Œä¸»è¦çš„å†…å®¹æ˜¯ï¼šæœ¬åœ°ç¼–è¯‘å®Œæˆä¹‹åshellè„šæœ¬è‡ªåŠ¨çš„æŠŠä»£ç æ‰“åŒ…ï¼Œç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œéƒ¨ç½²å¹¶é‡å¯æœåŠ¡ã€‚\n\n![](https://panyu97py.github.io/post-images/1613492312196.png)\n\nä½¿ç”¨äº†`shell`ä¹‹åå¤§å¤§çš„è§£æ”¾äº†åŒæ‰‹ï¼Œæ¯æ¬¡å†³å®šä¸Šçº¿çš„æ—¶å€™åªéœ€è¦æ‰§è¡Œ`sh deploy.sh`ç„¶ååç­‰ç»“æœå°±å¥½äº†ã€‚ä½†æ˜¯ä½¿ç”¨shellä¹Ÿæœ‰ä»–çš„å¼Šç«¯ï¼šæ¯æ¬¡ä¸Šçº¿éƒ½å¾—æ‰‹åŠ¨æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ï¼Œç„¶åç­‰å¾…ä»£ç è‡ªåŠ¨çš„æ‰“åŒ…ä¸Šä¼ ä»¥åŠéƒ¨ç½²ï¼Œå¦‚æœé‡åˆ°ç½‘ç»œæŠ–åŠ¨æˆ–è€…æ‰“åŒ…åçš„æ–‡ä»¶è¿‡å¤§å­˜åœ¨ç€å¤±è´¥çš„å¯èƒ½æ€§ï¼Œå°±æœ‰å¯èƒ½è¿˜éœ€è¦å†æ¥ä¸€æ¬¡ã€‚è¯´æ˜¯è‡ªåŠ¨åŒ–ï¼Œå…¶å®è¿˜æ˜¯éœ€è¦äººå·¥å»è§‚å¯Ÿå’Œå¹²é¢„çš„ï¼Œäºæ˜¯Mofeiå°±æƒ³äº†ï¼Œèƒ½ä¸èƒ½æœ‰ä¸€ç§æ›´é«˜æ•ˆçš„æ–¹å¼è¿›è¡Œéƒ¨ç½²å‘¢ï¼Ÿäºæ˜¯å°±æœ‰äº†ç°åœ¨çš„éƒ¨ç½²æ–¹å¼ã€‚\n### 1.3 ç°ä»£ - Travisè‡ªåŠ¨éƒ¨ç½²\né€šè¿‡é…åˆ`Travis`çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¦‚ä¸‹çš„æ•ˆæœï¼š\n\n* æµ‹è¯•éƒ¨ç½²ï¼šæ¯æ¬¡`push`ä»£ç åˆ°`dev`åˆ†æ”¯ï¼Œ`Travis`ä¼šè‡ªåŠ¨è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œç„¶åè‡ªåŠ¨çš„é€šè¿‡SSHå°†ä»£ç éƒ¨ç½²åˆ°å¯¹åº”çš„å¼€å‘æœºå™¨ä¸Šå¹¶é‡å¯æœåŠ¡ï¼Œä»¥ä¿æŒå¼€å‘æœºä¸Šå§‹ç»ˆæ˜¯æœ€æ–°çš„ç‰ˆæœ¬ã€‚\n* æ­£å¼éƒ¨ç½²ï¼šå†³å®šä¸Šçº¿çš„æ—¶å€™å¯ä»¥å°†ä»£ç `push`ä»£ç åˆ°`deploy`åˆ†æ”¯ä¸Šï¼Œ`Travis`ä¼šè‡ªåŠ¨å°†ä»£ç éƒ¨ç½²åˆ°æ­£å¼çš„å¼€å‘ç¯å¢ƒã€‚\n\n![](https://panyu97py.github.io/post-images/1613492414921.png)\n\nå½“ç„¶äº†è¿™ä¸ªè¿‡ç¨‹å¯ä»¥æ ¹æ®è‡ªå·±çš„å›¢é˜Ÿè¿›è¡Œé€‚å½“çš„è°ƒæ•´ä»¥å†³å®šä½•æ—¶è¿›è¡Œéƒ¨ç½²ã€‚\n## 2.è°ƒæ•™Travis\næ­¥å…¥æ­£é¢˜ï¼Œè¦å®Œæˆè‡ªåŠ¨éƒ¨ç½²ï¼Œé¦–å…ˆ`Travis`è¦èƒ½ç›‘å¬`Git`çš„å˜åŒ–ï¼Œç„¶å`Travis`è¿˜éœ€è¦æœ‰æƒé™ç™»å½•åˆ°æˆ‘ä»¬çš„`SSHæœåŠ¡å™¨`è¿›è¡Œéƒ¨ç½²ï¼š\n\n![](https://panyu97py.github.io/post-images/1613492488023.png)\n\n1. é…ç½®`Travis`ï¼Œè®©`Travis`èƒ½ç›‘å¬`Git`çš„æŸä¸ªåˆ†æ”¯ã€‚\n2. `Git`æŸä¸ªåˆ†æ”¯æäº¤ä¹‹åï¼ŒTravisèƒ½è‡ªåŠ¨å‘ç°æäº¤å¹¶è¿›è¡Œç¼–è¯‘ã€‚\n3. `Travis`å°†ç¼–è¯‘åçš„äº§ç‰©é€šè¿‡SSHéƒ¨ç½²åˆ°ç»™æˆ‘ä»¬æŒ‡å®šçš„æœºå™¨ã€‚\n### 2.1 åˆå§‹åŒ–Travis\n>å¼€å§‹ä¹‹å‰ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰`Travis`è´¦å·ï¼Œè¯·ä½¿ç”¨`Github`ç™»å½•`Traivs`ï¼Œå¹¶å…³è”ä½ çš„é¡¹ç›®ã€‚\n\n`Travis`æ˜¯é€šè¿‡é¡¹ç›®ä¸­çš„`.travis.yml`æ–‡ä»¶æ¥é…ç½®ä»»åŠ¡çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•å»ºç«‹`.travis.yml`æ–‡ä»¶ï¼Œæˆ‘ä»¬ä»¥è¯¥é…ç½®ä¸ºä¾‹ã€‚\n\næ–°å»º`.travis.yml`æ–‡ä»¶ï¼Œå†™ä¸Šå¦‚ä¸‹ä»£ç ï¼š\n```\nlanguage: node_js\nnode_js:\n- 8\n```\nå…¶ä¸­`language`æŒ‡å¾—æ˜¯é¡¹ç›®è¿è¡Œè¯­è¨€ï¼Œå› ä¸ºè¿™é‡Œæ˜¯`node.js`é¡¹ç›®ï¼Œæ‰€ä»¥å†™çš„æ˜¯`node_js`ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…¶ä»–çš„è¯­è¨€å¯ä»¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ã€‚ä¹‹åçš„`-8`æŒ‡çš„æ˜¯ä½¿ç”¨`v8ç‰ˆæœ¬`çš„`node.js`.å½“ç„¶ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå¤šä¸ªç‰ˆæœ¬æ¥åˆ†åˆ«æ‰§è¡Œä»£ç ï¼Œå¦‚ï¼š\n```\nnode_js:\n- stable\n- '6'\n- '4'\n```\né‚£ä¹ˆæˆ‘ä»¬ä»¥`vue`é¡¹ç›®ä¸ºä¾‹ï¼š\nå¦‚æœä¸ç”¨ `travis`ï¼Œå¯¹äºä¸€ä¸ª `vuejs `é¡¹ç›®æ¥è¯´ï¼Œå¤§æ¦‚æœ‰è¿™ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š\n\n1. å¼€å‘ç¯å¢ƒæ‰“åŒ…:åœ¨å¼€å‘æœºä¸Šæ‰“åŒ…å‡ºé™æ€æ–‡ä»¶ï¼Œå†å°†` dist` ä¸Šä¼ åˆ°ç”Ÿäº§ç¯å¢ƒã€‚\n```\nnpm install\nnpm run build\nrsync ./dist/* <USERNAME>@<HOST>:<TARGET-PATH>\n```\n2. ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…:åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‹‰å–ä»“åº“ï¼Œæ‰“åŒ…ï¼Œå†æ‹·è´åˆ°ç›®æ ‡è·¯å¾„ã€‚\n```\nnpm install\nnpm run build\ncp ./dist/* <TARGET-PATH>\n```\næ‰€ä»¥`vue`é¡¹ç›®å®Œæ•´çš„`.travis.yml`æ–‡ä»¶å¦‚ä¸‹ï¼š\n```\nlanguage: node_js\nnode_js: stable\nbranches:\n  only:\n  - master\naddons:\n  ssh_known_hosts:\n  - <HOST>\ninstall:\n- npm install\nscript:\n- npm run build\nafter_success:\n- rsync -az --delete ./dist/* <USERNAME>@<HOST>:<TARGET-PATH>\n```\næ·»åŠ å¥½`.travis.yml`æ–‡ä»¶ä¹‹åï¼Œæ¯æ¬¡ä¸Šä¼ åˆ°Gitä¸­çš„ä»£ç éƒ½ä¼šè‡ªåŠ¨è¿›è¡Œ`Travis`çš„æ„å»ºï¼Œå¦‚æœé€šè¿‡äº†å¯ä»¥åœ¨å¯¹åº”çš„`commit`åé¢çœ‹åˆ°ä¸€ä¸ªç»¿è‰²çš„å‹¾ï¼Œå¦‚æœå¤±è´¥äº†ä¼šæ˜¯ä¸€ä¸ªçº¢è‰²çš„å‰ã€‚\n\n![](https://panyu97py.github.io/post-images/1613492529472.png)\n\nä½†æ˜¯å¦‚æœä»…ä»…æ˜¯åƒä¸Šé¢é‚£æ ·é…ç½®çš„è¯ï¼Œ`travis build` çš„æ—¶å€™ä¼šå¡ä½ã€‚å› ä¸º `rsync` å·¥å…·éœ€è¦è¾“å…¥` ssh` ç™»å½•å¯†ç ï¼Œè€Œåœ¨ `travis build` ç¯å¢ƒé‡Œï¼Œæˆ‘ä»¬æ ¹æœ¬æ— æ³•è¾“å…¥å¯†ç ã€‚\n### 2.2 Travisæ·»åŠ SSHå¯†é’¥\né€šå¸¸æˆ‘ä»¬æ˜¯é€šè¿‡sshå‘½ä»¤åŠ ä¸Šç”¨æˆ·åå’Œå¯†ç è®¿é—®æœåŠ¡å™¨çš„ï¼Œè™½ç„¶ç†è®ºä¸Šæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨`travis`çš„å‘½ä»¤ä¸­å†™ä¸Šè¯¸å¦‚`ssh mofei@zhuwenlong.com -p abc`çš„è„šæœ¬ï¼Œä½†æ˜¯è¿™æ ·çš„ä»£ç å¦‚æœæäº¤åˆ°äº†å…¬å¼€çš„ä»“åº“ä¸­ä¼šæœ‰å¾ˆå¤§çš„æ³„éœ²æœåŠ¡å™¨å¯†ç çš„é£é™©ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ«äººæ— æ³•çªƒå–å¯†ç æˆ–è€…å¯†é’¥çš„æ–¹å¼è®©`Travis`ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚\n\né€šå¸¸çš„å…å¯†ç™»å½•æ˜¯åŸºäº`SSH`ä¿¡ä»»å…³ç³»çš„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½æŠŠå¯†é’¥ä»¥åŠ å¯†çš„å½¢å¼ä¿æŒåœ¨`Travis`çš„æœåŠ¡å™¨ä¸­ï¼Œ`Travis`å°±èƒ½ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨äº†ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`Travis`çš„æ–‡ä»¶åŠ å¯†åŠŸèƒ½ï¼ŒæŠŠæˆ‘ä»¬çš„å¯†é’¥è¿›è¡ŒåŠ å¯†ä¿å­˜ã€‚\n\n![](https://panyu97py.github.io/post-images/1613492578954.png)\n\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„å¯†é’¥é¦–å…ˆä¼šè¢«è¢«`Travis`åŠ å¯†ï¼Œè§£å¯†çš„å¯†é’¥è¢«å­˜å‚¨åœ¨`Travis`ä¸­ï¼Œå°±æ˜¯è¯´åªæœ‰`Travis`å¯ä»¥è¿›è¡Œè§£å¯†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„æŠŠè¿™ä¸ªåŠ å¯†åçš„æ–‡ä»¶ä¸Šä¼ åˆ°`github`ä¸­ï¼Œä¸ç”¨æ‹…å¿ƒå…¶ä»–äººç›—ç”¨æˆ‘ä»¬çš„å¯†é’¥ã€‚\n\næ—¢ç„¶æˆ‘ä»¬æƒ³è¦ä½¿ç”¨`Travis`åŠ å¯†æ–‡ä»¶ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯åœ¨æœ¬åœ°å®‰è£…`Travis`ã€‚\n\n>è¿™é‡Œæœ‰ä¸€ç‚¹ä¸€å®šè¦æ³¨æ„å°±æ˜¯å¦‚æœä½ çš„ç›®æ ‡æœåŠ¡å™¨ä¸º`linux`ç³»ç»Ÿçš„è¯é‚£ä¹ˆä½ çš„ä»¥ä¸‹æ­¥éª¤ä¹Ÿå¿…é¡»åœ¨`linux`ç³»ç»Ÿä¸­æ‰§è¡Œï¼ï¼ï¼ï¼\n#### 2.2.1 æœ¬åœ°å®‰è£…Travis\n```\nsudo gem install travis\n```\nç”±äº`Travis`ä½¿ç”¨çš„æ˜¯`ruby`ï¼Œå¦‚æœé‡åˆ°ä¼—æ‰€å‘¨çŸ¥çš„åŸå› æ— å‘ç°ä¸‹è½½çš„è¯ï¼Œå¯ä»¥å°†`ruby`æ›´æ¢æˆå›½å†…çš„æºï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™é‡Œã€‚\n```\ngem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/\n```\nç„¶åå†æ¬¡è¿è¡Œå®‰è£…`Travis`çš„å‘½ä»¤ `sudo gem install travis`\n\nå®‰è£…å¥½`Travis`ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­ç™»å½•`Travis`\n```\ntravis login --pro\n```\nä¸€è·¯è¾“å…¥ä½ çš„`github`è´¦å·å’Œå¯†ç å¾ˆå¿«å°±å®Œæˆäº†ã€‚\n#### 2.2.2 ç”Ÿæˆå¹¶åŠ å¯†SSHå¯†é’¥\nä¸‡äº‹ä¿±å¤‡åªæ¬ ä¸œé£ï¼Œæˆ‘ä»¬ç°åœ¨åªè¦ç”Ÿæˆ`SSH`å¯†é’¥ï¼Œç„¶åæ·»åŠ ä¿¡ä»»å…³ç³»ï¼Œå¹¶ç”¨`Travis`åŠ å¯†ä¿å­˜å³å¯ã€‚\n\nåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œå¦‚ä¸‹è„šæœ¬ï¼š\n```\n# åœ¨å½“å‰ç›®å½•ç”Ÿæˆå¯†é’¥\nssh-keygen -t rsa -b 4096 -C 'build@travis-ci.org' -f ./deploy_rsa\n# ä½¿ç”¨TravisåŠ å¯†\ntravis encrypt-file deploy_rsa --add\n# æ·»åŠ ä¿¡ä»»å…³ç³»\nssh-copy-id -i deploy_rsa.pub <ssh-user>@<deploy-host>\n# åˆ é™¤æ•æ„Ÿæ–‡ä»¶\nrm -f deploy_rsa deploy_rsa.pub\n# å°†ä¿®æ”¹æ·»åŠ åˆ°gitä¸­\ngit add deploy_rsa.enc .travis.yml\n```\næˆ‘ä»¬è¯¦ç»†æ¥çœ‹ä¸€ä¸‹ä»£ç ï¼ˆå¦‚æœä½ ç†è§£æ‰€æœ‰çš„å‘½ä»¤ï¼Œå¯ä»¥ç•¥è¿‡è¿™ä¸€å°æ®µï¼‰ï¼š\n* åœ¨å½“å‰ç›®å½•ç”Ÿæˆå¯†é’¥\n```\nssh-keygen -t rsa -b 4096 -C 'build@travis-ci.org' -f ./deploy_rsa\n```\né¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨sshçš„å‘½ä»¤åœ¨å½“å‰ç›®å½•ä¸­ç”Ÿæˆäº†ä¸€ä¸ª`ssh`å¯†é’¥ï¼Œè¿™æ®µä»£ç æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šåœ¨ç›®å½•ä¸­ç”Ÿæˆ2ä¸ªæ–‡ä»¶ï¼Œç§é’¥`deploy_rsa`å’Œå…¬é’¥`deploy_rsa.pub`ï¼Œå‰è€…æ˜¯ç”¨æ¥å…å¯†ç™»å½•æœåŠ¡å™¨æ—¶å€™ä½¿ç”¨çš„ï¼Œåè€…æœåŠ¡å™¨ç”¨æ¥é‰´å®šç§é’¥çš„æœ‰æ•ˆæ€§çš„ã€‚\n* ä½¿ç”¨TravisåŠ å¯†\n```\ntravis encrypt-file deploy_rsa --add\n```\nå› ä¸º`Travis`åªéœ€è¦ä½¿ç”¨åˆ°ç§é’¥ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œè®²ç§é’¥è¿›è¡ŒåŠ å¯†ä¿å­˜ï¼Œè¿™å¥è¯æ‰§è¡Œå®Œæˆä¹‹åï¼Œä½ ä¼šçœ‹åˆ°åœ¨`.travis.yml`æ–‡ä»¶ä¸­è¢«è‡ªåŠ¨åŠ äº†ä¸‹é¢çš„ä»£ç (`--add`)ï¼ŒåŒæ—¶æ–‡ä»¶å¤¹ä¸­ä¹Ÿå‘ç°ä¸€ä¸ªåŠ å¯†åçš„æ–‡ä»¶`deploy_rsa.enc`ã€‚\n```\nbefore_install:\n- openssl aes-256-cbc -K $encrypted_137f45644142_key -iv $encrypted_137f45644142_iv\n  -in deploy_rsa.enc -out deploy_rsa -d\n```\nè¿™å‡ è¡Œè¢«è‡ªåŠ¨æ·»åŠ çš„ä»£ç çš„æ„æ€æ˜¯ï¼Œåœ¨`install`ä¹‹å‰æ‰§è¡Œè§£å¼€`deploy_rsa.enc`æ–‡ä»¶çš„å‘½ä»¤å¹¶æ”¾ç½®åˆ°`deploy_rsa`ä»¥ä¾›ä½¿ç”¨ï¼Œå…¶ä¸­è¿™é‡Œçš„`$encrypted_137f45644142_key`å’Œ`$encrypted_137f45644142_iv`æ˜¯è§£å¼€è¿™ä¸ªæ–‡ä»¶çš„ä¸¤ä¸ªå˜é‡è¢«å­˜å‚¨åœ¨äº†`Travis`çš„æœåŠ¡å™¨ä¸Šã€‚\n* æ·»åŠ ä¿¡ä»»å…³ç³»\n```\nssh-copy-id -i deploy_rsa.pub <ssh-user>@<deploy-host>\n```\nè¿™å¥è¯çš„æ„æ€æ˜¯å‘ç›®æ ‡æœåŠ¡å™¨(`<ssh-user>@<deploy-host>`è¿™é‡Œçš„`user`å’Œ`host`éœ€è¦æ›¿æ¢æˆè‡ªå·±æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œåœ°å€)æ·»åŠ å…¬é’¥ï¼Œæ·»åŠ æˆåŠŸä¹‹åï¼Œæ‰€æœ‰ç”¨è¯¥å…¬é’¥å¯¹åº”çš„ç§é’¥è®¿é—®æœåŠ¡å™¨éƒ½ä¼šç›´æ¥è¢«è®¤è¯é€šè¿‡ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ`Travis`ä¿æŒäº†ç§é’¥çš„è¯ï¼Œå°±å¯ä»¥å…å¯†çš„é€šè¿‡`ssh`ç™»å½•æˆ‘ä»¬çš„æœåŠ¡å™¨äº†ã€‚\n* åˆ é™¤æ•æ„Ÿæ–‡ä»¶å¹¶å°†ä¿®æ”¹æ·»åŠ åˆ°gitä¸­\n```\nrm -f deploy_rsa deploy_rsa.pubå’Œgit add deploy_rsa.enc .travis.yml\n```\nç§é’¥`deploy_rsa`å’Œ`å…¬é’¥deploy_rsa.pub`å·²ç»å®Œæˆäº†ä»–ä»¬çš„ä½¿å‘½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒåˆ é™¤ä»¥å…è¢«å…¶ä»–äººæ¶æ„ä½¿ç”¨ï¼Œå¹¶æŠŠç”Ÿæˆçš„åŠ å¯†æ–‡ä»¶`deploy_rsa.enc`å’Œä¿®æ”¹åçš„`.travis.yml`æ·»åŠ åˆ°`git`ä¸­ã€‚\n### 2.3 Traviséƒ¨ç½²è„šæœ¬\næ‰€æœ‰çš„ä¸€åˆ‡éƒ½å‡†å¤‡å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹`.travis.yml`æ–‡ä»¶è®©`travis`æ¥è¿›è¡Œéƒ¨ç½²äº†ã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨éƒ¨ç½²ä¹‹å‰è§£å¯†ç§é’¥ï¼Œå¹¶ä½¿å…¶ç”Ÿæ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\n```\nbefore_install:\n- openssl aes-256-cbc -K $encrypted_137f45644142_key -iv $encrypted_137f45644142_iv\n  -in deploy_rsa.enc -out /tmp/deploy_rsa -d\n- eval \"$(ssh-agent -s)\"\n- chmod 600 /tmp/deploy_rsa\n- ssh-add /tmp/deploy_rsa\n```\n`before_install`å­—æ®µæ ‡æ˜äº†Travisåœ¨éƒ¨ç½²ä¹‹å‰éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå…¶ä¸­ç¬¬ä¸€è¡Œæ˜¯è§£å¯†`ssh`æ–‡ä»¶ï¼Œåé¢çš„3è¡Œæ˜¯ä½¿`ssh`å¯†é’¥ç”Ÿæ•ˆã€‚\näºæ˜¯æˆ‘ä»¬æœ€ç»ˆçš„`.travis.yml`æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n```\nlanguage: node_js\nnode_js: stable\nbranches:\n  only:\n  - master\naddons:\n  ssh_known_hosts:\n  - <HOST>\nbefore_install:\n- openssl aes-256-cbc -K $encrypted_137f45644142_key -iv $encrypted_137f45644142_iv\n  -in deploy_rsa.enc -out /tmp/deploy_rsa -d\n- eval \"$(ssh-agent -s)\"\n- chmod 600 /tmp/deploy_rsa\n- ssh-add /tmp/deploy_rsa\ninstall:\n- npm install\nscript:\n- npm run build\nafter_success:\n- rsync -az --delete ./dist/* <USERNAME>@<HOST>:<TARGET-PATH>\n```\nç„¶åå°±å¯ä»¥åœ¨æ¯æ¬¡`push`ä¹‹åç©å»äº†ã€‚`Travis-ci`ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆéƒ¨ç½²ã€‚",
      "data": {
        "title": "ä½¿ç”¨Travis-ciè‡ªåŠ¨SSHéƒ¨ç½²vueä»£ç ",
        "date": "2021-02-17 00:15:44",
        "tags": [
          "æœåŠ¡éƒ¨ç½²"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "8WTNVL6y5"
    },
    {
      "content": "## ä½¿ç”¨\n\npackage.json\n```\n{\n    ...\n    \"scripts\":{\n        \"serve:dev\": \"cross-env API_ENV=dev vue-cli-service serve\"\n        ...\n    },\n    \"dependencies\": {\n      ...\n      \"cross-env\": \"^7.0.2\",\n      ...\n    },\n    ...\n}\n```\n.env\n```\nVUE_APP_API_ENV=${API_ENV}\n```\né¡¹ç›®ä¸­å–ç”¨\n```\nconsole.log(process.env.VUE_APP_API_ENV)\n```\n\n\n## æºç è§£æ\n\n\nvue cli3 ä¸­ [ç¯å¢ƒå˜é‡å’Œæ¨¡å¼](https://cli.vuejs.org/zh/guide/mode-and-env.html) å†™åˆ°å®ƒå¯ä»¥é€šè¿‡è·å–`.env`ã€`.env.local`ã€`.env.[mode]`ã€`.env.[mode].local`æ–‡ä»¶ä¸­çš„å†…å®¹å®šä¹‰ç¯å¢ƒå˜é‡ã€‚\n\n\næ¯”å¦‚ï¼š\n```\nVUE_APP_TITLE=TITLE\n```\næ–‡æ¡£ä¸­å†™é“ï¼šåªæœ‰ä»¥ `VUE_APP_` å¼€å¤´çš„å˜é‡ä¼šè¢« `webpack.DefinePlugin` é™æ€åµŒå…¥åˆ°å®¢æˆ·ç«¯ä¾§çš„åŒ…ä¸­ã€‚\n\né‚£æˆ‘ä»¬æ¥çœ‹æºç :\n\n### [base.js](https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/config/base.js#L192)\n>å¼•å…¥æ–¹æ³•`resolveClientEnv.js`,é€šè¿‡ [`webpack-chain`](https://github.com/neutrinojs/webpack-chain), é“¾å¼é…ç½®äº†`DefinePlugin`ä½¿å˜é‡é™æ€åµŒå…¥åˆ°å®¢æˆ·ç«¯ä¾§çš„åŒ…ä¸­ã€‚\n```\n const resolveClientEnv = require('../util/resolveClientEnv')\n    webpackConfig\n      .plugin('define')\n        .use(require('webpack').DefinePlugin, [\n          resolveClientEnv(options)\n        ])\n```\n\n\n### [resolveClientEnv.js](https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/util/resolveClientEnv.js)\n> å°±æ˜¯è¿™ä¸ªæ–¹æ³•å®šä¹‰äº†ç¯å¢ƒå˜é‡å¿…é¡»ä¸º`VUE_APP_`å¼€å§‹çš„è§„åˆ™ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†`process.env`é‡Œçš„å€¼æ˜¯å“ªé‡Œæ¥çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬å®šä¹‰åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å€¼ä¼šè¢«å†™å…¥åˆ°`process.env`é‡Œæ¥ç€å¾€ä¸‹çœ‹ã€‚\n```\n\n// æ­£åˆ™åŒ¹é…ä»¥ VUE_APP_ å¼€å¤´çš„ key\nconst prefixRE = /^VUE_APP_/\n\nmodule.exports = function resolveClientEnv (options, raw) {\n  const env = {}\n  \n  // å¾ªç¯ process.env çš„ key\n  Object.keys(process.env).forEach(key => {\n  \n    // åŒ¹é…keyç¬¦åˆæ­£åˆ™æˆ–keyç­‰äºNODE_ENV\n    if (prefixRE.test(key) || key === 'NODE_ENV') {\n      env[key] = process.env[key]\n    }\n  })\n  env.BASE_URL = options.publicPath\n\n  if (raw) {\n    return env\n  }\n\n  for (const key in env) {\n    env[key] = JSON.stringify(env[key])\n  }\n  \n  // è¿”å›ç¯å¢ƒå˜é‡é…ç½®\n  return {\n    'process.env': env\n  }\n}\n```\n### [Service.js](https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/Service.js#L89)\n> ä»é…ç½®æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡çš„ç›¸å…³ä»£ç å…¶ä¸­å…³é”®çš„æ˜¯[`dotenv`](https://github.com/motdotla/dotenv/blob/master/lib/main.js)ã€[`dotenv-expand`](https://github.com/motdotla/dotenv-expand/blob/master/lib/main.js) \n>\n>` dotenv`:å°†é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°è¯»å–å¹¶å†™å…¥ç¯å¢ƒå˜é‡\n>\n>`dotenv-expand` : å°†`dotenv`è¯»å–çš„ç¯å¢ƒå˜é‡è¿›è¡Œå†æ¬¡å¤„ç†ç­›é€‰å…¶ä¸­ä»¥`${key}`å®šä¹‰çš„å˜é‡ï¼Œå¹¶æŸ¥è¯¢`node`çš„ç¯å¢ƒå˜é‡ä¸­æ˜¯å¦åŒ…å«å¯¹åº”çš„`key`å‡å¦‚å­˜åœ¨å°±èµ‹å€¼ã€‚\n>\n>å…·ä½“çš„ä»£ç æˆ‘å°±ä¸æ”¾äº†æƒ³çœ‹å¯ä»¥ç‚¹ä¸Šé¢çš„é“¾æ¥è‡ªå·±çœ‹ã€‚\n```\nconst dotenv = require('dotenv')\nconst dotenvExpand = require('dotenv-expand')\n...\nmodule.exports = class Service {\n\n  ...\n\n  // åŠ è½½ç¯å¢ƒå˜é‡\n  loadEnv (mode) {\n    const logger = debug('vue:env')\n    const basePath = path.resolve(this.context, `.env${mode ? `.${mode}` : ``}`)\n    const localPath = `${basePath}.local`\n\n    const load = envPath => {\n      try {\n        const env = dotenv.config({ path: envPath, debug: process.env.DEBUG })\n        dotenvExpand(env)\n        logger(envPath, env)\n      } catch (err) {\n        // only ignore error if file is not found\n        if (err.toString().indexOf('ENOENT') < 0) {\n          error(err)\n        }\n      }\n    }\n\n    load(localPath)\n    load(basePath)\n\n    // by default, NODE_ENV and BABEL_ENV are set to \"development\" unless mode\n    // is production or test. However the value in .env files will take higher\n    // priority.\n    if (mode) {\n      // always set NODE_ENV during tests\n      // as that is necessary for tests to not be affected by each other\n      const shouldForceDefaultEnv = (\n        process.env.VUE_CLI_TEST &&\n        !process.env.VUE_CLI_TEST_TESTING_ENV\n      )\n      const defaultNodeEnv = (mode === 'production' || mode === 'test')\n        ? mode\n        : 'development'\n      if (shouldForceDefaultEnv || process.env.NODE_ENV == null) {\n        process.env.NODE_ENV = defaultNodeEnv\n      }\n      if (shouldForceDefaultEnv || process.env.BABEL_ENV == null) {\n        process.env.BABEL_ENV = defaultNodeEnv\n      }\n    }\n  }\n  \n  ...\n \n }\n```\n\n### ç»¼ä¸Šæ‰€è¿°ï¼šæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å®šä¹‰æˆ‘ä»¬çš„ç¯å¢ƒå˜é‡\n\npackage.json\n```\n{\n    ...\n    \"scripts\":{\n        \"serve:dev\": \"cross-env API_ENV=dev vue-cli-service serve\"\n        ...\n    },\n    \"dependencies\": {\n      ...\n      \"cross-env\": \"^7.0.2\",\n      ...\n    },\n    ...\n}\n```\n.env\n```\nVUE_APP_API_ENV=${API_ENV}\n```\né¡¹ç›®ä¸­å–ç”¨\n```\nconsole.log(process.env.VUE_APP_API_ENV)\n```\n### é‚£ä¹ˆæœ‰äººå°±ä¼šé—®äº†ï¼Œè¿™ä¸ªåœ¨å®é™…é¡¹ç›®ä¸­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ\n\nå‡å¦‚å…¬å¸æœ‰ä¸ªé¡¹ç›®å…±æœ‰ä¸‰ä¸ªç¯å¢ƒï¼šæµ‹è¯•ã€é¢„å‘ã€çº¿ä¸Šï¼Œè€Œæ¥å£åœ°å€æ˜¯éœ€è¦é€šè¿‡ç¯å¢ƒå˜é‡åˆ¤æ–­çš„ã€‚å¹¶ä¸”æˆ‘ä»¬å¸Œæœ›åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥è°ƒè¯•çº¿ä¸Šæˆ–å…¶ä»–çš„æœåŠ¡æ¥å£ä¸”å‘å¸ƒåˆ°çº¿ä¸Šçš„é¡¹ç›®å¸Œæœ›`mode`ä¸º`production`ï¼Œæœ¬åœ°è°ƒè¯•çš„é¡¹ç›®æˆ‘ä»¬å¸Œæœ›`mode`ä¸º`development`é‚£æˆ‘å¾—æ–°å»ºå¤šå°‘é…ç½®æ–‡ä»¶ï¼Ÿ\n",
      "data": {
        "title": "VUE CLI3 ç»“åˆ cross-env é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå«ç¯å¢ƒå˜é‡æºç è§£æï¼‰",
        "date": "2021-02-17 00:08:53",
        "tags": [
          "vue"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "aocYfRCOM"
    },
    {
      "content": "\n### ä¿è¯æ¯ä¸ªTextç»„ä»¶, RN > 0.60, å°äºè¿™ä¸ªç‰ˆæœ¬å¯èƒ½ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜\n\n1. åŸºæœ¬æ ·å¼éƒ½æœ‰ `fontFamily: ''` , ä½ æ²¡çœ‹é”™, è‡³å°‘å¾—æœ‰ä¸ªå­—ä½“ä¸ºç©º, ä¹Ÿä¸å½±å“ç”¨æˆ·è‡ªå®šä¹‰å­—ä½“\n\n2. å±æ€§è‡³å°‘æœ‰ `textBreakStrategy='simple'`\n\n3. å±æ€§è‡³å°‘æœ‰ `numberOfLines={0}`, æ„æ€å°±æ˜¯ä½ ä¸è®¾ç½®ä¹Ÿè¦æä¸ªåˆå§‹å€¼0\n",
      "data": {
        "title": "React-Native å®‰å“ æ–‡å­—æˆªæ–­ æ–‡å­—çœ‹ä¸å…¨ è§£å†³æ–¹æ¡ˆ",
        "date": "2021-02-17 00:08:16",
        "tags": [
          "react-native"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "fkwyV-3OV"
    },
    {
      "content": "ã€‚ã€‚ã€‚",
      "data": {
        "title": "å…³äº",
        "date": "2021-02-16 23:55:01",
        "tags": [],
        "published": true,
        "hideInList": true,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "about"
    }
  ],
  "tags": [
    {
      "index": -1,
      "name": "css",
      "slug": "kCJ9NzuJN",
      "used": true
    },
    {
      "index": -1,
      "name": "ios",
      "slug": "EQHzK48mS",
      "used": true
    },
    {
      "index": -1,
      "name": "vue",
      "slug": "vue",
      "used": true
    },
    {
      "index": -1,
      "name": "æœåŠ¡éƒ¨ç½²",
      "slug": "bTHMbCyj5",
      "used": true
    },
    {
      "index": -1,
      "name": "leetcodeç®—æ³•",
      "slug": "QdA6dffbV",
      "used": true
    },
    {
      "index": -1,
      "name": "react-native",
      "slug": "TFfhTEfXd",
      "used": true
    },
    {
      "index": -1,
      "name": "java",
      "slug": "3CvXE5HSY",
      "used": false
    },
    {
      "index": -1,
      "name": "spring",
      "slug": "G5UrJOVX1",
      "used": false
    },
    {
      "index": -1,
      "name": "react",
      "slug": "mrs5cXspG",
      "used": false
    }
  ],
  "menus": [
    {
      "link": "/",
      "name": "é¦–é¡µ",
      "openType": "Internal"
    },
    {
      "link": "/archives",
      "name": "å½’æ¡£",
      "openType": "Internal"
    },
    {
      "link": "/tags",
      "name": "æ ‡ç­¾",
      "openType": "Internal"
    },
    {
      "link": "/post/about",
      "name": "å…³äº",
      "openType": "Internal"
    }
  ]
}